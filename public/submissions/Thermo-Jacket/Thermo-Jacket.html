<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css"><link rel="stylesheet" href="../custom.css"><div class="middle-column">
 <section id="overview">
  <h1 class="hckui__typography__h1" itemprop="name">
   Thermo-Jacket
  </h1>
  <p class="hckui__typography__bodyL hckui__layout__marginBottom15" itemprop="description">
   A temperature-controlled jacket for the physically challenged
  </p>
  <div class="hckui__layout__marginTop30">
   <div class="hckui__layout__hiddenMedUp">
   </div>
   <div class="project-cover-image" itemprop="image" itemscope="" itemtype="https://schema.org/ImageObject">
    <meta content="https://hackster.imgix.net/uploads/attachments/1756485/_twKIVEfOVS.blob?auto=compress&amp;w=900&amp;h=675&amp;fit=min&amp;fm=jpg" itemprop="url"/>
    <meta content="900" itemprop="width"/>
    <meta content="675" itemprop="height"/>
    <img alt="Thermo-Jacket" src="4.jpg"/>
   </div>
  </div>
 </section>
 <div class="project-section-break">
 </div>
 <div id="project_page_simple_ad_portal">
 </div>
 <div id="description" itemprop="articleBody">
  <section id="things">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Things used in this project
     </span>
    </h2>
   </div>
   <div class="project-parts">
    <div class="view-expanded" style="display:block">
     <table class="project-parts-table">
      <colgroup>
       <col style="width: 100px; height: 50px;"/>
       <col style="width: auto;"/>
      </colgroup>
      <tbody>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Hardware components
         </h3>
        </td>
        <tr>
         <td class="part-img">
          <img alt="Temperature Sensor" src="5.jpg" srcset="https://hackster.imgix.net/uploads/image/file/96062/10988-01.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/96062/10988-01.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          Temperature Sensor
         </td>
        </tr>
        <tr>
         <td class="part-img">
         </td>
         <td class="hckui__typography__bodyL">
          Peltier Device
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="Li-Ion Battery 1000mAh" src="6.jpg" srcset="https://hackster.imgix.net/uploads/image/file/95952/Adafruit_Industries-ADA258-image_75px.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/95952/Adafruit_Industries-ADA258-image_75px.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          Li-Ion Battery 1000mAh
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="nRF52 Development Kit" src="7.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1077653/nrf52-dk_f5l8pXEY68.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1077653/nrf52-dk_f5l8pXEY68.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Nordic Semiconductor nRF52 Development Kit","href":"/nordic-semiconductor/products/nrf52-development-kit?ref=project-0547db","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/nordic-semiconductor/products/nrf52-development-kit?ref=project-0547db">
           Nordic Semiconductor nRF52 Development Kit
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="Seeed Studio XIAO ESP32S3 Sense" src="8.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1650360/screenshot_2023-11-20_at_17_16_09_QdLoLAbseq.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1650360/screenshot_2023-11-20_at_17_16_09_QdLoLAbseq.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Seeed Studio XIAO ESP32S3 Sense","href":"/seeed/products/seeed-studio-xiao-esp32s3-sense?ref=project-0547db","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/seeed/products/seeed-studio-xiao-esp32s3-sense?ref=project-0547db">
           Seeed Studio XIAO ESP32S3 Sense
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="Relay Shield for Particle Photon I²C 8-Channel SPDT 10-Amp" src="9.jpg" srcset="https://hackster.imgix.net/uploads/image/file/152604/MCP23008_SCR8G5LE_10A_B%20(1).png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/152604/MCP23008_SCR8G5LE_10A_B%20(1).png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"ControlEverything.com Relay Shield for Particle Photon I²C 8-Channel SPDT 10-Amp","href":"/controleverythingcom/products/relay-shield-for-particle-photon-i-c-8-channel-spdt-10-amp?ref=project-0547db","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/controleverythingcom/products/relay-shield-for-particle-photon-i-c-8-channel-spdt-10-amp?ref=project-0547db">
           ControlEverything.com Relay Shield for Particle Photon I²C 8-Channel SPDT 10-Amp
          </a>
         </td>
        </tr>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="story">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Story
     </span>
    </h2>
   </div>
   <div class="project-story collapsible-section collapsed hljs-active hljs-monokai" itemprop="text">
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-about-the-project-0">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      About the project
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     A temperature-controlled jacket could be a game-changer for physically challenged individuals, offering significant benefits in terms of comfort, mobility, and health. Many people with physical disabilities, such as spinal cord injuries, multiple sclerosis, or other conditions, often struggle to regulate their body temperature effectively. A temperature-controlled jacket would provide a way to maintain a comfortable body temperature without relying on external environmental conditions. Whether the person is exposed to extreme cold or heat, the jacket could be set to a desired temperature, ensuring that the wearer stays warm in cold weather or cool in hot environments.
    </p>
    <p class="hckui__typography__bodyL">
     For physically challenged individuals with limited mobility, adjusting layers of clothing can be a challenging task. A temperature-controlled jacket eliminates the need for constant changing of clothes to adapt to temperature changes. With easy-to-use controls, the jacket would allow users to adjust their temperature settings with minimal effort, enhancing their independence and reducing reliance on caregivers for something as basic as staying comfortable.
    </p>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-hardware-usage-1">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Hardware usage
     </span>
    </h3>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-peltier-device-2">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Peltier Device
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     A Peltier device, also known as a thermoelectric cooler, is a solid-state electronic component that transfers heat from one side to another when an electric current flows through it. It operates on the Peltier effect, where one side of the device absorbs heat and cools down, while the other side releases heat and warms up. These devices are compact, reliable, and have no moving parts, making them ideal for precise temperature control applications such as cooling electronics, portable refrigerators, or even temperature-controlled clothing. However, they are generally less efficient than traditional cooling methods.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="0.jpg"/>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-nordic-semiconductor-nrf52840-dk-3">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Nordic Semiconductor NRF52840 DK
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     The Nordic nRF52 Development Kit is dedicated to managing Bluetooth Low Energy (BLE) communication and controlling the haptic feedback motor. It connects wirelessly to a smartphone, allowing for additional processing power and access to external applications if needed. This module also facilitates the transfer of alerts, feedback, or other data between the wearable system and the smartphone. Additionally, it manages the haptic motor's operation, providing tactile feedback in real-time. Positioned near the main processing unit in the wearable device, it ensures efficient communication and control, enhancing the responsiveness of the feedback mechanisms.
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Controls the Peltier device via a PWM output pin.
     </li>
     <li>
      Reads the temperature from the sensor via an I2C or analog pin.
     </li>
     <li>
      Communicates with a Bluetooth module to receive the baseline temperature.
     </li>
     <li>
      Built-in Bluetooth capability in the nRF52840 or an external module can be used to set the baseline temperature.
     </li>
    </ul>
    <div class="carousel-images">
     <img class="carousel-image" src="1.jpg"/>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-generic-smart-phone-4">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Generic Smart phone
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     Almost available with any person in the modern time.
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Communicates with the NRF52840
     </li>
     <li>
      Used to set the baseline Temperature inside the Jacket using bluetooth
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-tmp32-temperature-sensor-5">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      TMP32 Temperature sensor
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     Generic I2C temperature sensor to sensing the temperature within the Jacket, placed close to the Peltier device
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Connects to the analog input (if using analog sensors like TMP36) or I2C/SPI pins (if using digital sensors like BME280).
     </li>
     <li>
      Power the sensor via 3.3V and GND pins from the nRF52840.
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-mosfet-control-6">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Mosfet control
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      The gate of the MOSFET is controlled by a PWM pin from the nRF52840.
     </li>
     <li>
      Source connected to ground; drain connected to the negative terminal of the Peltier device.
     </li>
     <li>
      The Peltier's positive terminal is connected to the positive terminal of the external power supply.
     </li>
    </ul>
    <div class="carousel-images">
     <img class="carousel-image" src="2.jpg"/>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-wiring-7">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Wiring
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       nRF52840 Board
      </strong>
      <span>
       :
      </span>
      <br/>
      <span>
       Power: 3.3V
      </span>
      <br/>
      <span>
       PWM pin (P0.13) →
      </span>
      <strong>
       MOSFET gate
      </strong>
      <span>
       .
      </span>
      <br/>
      <span>
       I2C/Analog pin (P0.04) →
      </span>
      <strong>
       Temperature sensor output
      </strong>
     </li>
     <li>
      <strong>
       Temperature Sensor (TMP36)
      </strong>
      <span>
       :
      </span>
      <br/>
      <span>
       VCC → 3.3V
      </span>
      <br/>
      <span>
       GND → Ground
      </span>
      <br/>
      <span>
       Vout → P0.04 (ADC pin)
      </span>
     </li>
     <li>
      <strong>
       MOSFET
      </strong>
      <span>
       :
      </span>
      <br/>
      <span>
       Gate → P0.13 (PWM)
      </span>
      <br/>
      <span>
       Source → Ground
      </span>
      <br/>
      <span>
       Drain → Peltier Negative Terminal
      </span>
     </li>
     <li>
      <strong>
       Peltier Device
      </strong>
      <span>
       :
      </span>
      <br/>
      <span>
       Positive terminal → Power Supply Positive
      </span>
      <br/>
      <span>
       Negative terminal → MOSFET Drain
      </span>
     </li>
     <li>
      <strong>
       Power Supply
      </strong>
      <span>
       :
      </span>
      <br/>
      <span>
       Positive terminal → Peltier Positive
      </span>
      <br/>
      <span>
       Negative terminal → Ground
      </span>
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-overall-functionality-8">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Overall Functionality
     </span>
    </h3>
    <div class="carousel-images">
     <img class="carousel-image" src="3.jpg"/>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-future-enhancements-9">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Future Enhancements
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      Adaptive Control: Implement PID or machine learning algorithms for efficient temperature control and reduced energy consumption.
     </li>
     <li>
      Battery Optimization: Introduce smart power management and solar charging for longer battery life and eco-friendly use.
     </li>
     <li>
      Advanced Bluetooth Features: Develop a mobile app for remote control, BLE mesh for smart home integration, and voice assistant support (e.g., Alexa, Google Assistant).
     </li>
     <li>
      IoT &amp; Cloud Integration: Enable cloud connectivity for remote monitoring and control, and integrate with smart devices for automated temperature adjustments.
     </li>
     <li>
      Multiple Sensors: Add more temperature and humidity sensors for precise regulation, and include biometric sensors for health monitoring.
     </li>
     <li>
      Wearable &amp; Flexible Design: Make the device lighter and integrate it into wearable clothing with selective heating/cooling zones.
     </li>
     <li>
      AI-driven Personalization: Use AI to learn user preferences and automatically adjust temperatures based on behavior and external conditions.
     </li>
     <li>
      Safety Features: Add overheating protection, waterproofing, and fireproofing for reliability and safety.
     </li>
     <li>
      Fashion Integration: Collaborate with designers to create stylish, temperature-regulating clothing.
     </li>
    </ul>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="code">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Code
     </span>
    </h2>
   </div>
   <div class="project-attachment project-code-widget single-file">
    <div class="tabs hckui__typography__bodyS">
     <ul>
      <li class="active">
       <a data-target="#code-widget-657598" href="javascript:void(0)">
        NRF52840 code
       </a>
      </li>
     </ul>
    </div>
    <div class="preview-container">
     <div class="preview-pane active" id="code-widget-657598">
      <div class="header">
       <div class="text">
        <div class="title">
         <h3 class="hckui__typography__h3">
          NRF52840 code
         </h3>
         <span class="hckui__typography__bodyS hckui__typography__pebble">
          C/C++
         </span>
        </div>
       </div>
      </div>
      <div class="preview-body pygments-syntax all">
       <div class="highlight">
        <pre><span></span><span id="line-1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;zephyr.h&gt;</span><span class="cp"></span>
</span><span id="line-2"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;device.h&gt;</span><span class="cp"></span>
</span><span id="line-3"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;drivers/gpio.h&gt;</span><span class="cp"></span>
</span><span id="line-4"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;drivers/pwm.h&gt;</span><span class="cp"></span>
</span><span id="line-5"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;drivers/sensor.h&gt;</span><span class="cp"></span>
</span><span id="line-6"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bluetooth/bluetooth.h&gt;</span><span class="cp"></span>
</span><span id="line-7"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bluetooth/gatt.h&gt;</span><span class="cp"></span>
</span><span id="line-8">
</span><span id="line-9"><span class="c1">// GPIO and PWM Definitions for the Peltier Control</span>
</span><span id="line-10"><span class="cp">#define PELTIER_PIN DT_GPIO_PIN(DT_ALIAS(peltier), gpios)</span>
</span><span id="line-11"><span class="cp">#define PWM_DEV DT_PWMS_CTLR(DT_ALIAS(peltier))</span>
</span><span id="line-12"><span class="cp">#define PWM_CHANNEL DT_PWMS_CHANNEL(DT_ALIAS(peltier))</span>
</span><span id="line-13">
</span><span id="line-14"><span class="c1">// Temperature sensor device name</span>
</span><span id="line-15"><span class="cp">#define TEMP_SENSOR_NAME "TEMP_SENSOR"</span>
</span><span id="line-16">
</span><span id="line-17"><span class="c1">// Default baseline temperature in Celsius</span>
</span><span id="line-18"><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">baseline_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"></span>
</span><span id="line-19">
</span><span id="line-20"><span class="c1">// PWM values for controlling Peltier power</span>
</span><span id="line-21"><span class="cp">#define MAX_PWM_VALUE 10000</span>
</span><span id="line-22"><span class="cp">#define MIN_PWM_VALUE 0</span>
</span><span id="line-23">
</span><span id="line-24"><span class="k">static</span><span class="w"> </span><span class="k">struct</span> <span class="nc">device</span><span class="w"> </span><span class="o">*</span><span class="n">pwm_dev</span><span class="p">;</span><span class="w"></span>
</span><span id="line-25"><span class="k">static</span><span class="w"> </span><span class="k">struct</span> <span class="nc">device</span><span class="w"> </span><span class="o">*</span><span class="n">temp_sensor_dev</span><span class="p">;</span><span class="w"></span>
</span><span id="line-26">
</span><span id="line-27"><span class="c1">// Bluetooth characteristic for baseline temperature setting</span>
</span><span id="line-28"><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bt_baseline_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"></span>
</span><span id="line-29">
</span><span id="line-30"><span class="k">static</span><span class="w"> </span><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">read_baseline_temp</span><span class="p">(</span><span class="k">struct</span> <span class="nc">bt_conn</span><span class="w"> </span><span class="o">*</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span> <span class="nc">bt_gatt_attr</span><span class="w"> </span><span class="o">*</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-31"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bt_gatt_attr_read</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bt_baseline_temp</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">bt_baseline_temp</span><span class="p">));</span><span class="w"></span>
</span><span id="line-32"><span class="p">}</span><span class="w"></span>
</span><span id="line-33">
</span><span id="line-34"><span class="k">static</span><span class="w"> </span><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">write_baseline_temp</span><span class="p">(</span><span class="k">struct</span> <span class="nc">bt_conn</span><span class="w"> </span><span class="o">*</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span> <span class="nc">bt_gatt_attr</span><span class="w"> </span><span class="o">*</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">flags</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-35"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">bt_baseline_temp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-36"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">BT_GATT_ERR</span><span class="p">(</span><span class="n">BT_ATT_ERR_INVALID_OFFSET</span><span class="p">);</span><span class="w"></span>
</span><span id="line-37"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-38">
</span><span id="line-39"><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bt_baseline_temp</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w"></span>
</span><span id="line-40"><span class="w">    </span><span class="n">baseline_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bt_baseline_temp</span><span class="p">;</span><span class="w">  </span><span class="c1">// Update baseline temperature</span>
</span><span id="line-41"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>
</span><span id="line-42"><span class="p">}</span><span class="w"></span>
</span><span id="line-43">
</span><span id="line-44"><span class="c1">// Bluetooth GATT service definition</span>
</span><span id="line-45"><span class="n">BT_GATT_SERVICE_DEFINE</span><span class="p">(</span><span class="n">temp_svc</span><span class="p">,</span><span class="w"></span>
</span><span id="line-46"><span class="w">    </span><span class="n">BT_GATT_PRIMARY_SERVICE</span><span class="p">(</span><span class="n">BT_UUID_DECLARE_16</span><span class="p">(</span><span class="mh">0x1809</span><span class="p">)),</span><span class="w"></span>
</span><span id="line-47"><span class="w">    </span><span class="n">BT_GATT_CHARACTERISTIC</span><span class="p">(</span><span class="n">BT_UUID_DECLARE_16</span><span class="p">(</span><span class="mh">0x2A1C</span><span class="p">),</span><span class="w"> </span><span class="n">BT_GATT_CHRC_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BT_GATT_CHRC_WRITE</span><span class="p">,</span><span class="w"></span>
</span><span id="line-48"><span class="w">        </span><span class="n">BT_GATT_PERM_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BT_GATT_PERM_WRITE</span><span class="p">,</span><span class="w"> </span><span class="n">read_baseline_temp</span><span class="p">,</span><span class="w"> </span><span class="n">write_baseline_temp</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bt_baseline_temp</span><span class="p">)</span><span class="w"></span>
</span><span id="line-49"><span class="p">);</span><span class="w"></span>
</span><span id="line-50">
</span><span id="line-51"><span class="c1">// Function to control the Peltier device</span>
</span><span id="line-52"><span class="kt">void</span><span class="w"> </span><span class="nf">control_peltier</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">current_temp</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">baseline_temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-53"><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">pwm_value</span><span class="p">;</span><span class="w"></span>
</span><span id="line-54">
</span><span id="line-55"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current_temp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">baseline_temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-56"><span class="w">        </span><span class="c1">// Cool down: activate Peltier</span>
</span><span id="line-57"><span class="w">        </span><span class="n">pwm_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">current_temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">baseline_temp</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w">  </span><span class="c1">// Scale value for PWM</span>
</span><span id="line-58"><span class="w">        </span><span class="n">pwm_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pwm_value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">MAX_PWM_VALUE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nl">MAX_PWM_VALUE</span> <span class="p">:</span><span class="w"> </span><span class="n">pwm_value</span><span class="p">;</span><span class="w"></span>
</span><span id="line-59"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-60"><span class="w">        </span><span class="c1">// Turn off Peltier</span>
</span><span id="line-61"><span class="w">        </span><span class="n">pwm_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MIN_PWM_VALUE</span><span class="p">;</span><span class="w"></span>
</span><span id="line-62"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-63">
</span><span id="line-64"><span class="w">    </span><span class="c1">// Apply PWM to Peltier device</span>
</span><span id="line-65"><span class="w">    </span><span class="n">pwm_pin_set_usec</span><span class="p">(</span><span class="n">pwm_dev</span><span class="p">,</span><span class="w"> </span><span class="n">PWM_CHANNEL</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_PWM_VALUE</span><span class="p">,</span><span class="w"> </span><span class="n">pwm_value</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-66"><span class="p">}</span><span class="w"></span>
</span><span id="line-67">
</span><span id="line-68"><span class="c1">// Main function to initialize and control temperature</span>
</span><span id="line-69"><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-70"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
</span><span id="line-71"><span class="w">    </span><span class="k">struct</span> <span class="nc">sensor_value</span><span class="w"> </span><span class="n">temp_val</span><span class="p">;</span><span class="w"></span>
</span><span id="line-72"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">current_temp</span><span class="p">;</span><span class="w"></span>
</span><span id="line-73">
</span><span id="line-74"><span class="w">    </span><span class="c1">// Initialize the PWM device for Peltier control</span>
</span><span id="line-75"><span class="w">    </span><span class="n">pwm_dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device_get_binding</span><span class="p">(</span><span class="n">PWM_DEV</span><span class="p">);</span><span class="w"></span>
</span><span id="line-76"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pwm_dev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-77"><span class="w">        </span><span class="n">printk</span><span class="p">(</span><span class="s">"Failed to bind PWM device</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-78"><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
</span><span id="line-79"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-80">
</span><span id="line-81"><span class="w">    </span><span class="c1">// Initialize the temperature sensor</span>
</span><span id="line-82"><span class="w">    </span><span class="n">temp_sensor_dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device_get_binding</span><span class="p">(</span><span class="n">TEMP_SENSOR_NAME</span><span class="p">);</span><span class="w"></span>
</span><span id="line-83"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">temp_sensor_dev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-84"><span class="w">        </span><span class="n">printk</span><span class="p">(</span><span class="s">"Failed to bind temperature sensor</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-85"><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
</span><span id="line-86"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-87">
</span><span id="line-88"><span class="w">    </span><span class="c1">// Enable Bluetooth</span>
</span><span id="line-89"><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bt_enable</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
</span><span id="line-90"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-91"><span class="w">        </span><span class="n">printk</span><span class="p">(</span><span class="s">"Bluetooth init failed (err %d)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
</span><span id="line-92"><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
</span><span id="line-93"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-94">
</span><span id="line-95"><span class="w">    </span><span class="n">printk</span><span class="p">(</span><span class="s">"Bluetooth initialized, baseline temp: %d°C</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">baseline_temp</span><span class="p">);</span><span class="w"></span>
</span><span id="line-96">
</span><span id="line-97"><span class="w">    </span><span class="c1">// Main loop to monitor temperature and control Peltier</span>
</span><span id="line-98"><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-99"><span class="w">        </span><span class="c1">// Fetch temperature from the sensor</span>
</span><span id="line-100"><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sensor_sample_fetch</span><span class="p">(</span><span class="n">temp_sensor_dev</span><span class="p">);</span><span class="w"></span>
</span><span id="line-101"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-102"><span class="w">            </span><span class="n">printk</span><span class="p">(</span><span class="s">"Failed to fetch temperature</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-103"><span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
</span><span id="line-104"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-105">
</span><span id="line-106"><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sensor_channel_get</span><span class="p">(</span><span class="n">temp_sensor_dev</span><span class="p">,</span><span class="w"> </span><span class="n">SENSOR_CHAN_AMBIENT_TEMP</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">temp_val</span><span class="p">);</span><span class="w"></span>
</span><span id="line-107"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-108"><span class="w">            </span><span class="n">printk</span><span class="p">(</span><span class="s">"Failed to get temperature</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-109"><span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
</span><span id="line-110"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-111">
</span><span id="line-112"><span class="w">        </span><span class="n">current_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sensor_value_to_double</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp_val</span><span class="p">);</span><span class="w"></span>
</span><span id="line-113"><span class="w">        </span><span class="n">printk</span><span class="p">(</span><span class="s">"Current Temp: %d°C, Baseline Temp: %d°C</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">current_temp</span><span class="p">,</span><span class="w"> </span><span class="n">baseline_temp</span><span class="p">);</span><span class="w"></span>
</span><span id="line-114">
</span><span id="line-115"><span class="w">        </span><span class="c1">// Control the Peltier device based on the current and baseline temperature</span>
</span><span id="line-116"><span class="w">        </span><span class="n">control_peltier</span><span class="p">(</span><span class="n">current_temp</span><span class="p">,</span><span class="w"> </span><span class="n">baseline_temp</span><span class="p">);</span><span class="w"></span>
</span><span id="line-117">
</span><span id="line-118"><span class="w">        </span><span class="c1">// Wait before the next iteration</span>
</span><span id="line-119"><span class="w">        </span><span class="n">k_sleep</span><span class="p">(</span><span class="n">K_SECONDS</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span><span class="w"></span>
</span><span id="line-120"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-121"><span class="p">}</span><span class="w"></span>
</span></pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <div class="project-section-break">
  </div>
 </div>
</div>
