<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css"><link rel="stylesheet" href="../custom.css"><div class="middle-column">
 <section id="overview">
  <h1 class="hckui__typography__h1" itemprop="name">
   Accessible Sewing Machine for Leg Impairment
  </h1>
  <p class="hckui__typography__bodyL hckui__layout__marginBottom15" itemprop="description">
   Modifying the sewing machine foot pedal to a hand pedal for individuals with disabilities affecting both legs.
  </p>
  <div class="hckui__layout__marginTop30">
   <div class="hckui__layout__hiddenMedUp">
   </div>
   <div class="project-cover-image" itemprop="image" itemscope="" itemtype="https://schema.org/ImageObject">
    <meta content="https://hackster.imgix.net/uploads/attachments/1754022/_FONQvk5Smt.blob?auto=compress&amp;w=900&amp;h=675&amp;fit=min&amp;fm=jpg" itemprop="url"/>
    <meta content="900" itemprop="width"/>
    <meta content="675" itemprop="height"/>
    <img alt="Accessible Sewing Machine for Leg Impairment" src="11.jpg"/>
   </div>
  </div>
 </section>
 <div class="project-section-break">
 </div>
 <div id="project_page_simple_ad_portal">
 </div>
 <div id="description" itemprop="articleBody">
  <section id="things">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Things used in this project
     </span>
    </h2>
   </div>
   <div class="project-parts">
    <div class="view-expanded" style="display:block">
     <table class="project-parts-table">
      <colgroup>
       <col style="width: 100px; height: 50px;"/>
       <col style="width: auto;"/>
      </colgroup>
      <tbody>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Hardware components
         </h3>
        </td>
        <tr>
         <td class="part-img">
          <img alt="nRF52 Development Kit" src="12.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1077653/nrf52-dk_f5l8pXEY68.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1077653/nrf52-dk_f5l8pXEY68.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Nordic Semiconductor nRF52 Development Kit","href":"/nordic-semiconductor/products/nrf52-development-kit?ref=project-2671ca","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/nordic-semiconductor/products/nrf52-development-kit?ref=project-2671ca">
           Nordic Semiconductor nRF52 Development Kit
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
         </td>
         <td class="hckui__typography__bodyL">
          DFRobot Flex Sensor 2.2
         </td>
        </tr>
        <tr>
         <td class="part-img">
         </td>
         <td class="hckui__typography__bodyL">
          Cytron Technologies BTS7960 43A High Power Motor Driver Module
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="PCBWay Custom PCB" src="13.jpg" srcset="https://hackster.imgix.net/uploads/attachments/561282/pcbway_QeHeggiIdG.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/561282/pcbway_QeHeggiIdG.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"PCBWay Custom PCB","href":"/pcbway/products/custom-pcb?ref=project-2671ca","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/pcbway/products/custom-pcb?ref=project-2671ca">
           PCBWay Custom PCB
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
         </td>
         <td class="hckui__typography__bodyL">
          Electric Linear Motor Actuator
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="Limit Switch, 5 A" src="14.jpg" srcset="https://hackster.imgix.net/uploads/attachments/836454/5112230.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/836454/5112230.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          Limit Switch, 5 A
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="60W PCIe 12V 5A Power Supply" src="15.jpg" srcset="https://hackster.imgix.net/uploads/attachments/229792/60W_Desktop_Power_Supply_obl_600__94390.1449790929.500.659.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/229792/60W_Desktop_Power_Supply_obl_600__94390.1449790929.500.659.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Digilent 60W PCIe 12V 5A Power Supply","href":"/digilent/products/60w-pcie-12v-5a-power-supply?ref=project-2671ca","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/digilent/products/60w-pcie-12v-5a-power-supply?ref=project-2671ca">
           Digilent 60W PCIe 12V 5A Power Supply
          </a>
         </td>
        </tr>
       </tr>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Software apps and online services
         </h3>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="nRF Connect SDK" src="16.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1255363/nrf-connect-sdk_on-white-bg_rgb_nNXqqs5PW6.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1255363/nrf-connect-sdk_on-white-bg_rgb_nNXqqs5PW6.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Nordic Semiconductor nRF Connect SDK","href":"/nordic-semiconductor/products/nrf-connect-sdk?ref=project-2671ca","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/nordic-semiconductor/products/nrf-connect-sdk?ref=project-2671ca">
          Nordic Semiconductor nRF Connect SDK
         </a>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="VS Code" src="17.jpg" srcset="https://hackster.imgix.net/uploads/attachments/673386/512px-visual_studio_code_1_18_icon_svg_k5OBc8o3Yk.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/673386/512px-visual_studio_code_1_18_icon_svg_k5OBc8o3Yk.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Microsoft VS Code","href":"/microsoft/products/vs-code?ref=project-2671ca","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/microsoft/products/vs-code?ref=project-2671ca">
          Microsoft VS Code
         </a>
        </td>
       </tr>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Hand tools and fabrication machines
         </h3>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Soldering iron (generic)" src="18.jpg" srcset="https://hackster.imgix.net/uploads/image/file/79853/09507-01.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/79853/09507-01.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         Soldering iron (generic)
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Solder Wire, Lead Free" src="19.jpg" srcset="https://hackster.imgix.net/uploads/attachments/842592/4966285.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/842592/4966285.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         Solder Wire, Lead Free
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Wire Stripper &amp; Cutter, 18-10 AWG / 0.75-4mm² Capacity Wires" src="20.jpg" srcset="https://hackster.imgix.net/uploads/attachments/842960/4158215.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/842960/4158215.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         Wire Stripper &amp; Cutter, 18-10 AWG / 0.75-4mm² Capacity Wires
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Multitool, Screwdriver" src="21.jpg" srcset="https://hackster.imgix.net/uploads/attachments/842469/26W6260-40.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/842469/26W6260-40.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         Multitool, Screwdriver
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="story">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Story
     </span>
    </h2>
   </div>
   <div class="project-story collapsible-section collapsed hljs-active hljs-monokai" itemprop="text">
    <p class="hckui__typography__bodyL">
     The situation of people with disabilities, their needs, and the barriers they face to participating fully in their societies is a critical issue. People with disabilities require the same essentials as those without disabilities. However, they often struggle to meet their needs due to difficulties in moving freely from place to place and the challenges of securing employment. Additionally, societal expectations often perceive individuals with disabilities as dependent and unable to fulfill their needs and wants through their own efforts. Therefore, modifying sewing machines presents an excellent opportunity for individuals with disabilities, particularly those with disabilities affecting both legs. Typically, sewing machines are operated by foot, and sewing work can be performed while sitting in one place, eliminating the need for movement.
    </p>
    <p class="hckui__typography__bodyL">
     The following few stories motivated me to do this project. This project aims to alter societal perceptions by modifying sewing machines to be hand-operated, thus enabling individuals with disabilities to work independently. By adopting the lower part of the sewing machine, which is typically foot-operated, to be hand-operated, people with disabilities can become self-sufficient. This change will help shift their status from dependent to independent, demonstrating that individuals with disabilities can contribute to society equally in terms of work, lifestyle, and meeting their needs and wants.
    </p>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/N6VJfjn7KKM?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <div class="carousel-images">
     <img class="carousel-image" src="0.jpg"/>
    </div>
    <div class="carousel-images">
     <img class="carousel-image" src="1.jpg"/>
    </div>
    <div class="carousel-images">
     <img class="carousel-image" src="2.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     Currently, all types of sewing machines require the use of legs for operation, making them inaccessible to individuals with leg disabilities. Our modified sewing machine is fully operated by hand and specifically designed for those with disabilities affecting both legs. This innovation will transform the lives of these individuals, increasing their productivity and integrating them into the garment industry, where the ability to sit for extended periods is beneficial.
    </p>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-hardware-connection-0">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Hardware Connection
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     Before explaining the hardware connections let me explain how the system works. All types of sewing machines have a pedal switch that is used to control the speed of the sewing machine. As leg impairments are unable to control the pedal switch my goal is to make a way that enables the disabled to maintain the pedal in other ways. I used a flex sensor and a linear actuator to control the pedal switch with a finger. The linear actuator pushes the pedal switch based on the bending of the flex sensor and indirectly controls the speed of the sewing machine. The nRF52840 is used here to control the linear actuator based on the flex sensor reading. As a microcontroller pin is not capable of sourcing or sinking the required amount of current of a linear actuator, a high-power motor driver is used to drive and control the direction of the actuator. A limit switch is used to protect the pedal switch from abnormal pressure from the actuator.
    </p>
    <p class="hckui__typography__bodyL">
     The following figure shows the complete connection among the hardware components.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="3.jpg"/>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-testing-and-writing-code-1">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Testing and Writing Code
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     I made a breadboard setup for testing the sensor and actuator. The sensor connection with nRF52840 is shown in the following image.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="4.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     The following values were recorded in the serial monitor without bending the sensor which is quite stable.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="5.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     The maximum voltage around 90-degree bending of the sensor was recorded as 2300mV. Based on the experimental value the code was written and the perfect pressure was achieved after multiple trials and errors. The code is attached in the code section and the complete project is provided with a GitHub link.
    </p>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-making-pcb-2">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Making PCB
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     After finishing the code development and testing the hardware connections I designed the schematic and PCB using EasyEDA. The schematic and the 3D view of the PCB are represented below.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="6.jpg"/>
    </div>
    <div class="carousel-images">
     <img class="carousel-image" src="7.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     The main components of the PCB are a few connectors. The motor driver, linear actuator, and flex sensor are not the components that can be directly assembled into the PCB. So, I used connectors to connect them with the nRF microcontroller.
    </p>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-setup-3">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Setup
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     I made a plywood frame and fixed the linear actuator with nuts, bolts, and zip ties.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="8.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     On the back side, I placed the motor driver and the nRF52840 board with a few screws.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="9.jpg"/>
     <img class="carousel-image" src="10.jpg"/>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-video-in-action-4">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Video In Action
     </span>
    </h3>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/lIjUnZU1rbw?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <p class="hckui__typography__bodyL">
    </p>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="schematics">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Schematics
     </span>
    </h2>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Connection Diagram
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="22.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       PCB Layout
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="23.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       PCB Schematic
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="24.jpg"/>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="code">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Code
     </span>
    </h2>
   </div>
   <div class="project-attachment project-code-widget single-file">
    <div class="tabs hckui__typography__bodyS">
     <ul>
      <li class="active">
       <a data-target="#code-widget-657109" href="javascript:void(0)">
        Code for nRF52480
       </a>
      </li>
     </ul>
    </div>
    <div class="preview-container">
     <div class="preview-pane active" id="code-widget-657109">
      <div class="header">
       <div class="text">
        <div class="title">
         <h3 class="hckui__typography__h3">
          Code for nRF52480
         </h3>
         <span class="hckui__typography__bodyS hckui__typography__pebble">
          C/C++
         </span>
        </div>
       </div>
      </div>
      <div class="preview-body pygments-syntax all">
       <div class="highlight">
        <pre><span></span><span id="line-1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;zephyr/kernel.h&gt;</span><span class="cp"></span>
</span><span id="line-2"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;zephyr/drivers/adc.h&gt;</span><span class="cp"></span>
</span><span id="line-3"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;hal/nrf_gpio.h&gt;</span><span class="cp"></span>
</span><span id="line-4">
</span><span id="line-5"><span class="cm">/* 1000 msec = 1 sec */</span><span class="w"></span>
</span><span id="line-6"><span class="cp">#define SLEEP_TIME_MS   1000</span>
</span><span id="line-7">
</span><span id="line-8"><span class="cp">#define ADC_NODE DT_NODELABEL(adc)</span>
</span><span id="line-9"><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span> <span class="nc">device</span><span class="w"> </span><span class="o">*</span><span class="n">adc_dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEVICE_DT_GET</span><span class="p">(</span><span class="n">ADC_NODE</span><span class="p">);</span><span class="w"></span>
</span><span id="line-10">
</span><span id="line-11"><span class="cp">#define ADC_RESOLUTION 10</span>
</span><span id="line-12"><span class="cp">#define ADC_CHANNEL    0</span>
</span><span id="line-13"><span class="cp">#define ADC_PORT       SAADC_CH_PSELN_PSELN_AnalogInput0  </span><span class="c1">//AIN0</span>
</span><span id="line-14"><span class="cp">#define ADC_REFERENCE  ADC_REF_INTERNAL                   </span><span class="c1">//0.6V</span>
</span><span id="line-15"><span class="cp">#define ADC_GAIN       ADC_GAIN_1_5                       </span><span class="c1">//ADC_REFERENCE*5</span>
</span><span id="line-16">
</span><span id="line-17"><span class="k">struct</span> <span class="nc">adc_channel_cfg</span><span class="w"> </span><span class="n">chl0_cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-18"><span class="w">	</span><span class="p">.</span><span class="n">gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADC_GAIN</span><span class="p">,</span><span class="w"></span>
</span><span id="line-19"><span class="w">	</span><span class="p">.</span><span class="n">reference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADC_REFERENCE</span><span class="p">,</span><span class="w"></span>
</span><span id="line-20"><span class="w">	</span><span class="p">.</span><span class="n">acquisition_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADC_ACQ_TIME_DEFAULT</span><span class="p">,</span><span class="w"></span>
</span><span id="line-21"><span class="w">	</span><span class="p">.</span><span class="n">channel_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADC_CHANNEL</span><span class="p">,</span><span class="w"></span>
</span><span id="line-22"><span class="cp">#ifdef CONFIG_ADC_NRFX_SAADC</span>
</span><span id="line-23"><span class="w">	</span><span class="p">.</span><span class="n">input_positive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADC_PORT</span><span class="w"></span>
</span><span id="line-24"><span class="cp">#endif</span>
</span><span id="line-25"><span class="p">};</span><span class="w"></span>
</span><span id="line-26">
</span><span id="line-27"><span class="kt">int16_t</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</span><span id="line-28">
</span><span id="line-29"><span class="k">struct</span> <span class="nc">adc_sequence</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-30"><span class="w">	</span><span class="cm">/* individual channels will be added below */</span><span class="w"></span>
</span><span id="line-31"><span class="w">	</span><span class="p">.</span><span class="n">channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BIT</span><span class="p">(</span><span class="n">ADC_CHANNEL</span><span class="p">),</span><span class="w"></span>
</span><span id="line-32"><span class="w">	</span><span class="p">.</span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">,</span><span class="w"></span>
</span><span id="line-33"><span class="w">	</span><span class="cm">/* buffer size in bytes, not number of samples */</span><span class="w"></span>
</span><span id="line-34"><span class="w">	</span><span class="p">.</span><span class="n">buffer_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">sample_buffer</span><span class="p">),</span><span class="w"></span>
</span><span id="line-35"><span class="w">	</span><span class="p">.</span><span class="n">resolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADC_RESOLUTION</span><span class="w"></span>
</span><span id="line-36"><span class="p">};</span><span class="w"></span>
</span><span id="line-37">
</span><span id="line-38">
</span><span id="line-39"><span class="cp">#define LED_GREEN NRF_GPIO_PIN_MAP(1, 10)</span>
</span><span id="line-40"><span class="cp">#define SPEED_INCREASE_PIN NRF_GPIO_PIN_MAP(1, 11)</span>
</span><span id="line-41"><span class="cp">#define SPEED_DECREASE_PIN NRF_GPIO_PIN_MAP(1, 12)</span>
</span><span id="line-42">
</span><span id="line-43"><span class="cp">#define LIMIT_BOTTOM NRF_GPIO_PIN_MAP(1, 3)</span>
</span><span id="line-44"><span class="cp">#define LIMIT_TOP NRF_GPIO_PIN_MAP(1, 4)</span>
</span><span id="line-45">
</span><span id="line-46">
</span><span id="line-47"><span class="cm">/*Function Prototype*/</span><span class="w"></span>
</span><span id="line-48"><span class="kt">void</span><span class="w"> </span><span class="nf">initialize_adc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
</span><span id="line-49"><span class="kt">int</span><span class="w"> </span><span class="nf">read_adc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
</span><span id="line-50">
</span><span id="line-51">
</span><span id="line-52">
</span><span id="line-53"><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
</span><span id="line-54"><span class="p">{</span><span class="w"></span>
</span><span id="line-55"><span class="w">	</span><span class="n">nrf_gpio_cfg_output</span><span class="p">(</span><span class="n">LED_GREEN</span><span class="p">);</span><span class="w"></span>
</span><span id="line-56"><span class="w">	</span><span class="n">nrf_gpio_cfg_output</span><span class="p">(</span><span class="n">SPEED_INCREASE_PIN</span><span class="p">);</span><span class="w"></span>
</span><span id="line-57"><span class="w">	</span><span class="n">nrf_gpio_cfg_output</span><span class="p">(</span><span class="n">SPEED_DECREASE_PIN</span><span class="p">);</span><span class="w"></span>
</span><span id="line-58">
</span><span id="line-59"><span class="w">	</span><span class="n">nrf_gpio_cfg_input</span><span class="p">(</span><span class="n">LIMIT_BOTTOM</span><span class="p">,</span><span class="w"> </span><span class="n">NRF_GPIO_PIN_PULLUP</span><span class="p">);</span><span class="w"></span>
</span><span id="line-60"><span class="w">	</span><span class="n">nrf_gpio_cfg_input</span><span class="p">(</span><span class="n">LIMIT_TOP</span><span class="p">,</span><span class="w"> </span><span class="n">NRF_GPIO_PIN_PULLUP</span><span class="p">);</span><span class="w"></span>
</span><span id="line-61"><span class="w"> </span>
</span><span id="line-62"><span class="w">    </span><span class="n">initialize_adc</span><span class="p">();</span><span class="w"></span>
</span><span id="line-63">
</span><span id="line-64"><span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">change_margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"> </span><span class="c1">//determinds the sensitivity of the sensor, find it after trial and error</span>
</span><span id="line-65"><span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1800</span><span class="p">;</span><span class="w">       </span><span class="c1">//reduce false trigger </span>
</span><span id="line-66"><span class="w">	</span>
</span><span id="line-67"><span class="w">	</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-68"><span class="w">		</span>
</span><span id="line-69"><span class="w">		</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">flex_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_adc</span><span class="p">();</span><span class="w"></span>
</span><span id="line-70">
</span><span id="line-71"><span class="w">		</span><span class="k">while</span><span class="p">(</span><span class="n">flex_value</span><span class="o">&gt;</span><span class="mi">1800</span><span class="p">){</span><span class="w"></span>
</span><span id="line-72">
</span><span id="line-73"><span class="w">			</span><span class="k">if</span><span class="p">((</span><span class="n">flex_value</span><span class="o">-</span><span class="n">count</span><span class="p">)</span><span class="o">&gt;</span><span class="n">change_margin</span><span class="p">){</span><span class="w"></span>
</span><span id="line-74"><span class="w">				</span><span class="kt">int</span><span class="w"> </span><span class="n">delay_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flex_value</span><span class="o">-</span><span class="n">count</span><span class="p">;</span><span class="w">  </span>
</span><span id="line-75"><span class="w">				</span><span class="n">nrf_gpio_pin_set</span><span class="p">(</span><span class="n">SPEED_INCREASE_PIN</span><span class="p">);</span><span class="w"></span>
</span><span id="line-76"><span class="w">				</span><span class="n">k_msleep</span><span class="p">(</span><span class="n">delay_count</span><span class="o">*</span><span class="mf">1.7</span><span class="p">);</span><span class="w"> </span><span class="c1">//depends on the speed of the linear actuator</span>
</span><span id="line-77"><span class="w">				</span><span class="c1">//printk("Delay count positive: %d.\n", delay_count);</span>
</span><span id="line-78"><span class="w">				</span><span class="n">nrf_gpio_pin_clear</span><span class="p">(</span><span class="n">SPEED_INCREASE_PIN</span><span class="p">);</span><span class="w"></span>
</span><span id="line-79"><span class="w">				</span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">delay_count</span><span class="p">;</span><span class="w"> </span>
</span><span id="line-80"><span class="w">				</span><span class="n">printk</span><span class="p">(</span><span class="s">"Count: %d.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w"></span>
</span><span id="line-81"><span class="w">			</span><span class="p">}</span><span class="w"></span>
</span><span id="line-82">
</span><span id="line-83"><span class="w">			</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">flex_value</span><span class="o">-</span><span class="n">count</span><span class="p">)</span><span class="o">&lt;-</span><span class="n">change_margin</span><span class="p">){</span><span class="w"></span>
</span><span id="line-84"><span class="w">				</span><span class="kt">int</span><span class="w"> </span><span class="n">delay_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">flex_value</span><span class="o">-</span><span class="n">count</span><span class="p">);</span><span class="w"></span>
</span><span id="line-85"><span class="w">				</span><span class="n">nrf_gpio_pin_set</span><span class="p">(</span><span class="n">SPEED_DECREASE_PIN</span><span class="p">);</span><span class="w"></span>
</span><span id="line-86"><span class="w">				</span><span class="n">k_msleep</span><span class="p">(</span><span class="n">delay_count</span><span class="o">*</span><span class="mf">1.7</span><span class="p">);</span><span class="w"></span>
</span><span id="line-87"><span class="w">				</span><span class="c1">//printk("Delay count negative: %d.\n", delay_count);</span>
</span><span id="line-88"><span class="w">				</span><span class="n">nrf_gpio_pin_clear</span><span class="p">(</span><span class="n">SPEED_DECREASE_PIN</span><span class="p">);</span><span class="w"></span>
</span><span id="line-89"><span class="w">				</span><span class="n">count</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">delay_count</span><span class="p">;</span><span class="w"> </span>
</span><span id="line-90"><span class="w">			</span><span class="p">}</span><span class="w"></span>
</span><span id="line-91">
</span><span id="line-92"><span class="w">			</span><span class="n">flex_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_adc</span><span class="p">();</span><span class="w"></span>
</span><span id="line-93">
</span><span id="line-94"><span class="w">		</span><span class="p">}</span><span class="w"></span>
</span><span id="line-95">
</span><span id="line-96"><span class="w">	</span><span class="p">}</span><span class="w"></span>
</span><span id="line-97"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-98"><span class="p">}</span><span class="w"></span>
</span><span id="line-99">
</span><span id="line-100">
</span><span id="line-101">
</span><span id="line-102"><span class="kt">void</span><span class="w"> </span><span class="nf">initialize_adc</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w"></span>
</span><span id="line-103"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>
</span><span id="line-104">
</span><span id="line-105"><span class="w">	</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">device_is_ready</span><span class="p">(</span><span class="n">adc_dev</span><span class="p">)){</span><span class="w"></span>
</span><span id="line-106"><span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">"adc_dev not ready</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-107"><span class="w">		</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
</span><span id="line-108"><span class="w">	</span><span class="p">}</span><span class="w"></span>
</span><span id="line-109">
</span><span id="line-110"><span class="w">	</span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adc_channel_setup</span><span class="p">(</span><span class="n">adc_dev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">chl0_cfg</span><span class="p">);</span><span class="w"></span>
</span><span id="line-111"><span class="w">	</span><span class="k">if</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-112"><span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">"adc_channel_setup failed with error %d.</span><span class="se">\n</span><span class="s">, err"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-113"><span class="w">		</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
</span><span id="line-114"><span class="w">	</span><span class="p">}</span><span class="w"></span>
</span><span id="line-115"><span class="p">}</span><span class="w"></span>
</span><span id="line-116">
</span><span id="line-117">
</span><span id="line-118"><span class="kt">int</span><span class="w"> </span><span class="nf">read_adc</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w"></span>
</span><span id="line-119"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adc_read</span><span class="p">(</span><span class="n">adc_dev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sequence</span><span class="p">);</span><span class="w"></span>
</span><span id="line-120"><span class="w">	</span><span class="k">if</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-121"><span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">"ADC reading failed with error %d.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
</span><span id="line-122"><span class="w">		</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
</span><span id="line-123"><span class="w">	</span><span class="p">}</span><span class="w"></span>
</span><span id="line-124">
</span><span id="line-125"><span class="w">	</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">mv_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</span><span id="line-126"><span class="w">	</span><span class="c1">//printk("ADC-raw: %d mV\n", mv_value);</span>
</span><span id="line-127"><span class="w">	</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">adc_vref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adc_ref_internal</span><span class="p">(</span><span class="n">adc_dev</span><span class="p">);</span><span class="w"></span>
</span><span id="line-128"><span class="w">	</span><span class="n">adc_raw_to_millivolts</span><span class="p">(</span><span class="n">adc_vref</span><span class="p">,</span><span class="w"> </span><span class="n">ADC_GAIN</span><span class="p">,</span><span class="w"> </span><span class="n">ADC_RESOLUTION</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mv_value</span><span class="p">);</span><span class="w"></span>
</span><span id="line-129"><span class="w">	</span><span class="c1">//printk("ADC-Spannung: %d mV\n", mv_value); </span>
</span><span id="line-130"><span class="w">	</span><span class="c1">//k_msleep(SLEEP_TIME_MS);</span>
</span><span id="line-131"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">mv_value</span><span class="p">;</span><span class="w">   </span>
</span><span id="line-132"><span class="p">}</span><span class="w"></span>
</span></pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Project GitHub
      </h3>
     </div>
    </div>
    <a href="https://github.com/taifur20/hand_sewing">
     Github
    </a>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <div class="project-section-break">
  </div>
 </div>
</div>
