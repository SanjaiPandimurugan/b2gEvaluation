<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css"><link rel="stylesheet" href="../custom.css"><div class="middle-column">
 <section id="overview">
  <h1 class="hckui__typography__h1" itemprop="name">
   Mobility Control Assistant
  </h1>
  <p class="hckui__typography__bodyL hckui__layout__marginBottom15" itemprop="description">
   A core device, which can be added to a wheelchair or strapped to the body, allowing control tailored to each user.
  </p>
  <div class="hckui__layout__marginTop30">
   <div class="hckui__layout__hiddenMedUp">
   </div>
   <div class="project-cover-image" itemprop="image" itemscope="" itemtype="https://schema.org/ImageObject">
    <meta content="https://hackster.imgix.net/uploads/attachments/1756298/_bq6aapYGOO.blob?auto=compress&amp;w=900&amp;h=675&amp;fit=min&amp;fm=jpg" itemprop="url"/>
    <meta content="900" itemprop="width"/>
    <meta content="675" itemprop="height"/>
    <img alt="Mobility Control Assistant" src="9.jpg"/>
   </div>
  </div>
 </section>
 <div class="project-section-break">
 </div>
 <div id="project_page_simple_ad_portal">
 </div>
 <div id="description" itemprop="articleBody">
  <section id="things">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Things used in this project
     </span>
    </h2>
   </div>
   <div class="project-parts">
    <div class="view-expanded" style="display:block">
     <table class="project-parts-table">
      <colgroup>
       <col style="width: 100px; height: 50px;"/>
       <col style="width: auto;"/>
      </colgroup>
      <tbody>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Hardware components
         </h3>
        </td>
        <tr>
         <td class="part-img">
          <img alt="nRF52 Development Kit" src="10.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1077653/nrf52-dk_f5l8pXEY68.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1077653/nrf52-dk_f5l8pXEY68.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Nordic Semiconductor nRF52 Development Kit","href":"/nordic-semiconductor/products/nrf52-development-kit?ref=project-6c3047","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/nordic-semiconductor/products/nrf52-development-kit?ref=project-6c3047">
           Nordic Semiconductor nRF52 Development Kit
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="AtomS3" src="11.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1541394/1_qfVJx5inAr.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1541394/1_qfVJx5inAr.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"M5Stack AtomS3","href":"/m5stack/products/atoms3?ref=project-6c3047","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/m5stack/products/atoms3?ref=project-6c3047">
           M5Stack AtomS3
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="Seeed Studio XIAO ESP32S3 Sense" src="12.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1650360/screenshot_2023-11-20_at_17_16_09_QdLoLAbseq.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1650360/screenshot_2023-11-20_at_17_16_09_QdLoLAbseq.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Seeed Studio XIAO ESP32S3 Sense","href":"/seeed/products/seeed-studio-xiao-esp32s3-sense?ref=project-6c3047","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/seeed/products/seeed-studio-xiao-esp32s3-sense?ref=project-6c3047">
           Seeed Studio XIAO ESP32S3 Sense
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="UNIHIKER - IoT Python Programming Single Board Computer with Touchscreen" src="13.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1623050/9924dc25f8a8d36cae2ea2becac95b77_Bn8OXLjRQw.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1623050/9924dc25f8a8d36cae2ea2becac95b77_Bn8OXLjRQw.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"DFRobot UNIHIKER - IoT Python Programming Single Board Computer with Touchscreen","href":"/dfrobot/products/unihiker-iot-python-programming-single-board-computer-with-touchscreen1?ref=project-6c3047","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/dfrobot/products/unihiker-iot-python-programming-single-board-computer-with-touchscreen1?ref=project-6c3047">
           DFRobot UNIHIKER - IoT Python Programming Single Board Computer with Touchscreen
          </a>
         </td>
        </tr>
       </tr>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Software apps and online services
         </h3>
        </td>
       </tr>
       <tr>
        <td class="part-img">
        </td>
        <td class="hckui__typography__bodyL">
         CircuitPython
        </td>
       </tr>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Hand tools and fabrication machines
         </h3>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="3D Printer (generic)" src="14.jpg" srcset="https://hackster.imgix.net/uploads/image/file/79855/3Drag.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/79855/3Drag.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         3D Printer (generic)
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="story">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Story
     </span>
    </h2>
   </div>
   <div class="project-story collapsible-section collapsed hljs-active hljs-monokai" itemprop="text">
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-improved-motion-control-0">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Improved Motion Control
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     <span>
      My goal for the
     </span>
     <strong>
      BUILD2GETHER 2.0
     </strong>
     <span>
      was to make a device with customisable motion and I succeeded!
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     This device can be tailored to the user, whether it be someone who suffers from tremors or has limited dexterity.
    </p>
    <p class="hckui__typography__bodyL">
     Some the the Examples are:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      The minimum motion can be set to ignore any spasms or tremors, by setting the increments for motion.
     </li>
     <li>
      The minimum and maximum values can be set to choose how much motion to register or set the maximum movement speed when gaming or controlling a motorised chair.
     </li>
     <li>
      The deadband option allow you to specify the movement required to start registering. This can also be use in combination with the min/max to use the joystick like a direction pad and only register movement at the extremes.
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-my-process-1">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      My Process
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     <span>
      The first thing I researched was the best hardware solution to make this device work well and be scalable. After extensive research I decided that the nrf52 devices would have the best battery life and the ESP32 is the most common, so I decided to make my solution non hardware specific. I set out to find the most adaptable coding language and decided on
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"CircuitPython","href":"https://circuitpython.org/","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://circuitpython.org/" rel="nofollow">
      CircuitPython
     </a>
     <span>
      . It is easily customisable, you can find libraries for most hardware and they are easy to add.
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     I spent about 4 hours, over 2 days figuring out how to add CircuitPython to the Nordic Semiconductor's nRF52840 DK
    </p>
    <p class="hckui__typography__bodyL">
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"https://learn.adafruit.com/circuitpython-on-the-nrf52?view=all","href":"https://learn.adafruit.com/circuitpython-on-the-nrf52?view=all","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://learn.adafruit.com/circuitpython-on-the-nrf52?view=all" rel="nofollow">
      https://learn.adafruit.com/circuitpython-on-the-nrf52?view=all
     </a>
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="0.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     Once I had that working, I tested several libraries to decide on the controls and landed on the JoystickXL library because you can add multiple controls and program how they work.
    </p>
    <p class="hckui__typography__bodyL">
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"https://github.com/fasteddy516/CircuitPython_JoystickXL","href":"https://github.com/fasteddy516/CircuitPython_JoystickXL","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://github.com/fasteddy516/CircuitPython_JoystickXL" rel="nofollow">
      https://github.com/fasteddy516/CircuitPython_JoystickXL
     </a>
    </p>
    <p class="hckui__typography__bodyL">
     I then proceeded to get the 6-Axis IMU Unit(MPU6886) working as a joystick and how to customise the reactions.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="1.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     My aim was to allow for the following motion option customisations:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Sampling Rate (Delay) - Allows for setting how often to take movements and remove jitter.
     </li>
     <li>
      Range of Motion (Distance) - Using a minimum and maximum value allowed the range of motion to be defined.
     </li>
     <li>
      Dead Band (Zero Center Range) - This is used to set how far from the middle movement is needed to start registering.
     </li>
     <li>
      Minimum Change (Delta) - This was the most useful setting! It allows the user to set how smooth the motion is, based on the registered increments.
     </li>
     <li>
      Relative Motion (Standard Joystick) or Change in Motion (Only move based on force in a direction)
     </li>
     <li>
      D-Pad or Hat Motion (Extremes only and would act like a D-Pad)
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     Ultimate goal would be to be able to predict motion, based on previous interactions and allow the user to only need to specify changes or other motions.
    </p>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/tbvet0j3BB4?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <p class="hckui__typography__bodyL">
     I also connected an I2C Thumbstick joystick to experiment with the customisations and prove the ability to add unique customisations. The code detects the thumbstick and includes it as additional axis. The thumbstick button is also added.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="2.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     Next was a simple interface to change the customisations. I opted to switch to the ESP32S3 as this allows for a HTML interface to be set up.
    </p>
    <p class="hckui__typography__bodyL">
     I set the ESP32S3 into AP mode, so the device can be connected to anyware and reprogrammed.
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      The connection credential are:
     </span>
     <br/>
     <span>
      SSID: MC
     </span>
     <br/>
     <span>
      Password: 'helpmemove'
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      Then you just need to browse to
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"192.168.4.1:5000","href":"http://192.168.4.1:5000","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="http://192.168.4.1:5000" rel="nofollow">
      192.168.4.1:5000
     </a>
     <span>
      , as shown on the display:
     </span>
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="3.jpg"/>
     <img class="carousel-image" src="4.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     As suggested by the contest master for the BUILD2GETHER 2.0 competition, I also worked on designs for mounting the devices to a wheelchair and attachments for limbs, with the ability to got between.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="5.jpg"/>
     <img class="carousel-image" src="6.jpg"/>
     <img class="carousel-image" src="7.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     I also experimented with the XIAO ESP32S3 + Grove Shield because you can add lots of options with the big shield. The onboard camera could also be used for face or object tracking, as an added function.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="8.jpg"/>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-conclusion-2">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Conclusion
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     <span>
      Any of these devices could be used to interact with smart home devices or other helpful things, like adjusting settings on wheelchairs. The code has been written in
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"CircuitPython","href":"https://circuitpython.org/","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://circuitpython.org/" rel="nofollow">
      CircuitPython
     </a>
     <span>
      , so lots of libraries are available. This device could also be paired with a
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Raspberry Pi","href":"https://www.raspberrypi.com/","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://www.raspberrypi.com/" rel="nofollow">
      Raspberry Pi
     </a>
     <span>
      , running
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"NodeRed","href":"https://nodered.org/","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://nodered.org/" rel="nofollow">
      NodeRed
     </a>
     <span>
      or
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"openHAB","href":"https://www.openhab.org/","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://www.openhab.org/" rel="nofollow">
      openHAB
     </a>
     <span>
      to trigger any actions imaginable!
     </span>
    </p>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="cad">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Custom parts and enclosures
     </span>
    </h2>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Mobility Gaming Aid
      </h3>
      <div class="hckui__typography__bodyS hckui__typography__pebble">
       Mounts to use the device on a wheelchair or attache to a limb
      </div>
     </div>
    </div>
    <a href="https://github.com/djbazza/Mobility-Gaming-Aid">
     Github
    </a>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="schematics">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Schematics
     </span>
    </h2>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       M5Stack ATOMS3 Wiring
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="15.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Nordic nRF52840 DK Wiring
      </h3>
      <div class="hckui__typography__bodyS hckui__typography__pebble">
       This is how you can wire modules to Nordic Semiconductor's nRF52840 DK
      </div>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="16.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Seeed Studio XIAO ESP32S3 Sense + Grove Shield Wiring
      </h3>
      <div class="hckui__typography__bodyS hckui__typography__pebble">
       This is how you can use Seeed Studio's kit (XIAO ESP32S3 Sense + Grove Shield for Xiao)
      </div>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="17.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       DFRobot Unihiker
      </h3>
      <div class="hckui__typography__bodyS hckui__typography__pebble">
       Just plug in the DFRobot UNIHIKER and you are good to go.
      </div>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="18.jpg"/>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="code">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Code
     </span>
    </h2>
   </div>
   <div class="project-attachment project-code-widget">
    <div class="tabs hckui__typography__bodyS">
     <ul>
      <li class="active">
       <a data-target="#code-widget-657615" href="javascript:void(0)">
        Main code for the device
       </a>
      </li>
      <li>
       <a data-target="#code-widget-657616" href="javascript:void(0)">
        Boot File
       </a>
      </li>
     </ul>
    </div>
    <div class="preview-container">
     <div class="preview-pane active" id="code-widget-657615">
      <div class="header">
       <div class="text">
        <div class="title">
         <h3 class="hckui__typography__h3">
          Main code for the device
         </h3>
         <span class="hckui__typography__bodyS hckui__typography__pebble">
          MicroPython
         </span>
        </div>
        <div class="comment">
         <div class="hckui__typography__bodyS hckui__typography__pebble">
          This is the code.py file for use in CircuitPython
         </div>
        </div>
       </div>
      </div>
      <div class="preview-body pygments-syntax all">
       <div class="highlight">
        <pre><span></span><span id="line-1"><span class="c1"># SPDX-FileCopyrightText: 2024 Micha≈Ç Pokusa</span>
</span><span id="line-2"><span class="c1">#</span>
</span><span id="line-3"><span class="c1"># SPDX-License-Identifier: Unlicense</span>
</span><span id="line-4">
</span><span id="line-5"><span class="kn">import</span> <span class="nn">socketpool</span>
</span><span id="line-6"><span class="kn">import</span> <span class="nn">wifi</span>
</span><span id="line-7"><span class="kn">import</span> <span class="nn">board</span>
</span><span id="line-8"><span class="kn">import</span> <span class="nn">time</span>
</span><span id="line-9"><span class="kn">import</span> <span class="nn">busio</span>
</span><span id="line-10"><span class="kn">from</span> <span class="nn">adafruit_bus_device.i2c_device</span> <span class="kn">import</span> <span class="n">I2CDevice</span>
</span><span id="line-11"><span class="kn">from</span> <span class="nn">mpu6886</span> <span class="kn">import</span> <span class="n">MPU6886</span>
</span><span id="line-12"><span class="kn">import</span> <span class="nn">struct</span>
</span><span id="line-13"><span class="kn">import</span> <span class="nn">busio</span>  <span class="c1"># type: ignore (This too!)</span>
</span><span id="line-14"><span class="kn">from</span> <span class="nn">joystick_xl.inputs</span> <span class="kn">import</span> <span class="n">Axis</span><span class="p">,</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Hat</span>
</span><span id="line-15"><span class="kn">from</span> <span class="nn">joystick_xl.joystick</span> <span class="kn">import</span> <span class="n">Joystick</span>
</span><span id="line-16"><span class="kn">from</span> <span class="nn">joystick</span> <span class="kn">import</span> <span class="n">JoystickUnit</span>
</span><span id="line-17">
</span><span id="line-18"><span class="kn">from</span> <span class="nn">adafruit_httpserver</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">Route</span><span class="p">,</span> <span class="n">as_route</span><span class="p">,</span> <span class="n">REQUEST_HANDLED_RESPONSE_SENT</span><span class="p">,</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">GET</span><span class="p">,</span> <span class="n">POST</span>
</span><span id="line-19">
</span><span id="line-20"><span class="n">AP_SSID</span> <span class="o">=</span> <span class="s2">"MC"</span>
</span><span id="line-21"><span class="n">AP_PASSWORD</span> <span class="o">=</span> <span class="s2">"helpmemove"</span>
</span><span id="line-22">
</span><span id="line-23"><span class="nb">print</span><span class="p">(</span><span class="s2">"Creating access point..."</span><span class="p">)</span>
</span><span id="line-24"><span class="n">wifi</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">start_ap</span><span class="p">(</span><span class="n">ssid</span><span class="o">=</span><span class="n">AP_SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">AP_PASSWORD</span><span class="p">)</span>
</span><span id="line-25"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Created access point </span><span class="si">{</span><span class="n">AP_SSID</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-26">
</span><span id="line-27"><span class="n">pool</span> <span class="o">=</span> <span class="n">socketpool</span><span class="o">.</span><span class="n">SocketPool</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">radio</span><span class="p">)</span>
</span><span id="line-28"><span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s2">"/static"</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-29">
</span><span id="line-30"><span class="n">sampling_ms</span> <span class="o">=</span> <span class="mi">150</span>
</span><span id="line-31"><span class="n">minChange</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="line-32">
</span><span id="line-33"><span class="c1"># Axis configuration constants</span>
</span><span id="line-34"><span class="n">AXIS_DB</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="line-35"><span class="n">AXIS_MIN</span> <span class="o">=</span> <span class="o">-</span><span class="mi">255</span>  <span class="c1"># Minimum raw axis value.</span>
</span><span id="line-36"><span class="n">AXIS_MAX</span> <span class="o">=</span> <span class="mi">255</span> <span class="c1"># Maximum raw axis value.</span>
</span><span id="line-37"><span class="n">factor</span> <span class="o">=</span> <span class="mi">25</span>
</span><span id="line-38">
</span><span id="line-39"><span class="c1"># Axis configuration constants</span>
</span><span id="line-40"><span class="n">THUMB_MIN</span> <span class="o">=</span> <span class="o">-</span><span class="mi">128</span>  <span class="c1"># Minimum raw axis value.</span>
</span><span id="line-41"><span class="n">THUMB_MAX</span> <span class="o">=</span> <span class="mi">128</span> <span class="c1"># Maximum raw axis value.</span>
</span><span id="line-42"><span class="n">THUMB_DB</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Deadband to apply to axis center points.</span>
</span><span id="line-43">
</span><span id="line-44"><span class="c1"># IMU6866 define</span>
</span><span id="line-45"><span class="n">MPU6886_ADDRESS</span><span class="o">=</span><span class="mh">0x68</span>
</span><span id="line-46">
</span><span id="line-47"><span class="n">i2c</span> <span class="o">=</span> <span class="n">busio</span><span class="o">.</span><span class="n">I2C</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">IMU_SCL</span><span class="p">,</span> <span class="n">board</span><span class="o">.</span><span class="n">IMU_SDA</span><span class="p">)</span>
</span><span id="line-48"><span class="n">i2c2</span> <span class="o">=</span> <span class="n">busio</span><span class="o">.</span><span class="n">I2C</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">D1</span><span class="p">,</span> <span class="n">board</span><span class="o">.</span><span class="n">D2</span><span class="p">)</span> <span class="o">//</span><span class="n">An</span> <span class="n">I2C</span> <span class="n">device</span> <span class="n">must</span> <span class="n">be</span> <span class="n">plugged</span> <span class="ow">in</span> <span class="ow">or</span> <span class="n">pullups</span> <span class="n">added</span>
</span><span id="line-49"><span class="n">imu</span> <span class="o">=</span> <span class="n">I2CDevice</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">MPU6886_ADDRESS</span><span class="p">)</span>
</span><span id="line-50"><span class="n">lcd</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">DISPLAY</span>
</span><span id="line-51"><span class="n">jhat</span> <span class="o">=</span> <span class="s2">""</span>
</span><span id="line-52"><span class="k">assert</span> <span class="n">i2c2</span><span class="o">.</span><span class="n">try_lock</span><span class="p">()</span>
</span><span id="line-53"><span class="k">if</span> <span class="mh">0x52</span> <span class="ow">in</span> <span class="n">i2c2</span><span class="o">.</span><span class="n">scan</span><span class="p">():</span>
</span><span id="line-54">    <span class="n">i2c2</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
</span><span id="line-55">    <span class="n">jhat</span> <span class="o">=</span> <span class="n">JoystickUnit</span><span class="p">(</span><span class="n">i2c2</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">)</span>
</span><span id="line-56">    <span class="n">jhat</span><span class="o">.</span><span class="n">swap_x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="line-57">
</span><span id="line-58"><span class="n">sensor</span> <span class="o">=</span> <span class="n">MPU6886</span><span class="p">(</span><span class="n">i2c</span><span class="p">)</span>
</span><span id="line-59">
</span><span id="line-60"><span class="n">hotas</span> <span class="o">=</span> <span class="n">Joystick</span><span class="p">()</span>
</span><span id="line-61">
</span><span id="line-62"><span class="n">hotas</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span>
</span><span id="line-63">    <span class="n">Button</span><span class="p">(),</span>
</span><span id="line-64">    <span class="n">Axis</span><span class="p">(</span><span class="n">deadband</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">255</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">255</span><span class="p">),</span>
</span><span id="line-65">    <span class="n">Axis</span><span class="p">(</span><span class="n">deadband</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">255</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">255</span><span class="p">),</span>
</span><span id="line-66">    <span class="n">Axis</span><span class="p">(</span><span class="n">deadband</span><span class="o">=</span><span class="n">THUMB_DB</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">THUMB_MIN</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">THUMB_MAX</span><span class="p">),</span>
</span><span id="line-67">    <span class="n">Axis</span><span class="p">(</span><span class="n">deadband</span><span class="o">=</span><span class="n">THUMB_DB</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">THUMB_MIN</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">THUMB_MAX</span><span class="p">),</span>
</span><span id="line-68"><span class="p">)</span>
</span><span id="line-69">
</span><span id="line-70">
</span><span id="line-71"><span class="n">FORM_HTML_TEMPLATE</span> <span class="o">=</span> <span class="s2">"""</span>
</span><span id="line-72"><span class="s2">&lt;html lang="en"&gt;</span>
</span><span id="line-73"><span class="s2">    &lt;head&gt;</span>
</span><span id="line-74"><span class="s2">        &lt;title&gt;Form with </span><span class="si">{enctype}</span><span class="s2"> enctype&lt;/title&gt;</span>
</span><span id="line-75"><span class="s2">    &lt;/head&gt;</span>
</span><span id="line-76"><span class="s2">    &lt;body&gt;</span>
</span><span id="line-77"><span class="s2">        &lt;h2&gt;Please adjust the Joystick Settings&lt;/h2&gt;</span>
</span><span id="line-78"><span class="s2">        &lt;form action="/form" method="post" enctype="</span><span class="si">{enctype}</span><span class="s2">"&gt;</span>
</span><span id="line-79"><span class="s2">            &lt;p&gt;Sample Rate (ms): &lt;span id="sV"&gt;</span><span class="si">{SampleVal}</span><span class="s2">&lt;/span&gt; &lt;/p&gt;</span>
</span><span id="line-80"><span class="s2">            &lt;input type="range" min="10" max="500" value="</span><span class="si">{SampleVal}</span><span class="s2">" id="Sample" name="Sample"&gt;</span>
</span><span id="line-81"><span class="s2">            &lt;p&gt;Minimum Range:&lt;span&gt;</span><span class="si">{MinValDisp}</span><span class="s2">&lt;/span&gt;&lt;/p&gt;</span>
</span><span id="line-82"><span class="s2">            &lt;input type="range" min="-255" max="255" value="</span><span class="si">{MinValDisp}</span><span class="s2">" id="MinVal" name="MinVal"&gt;</span>
</span><span id="line-83"><span class="s2">            &lt;p&gt;Maximum Range:&lt;span&gt;</span><span class="si">{MaxValDisp}</span><span class="s2">&lt;/span&gt;&lt;/p&gt;</span>
</span><span id="line-84"><span class="s2">            &lt;input type="range" min="-255" max="255" value="</span><span class="si">{MaxValDisp}</span><span class="s2">" id="MaxVal" name="MaxVal"&gt;</span>
</span><span id="line-85"><span class="s2">            &lt;p&gt;Minimum Motion Change:&lt;span id="ra"&gt;</span><span class="si">{ChangeVal}</span><span class="s2">&lt;/span&gt;&lt;/p&gt;</span>
</span><span id="line-86"><span class="s2">            &lt;input type="range" min="1" max="50" value="</span><span class="si">{ChangeVal}</span><span class="s2">" id="Change" name="Change"&gt;</span>
</span><span id="line-87"><span class="s2">            &lt;p&gt;Set Deadband:&lt;span id="dB"&gt;</span><span class="si">{DeadbandVal}</span><span class="s2">&lt;/span&gt;&lt;/p&gt;</span>
</span><span id="line-88"><span class="s2">            &lt;input type="range" min="0" max="100" value="</span><span class="si">{DeadbandVal}</span><span class="s2">" id="Deadband" name="Deadband"&gt;</span>
</span><span id="line-89"><span class="s2">            &lt;p&gt;Motion Options&lt;/p&gt;</span>
</span><span id="line-90"><span class="s2">            &lt;input type="radio" name="Motion" id="RelativeMotion" value="RelativeMotion" checked="checked"&gt; Relative Motion</span>
</span><span id="line-91"><span class="s2">            &lt;input type="radio" name="Motion" id="ChangeInMotion" value="ChangeInMotion"&gt; Change in Motion&lt;br&gt;</span>
</span><span id="line-92"><span class="s2">            &lt;br&gt;&lt;input type="submit" value="Submit"&gt;</span>
</span><span id="line-93"><span class="s2">        &lt;/form&gt;</span>
</span><span id="line-94"><span class="s2">        </span><span class="si">{submitted_value}</span><span class="s2"></span>
</span><span id="line-95"><span class="s2">    &lt;/body&gt;</span>
</span><span id="line-96"><span class="s2">&lt;/html&gt;</span>
</span><span id="line-97"><span class="s2">"""</span>
</span><span id="line-98">
</span><span id="line-99">
</span><span id="line-100"><span class="nd">@server</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="p">[</span><span class="n">GET</span><span class="p">,</span> <span class="n">POST</span><span class="p">])</span>
</span><span id="line-101"><span class="k">def</span> <span class="nf">form</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
</span><span id="line-102">    <span class="sd">"""</span>
</span><span id="line-103"><span class="sd">    Serve a form with the given enctype, and display back the submitted value.</span>
</span><span id="line-104"><span class="sd">    """</span>
</span><span id="line-105">    <span class="k">global</span> <span class="n">sampling_ms</span>
</span><span id="line-106">    <span class="k">global</span> <span class="n">AXIS_MIN</span> <span class="c1"># Minimum raw axis value.</span>
</span><span id="line-107">    <span class="k">global</span> <span class="n">AXIS_MAX</span> <span class="c1"># Maximum raw axis value.</span>
</span><span id="line-108">    <span class="k">global</span> <span class="n">AXIS_DB</span> <span class="c1"># Deadband Change minimum.</span>
</span><span id="line-109">    <span class="k">global</span> <span class="n">minChange</span>
</span><span id="line-110">    <span class="n">enctype</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"enctype"</span><span class="p">,</span> <span class="s2">"text/plain"</span><span class="p">)</span>
</span><span id="line-111">
</span><span id="line-112">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">POST</span><span class="p">:</span>
</span><span id="line-113">        <span class="n">sampling_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Sample"</span><span class="p">))</span>
</span><span id="line-114">        <span class="n">AXIS_MIN</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"MinVal"</span><span class="p">))</span>
</span><span id="line-115">        <span class="n">AXIS_MAX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"MaxVal"</span><span class="p">))</span>
</span><span id="line-116">        <span class="n">minChange</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Change"</span><span class="p">))</span>
</span><span id="line-117">        <span class="n">AXIS_DB</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Deadband"</span><span class="p">))</span>
</span><span id="line-118">        <span class="n">posted_Motion</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Motion"</span><span class="p">)</span>
</span><span id="line-119">
</span><span id="line-120">    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
</span><span id="line-121">        <span class="n">request</span><span class="p">,</span>
</span><span id="line-122">        <span class="n">FORM_HTML_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="line-123">            <span class="n">enctype</span><span class="o">=</span><span class="n">enctype</span><span class="p">,</span>
</span><span id="line-124">            <span class="n">submitted_value</span><span class="o">=</span><span class="p">(</span>
</span><span id="line-125">                <span class="s2">"&lt;h3&gt;Updated&lt;/h3&gt;"</span>
</span><span id="line-126">                <span class="c1"># f"&lt;h3&gt;Submitted form Sample: {sampling_ms}ms&lt;/h3&gt;\n&lt;h3&gt;Submitted form Range: {minChange}&lt;/h3&gt;\n&lt;h3&gt;Submitted form Deadband: {posted_Deadband}&lt;/h3&gt;\n&lt;h3&gt;Submitted form motion: {posted_Motion}&lt;/h3&gt;"</span>
</span><span id="line-127">                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">POST</span>
</span><span id="line-128">                <span class="k">else</span> <span class="s2">""</span>
</span><span id="line-129">            <span class="p">),</span>
</span><span id="line-130">            <span class="n">MinValDisp</span><span class="o">=</span><span class="p">(</span>
</span><span id="line-131">                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">AXIS_MIN</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-132">                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">POST</span>
</span><span id="line-133">                <span class="k">else</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">AXIS_MIN</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-134">            <span class="p">),</span>
</span><span id="line-135">            <span class="n">MaxValDisp</span><span class="o">=</span><span class="p">(</span>
</span><span id="line-136">                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">AXIS_MAX</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-137">                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">POST</span>
</span><span id="line-138">                <span class="k">else</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">AXIS_MAX</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-139">            <span class="p">),</span>
</span><span id="line-140">            <span class="n">SampleVal</span><span class="o">=</span><span class="p">(</span>
</span><span id="line-141">                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">sampling_ms</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-142">                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">POST</span>
</span><span id="line-143">                <span class="k">else</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">sampling_ms</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-144">            <span class="p">),</span>
</span><span id="line-145">            <span class="n">ChangeVal</span><span class="o">=</span><span class="p">(</span>
</span><span id="line-146">                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">minChange</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-147">                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">POST</span>
</span><span id="line-148">                <span class="k">else</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">minChange</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-149">            <span class="p">),</span>
</span><span id="line-150">            <span class="n">DeadbandVal</span><span class="o">=</span><span class="p">(</span>
</span><span id="line-151">                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">AXIS_DB</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-152">                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">POST</span>
</span><span id="line-153">                <span class="k">else</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">AXIS_DB</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-154">            <span class="p">),</span>
</span><span id="line-155">        <span class="p">),</span>
</span><span id="line-156">        <span class="n">content_type</span><span class="o">=</span><span class="s2">"text/html"</span><span class="p">,</span>
</span><span id="line-157">    <span class="p">)</span>
</span><span id="line-158">
</span><span id="line-159">
</span><span id="line-160"><span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">ipv4_address_ap</span><span class="p">))</span>
</span><span id="line-161">
</span><span id="line-162"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="line-163">
</span><span id="line-164">    <span class="k">try</span><span class="p">:</span>
</span><span id="line-165">        <span class="n">gyro_array</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">.</span><span class="n">gyro</span><span class="p">()</span>
</span><span id="line-166">        <span class="n">accel_array</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">.</span><span class="n">acceleration</span><span class="p">()</span>
</span><span id="line-167">        <span class="n">DB</span> <span class="o">=</span> <span class="n">AXIS_MIN</span> <span class="o">+</span> <span class="p">(</span><span class="n">AXIS_MAX</span> <span class="o">-</span> <span class="n">AXIS_MIN</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="line-168">        <span class="n">X</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">accel_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">factor</span><span class="p">)</span>
</span><span id="line-169">        <span class="k">if</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="n">AXIS_MIN</span> <span class="ow">and</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="n">AXIS_MAX</span><span class="p">:</span>
</span><span id="line-170">            <span class="k">if</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="n">DB</span><span class="o">-</span><span class="n">AXIS_DB</span> <span class="ow">and</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="n">DB</span><span class="o">+</span><span class="n">AXIS_DB</span><span class="p">:</span>
</span><span id="line-171">                <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="mi">125</span>
</span><span id="line-172">            <span class="c1"># print(f"X: {X}")</span>
</span><span id="line-173">            <span class="k">elif</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">-</span> <span class="n">minChange</span> <span class="ow">or</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">+</span> <span class="n">minChange</span><span class="p">:</span>
</span><span id="line-174">                <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="line-175">        <span class="n">Y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">accel_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">factor</span><span class="p">)</span>
</span><span id="line-176">        <span class="k">if</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="n">AXIS_MIN</span> <span class="ow">and</span> <span class="n">Y</span> <span class="o">&lt;</span> <span class="n">AXIS_MAX</span><span class="p">:</span>
</span><span id="line-177">            <span class="k">if</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="n">DB</span><span class="o">-</span><span class="n">AXIS_DB</span> <span class="ow">and</span> <span class="n">Y</span> <span class="o">&lt;</span> <span class="n">DB</span><span class="o">+</span><span class="n">AXIS_DB</span><span class="p">:</span>
</span><span id="line-178">                <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="mi">125</span>
</span><span id="line-179">            <span class="k">elif</span> <span class="n">Y</span> <span class="o">&lt;</span> <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">-</span> <span class="n">minChange</span> <span class="ow">or</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">+</span> <span class="n">minChange</span><span class="p">:</span>
</span><span id="line-180">                <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="n">Y</span>
</span><span id="line-181">        <span class="k">if</span> <span class="n">jhat</span><span class="p">:</span>
</span><span id="line-182">            <span class="n">X</span> <span class="o">=</span> <span class="n">jhat</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span>
</span><span id="line-183">            <span class="k">if</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="n">AXIS_MIN</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="n">AXIS_MAX</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
</span><span id="line-184">                <span class="k">if</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="n">DB</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">AXIS_DB</span> <span class="ow">and</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="n">DB</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">AXIS_DB</span><span class="p">:</span>
</span><span id="line-185">                    <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="line-186">                    <span class="c1"># print(f"X: {X}")</span>
</span><span id="line-187">                <span class="k">elif</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">-</span> <span class="n">minChange</span> <span class="ow">or</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">+</span> <span class="n">minChange</span><span class="p">:</span>
</span><span id="line-188">                    <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="line-189">            <span class="n">Y</span> <span class="o">=</span> <span class="n">jhat</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span>
</span><span id="line-190">            <span class="k">if</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="n">AXIS_MIN</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">Y</span> <span class="o">&lt;</span> <span class="n">AXIS_MAX</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
</span><span id="line-191">                <span class="k">if</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="n">DB</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">AXIS_DB</span> <span class="ow">and</span> <span class="n">Y</span> <span class="o">&lt;</span> <span class="n">DB</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">AXIS_DB</span><span class="p">:</span>
</span><span id="line-192">                    <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="line-193">                    <span class="c1"># print(f"X: {X}")</span>
</span><span id="line-194">                <span class="k">elif</span> <span class="n">Y</span> <span class="o">&lt;</span> <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">-</span> <span class="n">minChange</span> <span class="ow">or</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">+</span> <span class="n">minChange</span><span class="p">:</span>
</span><span id="line-195">                    <span class="n">hotas</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="n">Y</span>
</span><span id="line-196">                <span class="n">hotas</span><span class="o">.</span><span class="n">button</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">source_value</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">jhat</span><span class="o">.</span><span class="n">get_button_status</span><span class="p">()</span>
</span><span id="line-197">        <span class="n">hotas</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="line-198">        <span class="c1"># print(jhat.get_x())</span>
</span><span id="line-199">        <span class="c1"># print(accel_array)</span>
</span><span id="line-200">
</span><span id="line-201">                <span class="c1"># Process any waiting requests</span>
</span><span id="line-202">        <span class="n">pool_result</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span>
</span><span id="line-203">
</span><span id="line-204">        <span class="k">if</span> <span class="n">pool_result</span> <span class="o">==</span> <span class="n">REQUEST_HANDLED_RESPONSE_SENT</span><span class="p">:</span>
</span><span id="line-205">            <span class="c1"># Do something only after handling a request</span>
</span><span id="line-206">            <span class="k">pass</span>
</span><span id="line-207">
</span><span id="line-208">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sampling_ms</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="line-209">
</span><span id="line-210">        <span class="c1"># If you want you can stop the server by calling server.stop() anywhere in your code</span>
</span><span id="line-211">    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="line-212">        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="line-213">        <span class="k">continue</span>
</span></pre>
       </div>
      </div>
     </div>
     <div class="preview-pane" id="code-widget-657616">
      <div class="header">
       <div class="text">
        <div class="title">
         <h3 class="hckui__typography__h3">
          Boot File
         </h3>
         <span class="hckui__typography__bodyS hckui__typography__pebble">
          MicroPython
         </span>
        </div>
        <div class="comment">
         <div class="hckui__typography__bodyS hckui__typography__pebble">
          This is the boot.py file for use in CircuitPython
         </div>
        </div>
       </div>
      </div>
      <div class="preview-body pygments-syntax all">
       <div class="highlight">
        <pre><span></span><span id="line-1"><span class="sd">"""JoystickXL standard boot.py."""</span>
</span><span id="line-2">
</span><span id="line-3"><span class="kn">import</span> <span class="nn">usb_hid</span>  <span class="c1"># type: ignore (this is a CircuitPython built-in)</span>
</span><span id="line-4"><span class="kn">from</span> <span class="nn">joystick_xl.hid</span> <span class="kn">import</span> <span class="n">create_joystick</span>
</span><span id="line-5">
</span><span id="line-6"><span class="c1"># This will enable all of the standard CircuitPython USB HID devices along with a</span>
</span><span id="line-7"><span class="c1"># USB HID joystick.</span>
</span><span id="line-8"><span class="n">usb_hid</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span>
</span><span id="line-9">    <span class="p">(</span>
</span><span id="line-10">        <span class="n">usb_hid</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">KEYBOARD</span><span class="p">,</span>
</span><span id="line-11">        <span class="n">usb_hid</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">MOUSE</span><span class="p">,</span>
</span><span id="line-12">        <span class="n">usb_hid</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">CONSUMER_CONTROL</span><span class="p">,</span>
</span><span id="line-13">        <span class="n">create_joystick</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span><span id="line-14">    <span class="p">)</span>
</span><span id="line-15"><span class="p">)</span>
</span></pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Mobility Control Asistant
      </h3>
      <div class="hckui__typography__bodyS hckui__typography__pebble">
       You will find all the additional libraries needed for this project and my latest code in GitHub
      </div>
     </div>
    </div>
    <a href="https://github.com/djbazza/Mobility-Control-Assistant">
     Github
    </a>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <div class="project-section-break">
  </div>
 </div>
</div>
