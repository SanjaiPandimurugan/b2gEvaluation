<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css"><link rel="stylesheet" href="../custom.css"><div class="middle-column">
 <section id="overview">
  <h1 class="hckui__typography__h1" itemprop="name">
   Empowering Mobility: Smart Home Tech for Accessibility
  </h1>
  <p class="hckui__typography__bodyL hckui__layout__marginBottom15" itemprop="description">
   Empower mobility-impaired individuals with our smart home system. Control appliances via voice, app, or remote, with easy scheduling.
  </p>
  <div class="hckui__layout__marginTop30">
   <div class="hckui__layout__hiddenMedUp">
   </div>
   <div class="project-cover-image" itemprop="image" itemscope="" itemtype="https://schema.org/ImageObject">
    <meta content="https://hackster.imgix.net/uploads/attachments/1751705/_pgT89uRNW9.blob?auto=compress&amp;w=900&amp;h=675&amp;fit=min&amp;fm=jpg" itemprop="url"/>
    <meta content="900" itemprop="width"/>
    <meta content="675" itemprop="height"/>
    <img alt="Empowering Mobility: Smart Home Tech for Accessibility" src="10.jpg"/>
   </div>
  </div>
 </section>
 <div class="project-section-break">
 </div>
 <div id="project_page_simple_ad_portal">
 </div>
 <div id="description" itemprop="articleBody">
  <section id="things">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Things used in this project
     </span>
    </h2>
   </div>
   <div class="project-parts">
    <div class="view-expanded" style="display:block">
     <table class="project-parts-table">
      <colgroup>
       <col style="width: 100px; height: 50px;"/>
       <col style="width: auto;"/>
      </colgroup>
      <tbody>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Hardware components
         </h3>
        </td>
        <tr>
         <td class="part-img">
         </td>
         <td class="hckui__typography__bodyL">
          ARM Cortex-M0 CY8C4245-AXI 483
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="ESP8266 ESP-12E" src="11.jpg" srcset="https://hackster.imgix.net/uploads/image/file/138233/esp12e.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/138233/esp12e.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Espressif ESP8266 ESP-12E","href":"/Espressif/products/esp8266-esp-12e?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/Espressif/products/esp8266-esp-12e?ref=project-a77521">
           Espressif ESP8266 ESP-12E
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="PCBWay Custom PCB" src="12.jpg" srcset="https://hackster.imgix.net/uploads/attachments/561282/pcbway_QeHeggiIdG.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/561282/pcbway_QeHeggiIdG.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"PCBWay Custom PCB","href":"/pcbway/products/custom-pcb?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/pcbway/products/custom-pcb?ref=project-a77521">
           PCBWay Custom PCB
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="PCBWay Stencil" src="13.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1281155/stencil-sign_jwegfSnrPK.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1281155/stencil-sign_jwegfSnrPK.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"PCBWay Stencil","href":"/pcbway/products/pcbway-stencil?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/pcbway/products/pcbway-stencil?ref=project-a77521">
           PCBWay Stencil
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="PCBWay Flex PCB" src="14.jpg" srcset="https://hackster.imgix.net/uploads/attachments/1554426/1036458810617_97CsIjo4QD.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/1554426/1036458810617_97CsIjo4QD.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"PCBWay Flex PCB","href":"/pcbway/products/pcbway-flex-pcb?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/pcbway/products/pcbway-flex-pcb?ref=project-a77521">
           PCBWay Flex PCB
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
         </td>
         <td class="hckui__typography__bodyL">
          5V Relay PCB Mount
         </td>
        </tr>
        <tr>
         <td class="part-img">
         </td>
         <td class="hckui__typography__bodyL">
          IR receiver (generic)
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="Android device" src="15.jpg" srcset="https://hackster.imgix.net/uploads/image/file/50981/1434509556_android-phone-color.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/50981/1434509556_android-phone-color.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Android device","href":"/android/products/android-device?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/android/products/android-device?ref=project-a77521">
           Android device
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="Echo Dot" src="16.jpg" srcset="https://hackster.imgix.net/uploads/image/file/129370/amazon-echo-dot.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/129370/amazon-echo-dot.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Amazon Alexa Echo Dot","href":"/amazon-alexa/products/echo-dot?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/amazon-alexa/products/echo-dot?ref=project-a77521">
           Amazon Alexa Echo Dot
          </a>
         </td>
        </tr>
        <tr>
         <td class="part-img">
          <img alt="JustBoom IR Remote" src="17.jpg" srcset="https://hackster.imgix.net/uploads/attachments/341479/JustBoom-Air-Mouse-Remote.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/341479/JustBoom-Air-Mouse-Remote.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
         </td>
         <td class="hckui__typography__bodyL">
          <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"JustBoom IR Remote","href":"/JustBoomAudio/products/justboom-ir-remote?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/JustBoomAudio/products/justboom-ir-remote?ref=project-a77521">
           JustBoom IR Remote
          </a>
         </td>
        </tr>
       </tr>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Software apps and online services
         </h3>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Arduino IDE" src="18.jpg" srcset="https://hackster.imgix.net/uploads/image/file/144203/IDE_web.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/144203/IDE_web.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Arduino IDE","href":"/arduino/products/arduino-ide?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/arduino/products/arduino-ide?ref=project-a77521">
          Arduino IDE
         </a>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="PSoC Creator" src="19.jpg" srcset="https://hackster.imgix.net/uploads/image/file/122553/Creator_BannerImage_2_.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/122553/Creator_BannerImage_2_.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Cypress PSoC Creator","href":"/cypress/products/psoc-creator?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/cypress/products/psoc-creator?ref=project-a77521">
          Cypress PSoC Creator
         </a>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="VS Code" src="20.jpg" srcset="https://hackster.imgix.net/uploads/attachments/673386/512px-visual_studio_code_1_18_icon_svg_k5OBc8o3Yk.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/673386/512px-visual_studio_code_1_18_icon_svg_k5OBc8o3Yk.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Microsoft VS Code","href":"/microsoft/products/vs-code?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/microsoft/products/vs-code?ref=project-a77521">
          Microsoft VS Code
         </a>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="AWS Lambda" src="21.jpg" srcset="https://hackster.imgix.net/uploads/image/file/57873/Screen%20Shot%202015-07-20%20at%206.10.26%20PM.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/57873/Screen%20Shot%202015-07-20%20at%206.10.26%20PM.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Amazon Web Services AWS Lambda","href":"/AmazonWebServices/products/aws-lambda?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/AmazonWebServices/products/aws-lambda?ref=project-a77521">
          Amazon Web Services AWS Lambda
         </a>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="MQTT" src="22.jpg" srcset="https://hackster.imgix.net/uploads/attachments/183131/mqtt.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/183131/mqtt.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"MQTT","href":"/mqtt/products/mqtt?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/mqtt/products/mqtt?ref=project-a77521">
          MQTT
         </a>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Alexa Voice Service" src="23.jpg" srcset="https://hackster.imgix.net/uploads/image/file/158835/avs_med_3-22.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/image/file/158835/avs_med_3-22.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Amazon Alexa Alexa Voice Service","href":"/amazon-alexa/products/alexa-voice-service?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/amazon-alexa/products/alexa-voice-service?ref=project-a77521">
          Amazon Alexa Alexa Voice Service
         </a>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Actions on Google" src="24.jpg" srcset="https://hackster.imgix.net/uploads/attachments/310067/logo_assistant_kVFq4j72G6.png?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/310067/logo_assistant_kVFq4j72G6.png?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"Actions on Google","href":"/google/products/actions-on-google?ref=project-a77521","type":"part","location":"things"},"clickOpts":{"delayRedirect":true}}' href="https://www.hackster.io/google/products/actions-on-google?ref=project-a77521">
          Actions on Google
         </a>
        </td>
       </tr>
       <tr class="head">
        <td colspan="2">
         <h3 class="hckui__typography__h3">
          Hand tools and fabrication machines
         </h3>
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Tweezers, SMD Soldering/Desoldering" src="25.jpg" srcset="https://hackster.imgix.net/uploads/attachments/842938/5204439.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/842938/5204439.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         Tweezers, SMD Soldering/Desoldering
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Solder Wire, Lead Free" src="26.jpg" srcset="https://hackster.imgix.net/uploads/attachments/842592/4966285.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/842592/4966285.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         Solder Wire, Lead Free
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Solder Paste, Rework" src="27.jpg" srcset="https://hackster.imgix.net/uploads/attachments/842552/84R8664-40.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/842552/84R8664-40.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         Solder Paste, Rework
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="Solder Flux, Soldering" src="28.jpg" srcset="https://hackster.imgix.net/uploads/attachments/842547/66Y6421-40.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/842547/66Y6421-40.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         Solder Flux, Soldering
        </td>
       </tr>
       <tr>
        <td class="part-img">
         <img alt="PCB Holder, Soldering Iron" src="29.jpg" srcset="https://hackster.imgix.net/uploads/attachments/842476/34AC9633-40.jpg?auto=compress%2Cformat&amp;w=96&amp;h=96&amp;fit=fill&amp;bg=ffffff 2x, https://hackster.imgix.net/uploads/attachments/842476/34AC9633-40.jpg?auto=compress%2Cformat&amp;w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
        </td>
        <td class="hckui__typography__bodyL">
         PCB Holder, Soldering Iron
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="story">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Story
     </span>
    </h2>
   </div>
   <div class="project-story collapsible-section collapsed hljs-active hljs-monokai" itemprop="text">
    <p class="hckui__typography__bodyL">
     The proposed smart home automation system is engineered to address the accessibility challenges faced by individuals with mobility impairments. By integrating advanced control technologies, the system provides a comprehensive solution for managing home appliances with minimal physical interaction.
    </p>
    <p class="hckui__typography__bodyL">
     System Components and Features:
    </p>
    <p class="hckui__typography__bodyL">
     1. Smart Switches:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Technology: Replace traditional mechanical switches with smart switches that support remote control, voice commands, and app-based operation.
     </li>
     <li>
      Functionality: Enable users to control lighting, heating, cooling, and other appliances without physical effort.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     2. Voice Control:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Technology: Utilizes advanced voice recognition software capable of processing natural language commands and supporting multiple languages and accents.
     </li>
     <li>
      Functionality: Allows users to operate appliances and execute commands through verbal instructions, reducing the need for manual control.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     3. Smartphone App:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Technology: A dedicated mobile application compatible with both iOS and Android platforms, featuring a user-friendly interface and real-time connectivity.
     </li>
     <li>
      Functionality: Provides remote access to appliance controls, monitoring, and scheduling. The app includes customizable settings for ease of use.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     4. Remote Control:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Technology: A compact, ergonomically designed remote control with tactile buttons and programmable functions.
     </li>
     <li>
      Functionality: Facilitates easy operation of home appliances from a distance, catering to users who prefer physical controls over digital ones.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     5. Scheduling and Automation:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Technology: Integrated scheduling algorithms and automation protocols for time-based appliance management.
     </li>
     <li>
      Functionality: Allows users to set predefined schedules for appliance operation, such as turning lights on at specific times or adjusting the thermostat according to daily routines.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     Technical Implementation:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Integration: The system employs IoT (Internet of Things) protocols to connect and synchronize smart devices across the home network. It supports standard communication protocols.
     </li>
     <li>
      Security: Implements encryption and secure authentication mechanisms to protect user data and prevent unauthorized access to the system.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      Basic components:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      5v Relay: This switch controls the circuit electromechanically, allowing electrical appliances to be turned on and off with a low power signal.
     </li>
     <li>
      Diode: This is used to prevent PSOC.
     </li>
     <li>
      Optocoupler IC (moc3063): A current is applied to the Optocoupler, which emits a light proportional to the current. The light then switches on the photosensitive device, which conducts a current like an ordinary transistor.
     </li>
     <li>
      Triac (BT136-600v-4a-triac): Triacs are electronic components that can switch high voltages and high levels of current over both parts of an AC waveform. They are ideal for a variety of power switching applications.
     </li>
     <li>
      Metallized Polyester Fan Regulator Capacitors: Capacitors are used to control fan speed.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      Bill of material :
     </strong>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"https://drive.google.com/file/d/17ZKFkcDzk-7p0YHh9S7vomMZsvJbrvgr/view?usp=share_link","href":"https://drive.google.com/file/d/17ZKFkcDzk-7p0YHh9S7vomMZsvJbrvgr/view?usp=share_link","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://drive.google.com/file/d/17ZKFkcDzk-7p0YHh9S7vomMZsvJbrvgr/view?usp=share_link" rel="nofollow">
      https://drive.google.com/file/d/17ZKFkcDzk-7p0YHh9S7vomMZsvJbrvgr/view?usp=share_link
     </a>
    </p>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-connections-0">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Connections:
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     1. Controlling Electronics appliances :
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="0.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     2. Controlling Fan Speed
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="1.jpg"/>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-schematic-diagram-1">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Schematic Diagram:
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     To demonstrate the functionality of our system, we have started with 4 light controls and 1 fan control. Please refer to the schematic diagram of the power module below for a visual representation of our setup.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="2.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     Please find the schematic diagram of our Touch Module below. This diagram outlines the functionality and components of our system, which allows for seamless control of home electronics appliances through touch control, IR remote, and voice assistants such as Alexa and Google.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="3.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     Schematic diagram of Touch Module
    </p>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-pcb-viewer-2">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      PCB Viewer:
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     Please find attached the Power Module View for our system. This module is a crucial component of our technology, allowing for efficient and reliable power management for the various home electronics appliances being controlled.
    </p>
    <p class="hckui__typography__bodyL">
     <strong>
      Gerber File:
     </strong>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"https://drive.google.com/file/d/1jbXJZqadmYrhs8SUUFjje20PhvFAiVj-/view?usp=share_link","href":"https://drive.google.com/file/d/1jbXJZqadmYrhs8SUUFjje20PhvFAiVj-/view?usp=share_link","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://drive.google.com/file/d/1jbXJZqadmYrhs8SUUFjje20PhvFAiVj-/view?usp=share_link" rel="nofollow">
      https://drive.google.com/file/d/1jbXJZqadmYrhs8SUUFjje20PhvFAiVj-/view?usp=share_link
     </a>
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="4.jpg"/>
     <img class="carousel-image" src="5.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     Please find attached the Touch Module View for our system. This module serves as the interface between the user and the home electronics appliances being controlled. With touch control, IR remote, and voice assistant capabilities, our Touch Module offers a variety of ways to seamlessly control your smart home devices.
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="6.jpg"/>
     <img class="carousel-image" src="7.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     <strong>
      Gerber File:
     </strong>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"https://drive.google.com/file/d/1ap_wFNBFkqszh2POsxibOfh2cUS4051q/view?usp=share_link","href":"https://drive.google.com/file/d/1ap_wFNBFkqszh2POsxibOfh2cUS4051q/view?usp=share_link","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://drive.google.com/file/d/1ap_wFNBFkqszh2POsxibOfh2cUS4051q/view?usp=share_link" rel="nofollow">
      https://drive.google.com/file/d/1ap_wFNBFkqszh2POsxibOfh2cUS4051q/view?usp=share_link
     </a>
    </p>
    <p class="hckui__typography__bodyL">
     Our module code is designed to handle all user operations to control home electronics appliances using our smart home automation system. The system offers four modes of working:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      Touch: The Cypress capacitive touch technology senses user touch input and reacts based on the last state of the relay value.
     </li>
     <li>
      Voice Command: Alexa publishes MQTT messages, which our ESP module subscribes to receive. I2C communication is used between the Cypress chip and the ESP8266 to enable voice command operation.
     </li>
     <li>
      IR Remote: Our ESP8266 decodes user input button commands and sends them to the Cypress chip using I2C communication. The Cypress chip reacts based on the input command.
     </li>
     <li>
      Smartphone: The user's smartphone can publish MQTT messages, which our ESP module subscribes to receive. I2C communication is used between the Cypress chip and the ESP8266. Based on the received command, the Cypress chip reacts and handles the relay.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     Our module code allows for seamless integration of these four modes, offering users flexibility and convenience in controlling their home electronics appliances.
    </p>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-flow-chart-of-working-system-3">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Flow Chart of Working System:
     </span>
    </h3>
    <div class="carousel-images">
     <img class="carousel-image" src="8.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     <strong>
      ARM
     </strong>
     <strong>
      Cortex-M0 Cypress
     </strong>
     <strong>
      Code:
     </strong>
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      1. To import C libraries in your code, you need to include their header files using the
     </span>
     <code>
      #include
     </code>
     <span>
      preprocessor directive. This allows you to use functions and data types from the library in your program.
     </span>
    </p>
    <pre><code><span>#include "project.h"</span><br/><span>#include "stdlib.h"</span><br/><span>#include "cyapicallbacks.h"</span></code></pre>
    <p class="hckui__typography__bodyL">
     2. The code snippet you provided consists of four C function prototypes. These are:
    </p>
    <pre><code><span>void updateLoad(void);</span><br/><span>void loadWrite(uint8,uint8);</span><br/><span>void HandleError(void);</span><br/><span>void i2cReceive(void);</span></code></pre>
    <ul class="hckui__typography__bodyL">
     <li>
      <code>
       <strong>
        void updateLoad(void)
       </strong>
      </code>
      <span>
       : A function that updates the load status of a device.
      </span>
     </li>
     <li>
      <code>
       <strong>
        void loadWrite(uint8, uint8)
       </strong>
      </code>
      <span>
       : A function that writes a value to a specific load.
      </span>
     </li>
     <li>
      <code>
       <strong>
        void HandleError(void)
       </strong>
      </code>
      <span>
       : A function that handles errors that may occur during program execution.
      </span>
     </li>
     <li>
      <code>
       <strong>
        void i2cReceive(void)
       </strong>
      </code>
      <span>
       : A function that receives data via the I2C communication protocol.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     These function prototypes define the function name, return type, and parameters (if any) that the function accepts. They are often used as a way to declare functions before they are implemented or used in a program, helping to ensure that the function is properly defined and its usage is correct.
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      3. The code snippet you provided defines two preprocessor directives using the
     </span>
     <code>
      <strong>
       #define
      </strong>
     </code>
     <span>
      keyword.
     </span>
    </p>
    <pre><code><span>#define LightloadNumber 4</span><br/><span>#define FanLoadNumber 1</span></code></pre>
    <ul class="hckui__typography__bodyL">
     <li>
      <code>
       <strong>
        #define LightloadNumber 4
       </strong>
      </code>
      <span>
       defines a preprocessor macro with the name
      </span>
      <code>
       <strong>
        LightloadNumber
       </strong>
      </code>
      <span>
       and a value of 4. This macro can be used in the code to represent the number of light loads that can be controlled by the program.
      </span>
     </li>
     <li>
      <code>
       <strong>
        #define FanLoadNumber 1
       </strong>
      </code>
      <span>
       defines a preprocessor macro with the name
      </span>
      <code>
       <strong>
        FanLoadNumber
       </strong>
      </code>
      <span>
       and a value of 1. This macro can be used in the code to represent the number of fan loads that can be controlled by the program.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     These preprocessor directives help to make the code more readable and maintainable by defining values that are used in multiple places throughout the program in one central location. Anytime the program needs to refer to the number of light or fan loads, it can use these macros instead of hardcoding the values, which makes the code more flexible and easier to modify in the future.
    </p>
    <p class="hckui__typography__bodyL">
     4. These lines are declaring and initializing various arrays and variables that will be used in the program for controlling the smart home automation system.
    </p>
    <pre><code><span>uint8 state_switch[LightloadNumber];       //status of touch switch</span><br/><span>uint8 pre_switch[LightloadNumber];         //previous status of touch switch</span><br/><span>uint8 state_load[LightloadNumber];         //status of load</span><br/><span>uint8 state[LightloadNumber + FanLoadNumber + 1];   //state for communication </span><br/><span>uint8 pre_state[LightloadNumber + FanLoadNumber + 1];   //state for communication </span><br/><span>uint8 state_Fswitch[FanLoadNumber];   //status of fan switch</span><br/><span>uint8 pre_Fswitch[FanLoadNumber];    //previous status of fan switch</span><br/><span>uint8 fan_state[2];</span><br/><span>uint8 state_Fan[FanLoadNumber];    //status of fan regulator</span><br/><br/><span>uint8 Switch[] = {0,1,2,3};   // touch swich for light load(cap sense button 0,1,2,3)</span><br/><span>uint8 Load[] = {0,1,2,3};  //load connection for switch (L0,L1,L2,L3)(relay)</span><br/><span>uint8 F_UP_DWN[2] = {5,4}; //fan up and down touch switch(cap sense button 5,6)</span><br/><span>uint8 Fan[4] = {7,6,5,4};  //fan output connection(L4,L5,L6,L7)</span><br/><span>uint8 Fan_led[5] = {12,11,10,9,8}; // fan speed indicator led(L8,L9,L10,L11,L12)</span><br/><span>uint8 white_led_load[] = {13,14,15,16}; //white led for each load(L13,L14,L15,L16)</span><br/><span>uint8 Fan_UDW[2] = {18,17};  //fan up down white led</span><br/><span>uint8 Fan_UDB[2] = {22,21};  //fan up down blue led</span><br/><br/><span>// smd button down</span><br/><span>/*</span><br/><span>uint8 F_switch[] = {6}; //fan touch switch (cap sense button 4)</span><br/><span>uint8 Fan_BW[2] = {20,19};   //fan blue and white led </span><br/><span>uint8 Scenebut = {7};  //touch switch for smd pad(cap sense button 7)</span><br/><span>uint8 scene_BW[2] = {23,24};  //smd switch up down blue led</span><br/><span>*/</span><br/><span>// smd button up</span><br/><span>uint8 F_switch[] = {7}; //fan touch switch (cap sense button 4)</span><br/><span>uint8 Fan_BW[2] = {24,23};   //fan blue and white led </span><br/><span>uint8 Scenebut = {6};  //touch switch for smd pad(cap sense button 7)</span><br/><span>uint8 scene_BW[2] = {19,20};  //smd switch up down blue led</span><br/><br/><span>uint8 ScenebutStatus = 0;</span><br/><span>uint8 pre_ScenebutStatus = 0;</span><br/><span>uint8 whiteLed = 1;      //status of activation of white led of all loads</span><br/><span> </span><br/><span>//i2c</span><br/><span>uint8 i2cReadBuffer[(LightloadNumber + FanLoadNumber + 1)];</span><br/><span>uint8 i2cWriteBuffer[(LightloadNumber + FanLoadNumber + 1)];</span><br/><span>uint8 I2CFlag = 0u;</span><br/><br/><span>uint8 sceneled = 0;</span><br/><span>uint8 speed = 0;</span><br/><span>int onOffFlag = 0;</span><br/><br/><span>uint8 flag = 0;</span></code></pre>
    <ul class="hckui__typography__bodyL">
     <li>
      <span>
       The arrays
      </span>
      <code>
       <strong>
        state_switch
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        pre_switch
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        state_load
       </strong>
      </code>
      <span>
       , and
      </span>
      <code>
       <strong>
        state_Fswitch
       </strong>
      </code>
      <span>
       are used to keep track of the current and previous status of the touch switches and fan switch.
      </span>
     </li>
     <li>
      <span>
       The arrays
      </span>
      <code>
       <strong>
        state
       </strong>
      </code>
      <span>
       and
      </span>
      <code>
       <strong>
        pre_state
       </strong>
      </code>
      <span>
       are used for communication between the modules.
      </span>
     </li>
     <li>
      <span>
       The arrays
      </span>
      <code>
       <strong>
        Switch
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        Load
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        F_UP_DWN
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        Fan
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        Fan_led
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        white_led_load
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        Fan_UDW
       </strong>
      </code>
      <span>
       , and
      </span>
      <code>
       <strong>
        Fan_UDB
       </strong>
      </code>
      <span>
       are used to define the connections for the touch switches, loads, fan, fan speed indicator led, white led for each load, fan up down white led, and fan up down blue led respectively.
      </span>
     </li>
     <li>
      <span>
       The variable
      </span>
      <code>
       <strong>
        ScenebutStatus
       </strong>
      </code>
      <span>
       keeps track of the status of the touch switch for the smd pad.
      </span>
     </li>
     <li>
      <span>
       The arrays
      </span>
      <code>
       <strong>
        i2cReadBuffer
       </strong>
      </code>
      <span>
       and
      </span>
      <code>
       <strong>
        i2cWriteBuffer
       </strong>
      </code>
      <span>
       are used for communication over I2C.
      </span>
     </li>
     <li>
      <span>
       The variables
      </span>
      <code>
       <strong>
        sceneled
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        speed
       </strong>
      </code>
      <span>
       ,
      </span>
      <code>
       <strong>
        onOffFlag
       </strong>
      </code>
      <span>
       , and
      </span>
      <code>
       <strong>
        flag
       </strong>
      </code>
      <span>
       are used for controlling the system.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     5. A callback function:
    </p>
    <pre><code><span>void I2C_I2C_ISR_ExitCallback()</span><br/><span>{</span><br/><span>    I2CFlag = 1; </span><br/><span>}</span></code></pre>
    <p class="hckui__typography__bodyL">
     A callback function that is executed when the I2C (Inter-Integrated Circuit) module finishes sending or receiving data. Specifically, it is called when the I2C interrupt is triggered and signals that the I2C communication has completed.
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      In this particular code, the function sets a flag variable called
     </span>
     <code>
      <strong>
       I2CFlag
      </strong>
     </code>
     <span>
      to 1, indicating that the I2C communication has finished. This flag can be used by other parts of the code to determine when to take further action based on the results of the I2C communication.
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     6. The code that controls loads (lights and fans) using CapSense touch sensors and an I2C interface.
    </p>
    <pre><code><span>int main(void)</span><br/><span>{</span><br/><span>    memset(state_switch,0,sizeof(state_switch));</span><br/><span>    memset(pre_switch,0,sizeof(pre_switch));</span><br/><span>    memset(state,0,sizeof(state));</span><br/><span>    memset(state_load,0,sizeof(state_load));</span><br/><span>    memset(pre_state,0,sizeof(pre_state));</span><br/><span>    memset(state_Fswitch,0,sizeof(state_Fswitch));</span><br/><span>    memset(pre_Fswitch,0,sizeof(pre_Fswitch));</span><br/><span>    memset(fan_state,0,sizeof(fan_state));</span><br/><span>    memset(i2cReadBuffer,0,sizeof(i2cReadBuffer));  </span><br/><span>    </span><br/><span>    L13_Write(whiteLed);</span><br/><span>    L14_Write(whiteLed);</span><br/><span>    L15_Write(whiteLed);</span><br/><span>    L16_Write(whiteLed);</span><br/><span>    L17_Write(whiteLed);</span><br/><span>    L18_Write(whiteLed);</span><br/><span>    L19_Write(whiteLed);</span><br/><span>    L23_Write(whiteLed);</span><br/><span>      </span><br/><span>    I2C_I2CSlaveInitReadBuf(i2cReadBuffer, (LightloadNumber + FanLoadNumber + 1));</span><br/><span>    I2C_I2CSlaveInitWriteBuf(i2cWriteBuffer, (LightloadNumber + FanLoadNumber + 1));</span><br/><span>    </span><br/><span>    I2C_I2C_ISR_ExitCallback();</span><br/><span>    </span><br/><span>    CyGlobalIntEnable; </span><br/><span>    </span><br/><span>    CySysWdtWriteMode(CY_SYS_WDT_COUNTER1, CY_SYS_WDT_MODE_RESET);</span><br/><span>    CySysWdtWriteMatch(CY_SYS_WDT_COUNTER1, 0xFA00);</span><br/><span>      </span><br/><span>    CySysWdtWriteClearOnMatch(CY_SYS_WDT_COUNTER1, 1u);</span><br/><span>    </span><br/><span>    CySysWdtEnable(CY_SYS_WDT_COUNTER1_MASK);</span><br/><span>    </span><br/><span>    CapSense_1_Start();</span><br/><span>    CapSense_1_InitializeAllBaselines();</span><br/><span>    I2C_Start();</span><br/><span>    </span><br/><span>    for(;;)</span><br/><span>    {</span><br/><span>        if(0u == CapSense_1_IsBusy()){</span><br/><span>            /* Update all baselines */</span><br/><span>            CapSense_1_ProcessAllWidgets();</span><br/><span>           </span><br/><span>            /* Start scanning all enabled sensors */</span><br/><span>            CapSense_1_ScanAllWidgets();</span><br/><span>        }</span><br/><span>        </span><br/><span>        ScenebutStatus = CapSense_1_IsWidgetActive(Scenebut);</span><br/><span>        if(ScenebutStatus != pre_ScenebutStatus){</span><br/><span>            if(ScenebutStatus != 0 &amp;&amp; onOffFlag == 0){</span><br/><span>                onOffFlag = 1;</span><br/><span>                for(int i = 0; i &lt; LightloadNumber+FanLoadNumber; i++){</span><br/><span>                    if(i&lt;LightloadNumber)</span><br/><span>                        loadWrite(Load[i],0);</span><br/><span>                    state[i] = 0;</span><br/><span>                }</span><br/><span>                loadWrite(Fan_BW[0],0);</span><br/><span>                if(whiteLed == 1){</span><br/><span>                    for(int i = 0; i &lt; LightloadNumber; i++){</span><br/><span>                        loadWrite(white_led_load[i],1);</span><br/><span>                    }</span><br/><span>                    loadWrite(Fan_BW[1],1);</span><br/><span>                }</span><br/><span>            }</span><br/><span>            else if(ScenebutStatus != 0 &amp;&amp; onOffFlag == 1){</span><br/><span>                onOffFlag = 0;</span><br/><span>                for(int i = 0; i &lt; LightloadNumber+FanLoadNumber; i++){</span><br/><span>                    if(i&lt;LightloadNumber)</span><br/><span>                        loadWrite(Load[i],1);</span><br/><span>                    state[i] = 1;</span><br/><span>                }</span><br/><span>                loadWrite(Fan_BW[0],1);</span><br/><span>                if(whiteLed == 1){</span><br/><span>                    for(int i = 0; i &lt; LightloadNumber; i++){</span><br/><span>                        loadWrite(white_led_load[i],0);</span><br/><span>                    }</span><br/><span>                    loadWrite(Fan_BW[1],0);</span><br/><span>                }</span><br/><span>            }</span><br/><span>            pre_ScenebutStatus = ScenebutStatus;</span><br/><span>        }</span><br/><span>        </span><br/><span>        if(state[0] != 1 &amp;&amp; state[1] != 1 &amp;&amp; state[2] != 1 &amp;&amp; state[3] != 1 &amp;&amp; state[4] != 1){    </span><br/><span>            onOffFlag = 1;</span><br/><span>        }</span><br/><span>        else {</span><br/><span>            onOffFlag = 0;</span><br/><span>        }</span><br/><span>        if(state[0] == 1 &amp;&amp; state[1] == 1 &amp;&amp; state[2] == 1 &amp;&amp; state[3] == 1 &amp;&amp; state[4] == 1){</span><br/><span>            if(whiteLed == 1)</span><br/><span>                loadWrite(scene_BW[0],0);</span><br/><span>            loadWrite(scene_BW[1],1);           </span><br/><span>        }</span><br/><span>        else {</span><br/><span>            if(whiteLed == 1)</span><br/><span>                loadWrite(scene_BW[0],1);</span><br/><span>            loadWrite(scene_BW[1],0);</span><br/><span>        }</span><br/><span>        </span><br/><span>        </span><br/><span>        for(uint8 i = 0 ; i &lt; LightloadNumber ; i++){                    </span><br/><span>           state_switch[i] = CapSense_1_IsWidgetActive(Switch[i]);</span><br/><span>            if(state_switch[i] != pre_switch[i]){                         </span><br/><span>                if(state_switch[i] != 0){</span><br/><span>                    if(state[i] != 0)</span><br/><span>                        state_load[i] = 0;</span><br/><span>                    else </span><br/><span>                        state_load[i] = 1;</span><br/><span>                    loadWrite(Load[i],state_load[i]);  </span><br/><span>                    state[i] = state_load[i] ? 1 : 0;</span><br/><span>                    if(whiteLed == 1)</span><br/><span>                        loadWrite(white_led_load[i],!(state_load[i])); </span><br/><span>                }</span><br/><span>                pre_switch[i] = state_switch[i];</span><br/><span>            }</span><br/><span>        }</span><br/><span>        </span><br/><span>        state_Fswitch[0] = CapSense_1_IsWidgetActive(F_switch[0]);</span><br/><span>        if(state_Fswitch[0] != pre_Fswitch[0]){                         </span><br/><span>            if(state_Fswitch[0] != 0){</span><br/><span>                if(state[4] != 0)</span><br/><span>                    state_Fan[0] = 0;</span><br/><span>                else </span><br/><span>                    state_Fan[0] = 1;</span><br/><span>                loadWrite(Fan_BW[0],state_Fan[0]);  </span><br/><span>                state[4] = state_Fan[0] ? 1 : 0;</span><br/><span>                if(whiteLed == 1)</span><br/><span>                    loadWrite(Fan_BW[1],!(state_Fan[0])); </span><br/><span>                for (uint8 i = 0; i &lt; 4; i++)</span><br/><span>                    loadWrite(Fan[i], 0);</span><br/><span>                if(state[4] == 1){</span><br/><span>                    if(speed == 1){</span><br/><span>                        loadWrite(Fan[1], 1);</span><br/><span>                    } </span><br/><span>                    else if(speed == 2){</span><br/><span>                        loadWrite(Fan[2], 1);</span><br/><span>                    }</span><br/><span>                    else if(speed == 3){</span><br/><span>                        loadWrite(Fan[0], 1);</span><br/><span>                        loadWrite(Fan[2], 1);</span><br/><span>                    }</span><br/><span>                    else if(speed == 4){</span><br/><span>                        loadWrite(Fan[1], 1);</span><br/><span>                        loadWrite(Fan[2], 1);</span><br/><span>                    }</span><br/><span>                    else if (speed == 5){</span><br/><span>                        loadWrite(Fan[3], 1);</span><br/><span>                    }</span><br/><span>                }</span><br/><span>                else if(state[4] == 0){</span><br/><span>                    for (uint8 i = 0; i &lt; 4; i++)</span><br/><span>                        loadWrite(Fan[i], 0);</span><br/><span>                } </span><br/><span>            }</span><br/><span>            pre_Fswitch[0] = state_Fswitch[0];</span><br/><span>        }</span><br/><span>        </span><br/><span>        if(CapSense_1_IsWidgetActive(F_UP_DWN[0]) != fan_state[0]){</span><br/><span>            if(CapSense_1_IsWidgetActive(F_UP_DWN[0]) != 0){</span><br/><span>                if(speed != 5)</span><br/><span>                    speed++;                                 //fan state[3] increase by 1</span><br/><span>                else</span><br/><span>                    speed = 0;</span><br/><span>                fan_state[0] = !(fan_state[0]);</span><br/><span>                loadWrite(Fan_UDW[0],0);              // fan up white led off</span><br/><span>                loadWrite(Fan_UDB[0],1);              //fan up blue led on</span><br/><span>            }</span><br/><span>            else{</span><br/><span>                loadWrite(Fan_UDB[0],0);              //fan up blue led off</span><br/><span>                if(whiteLed == 1)</span><br/><span>                    loadWrite(Fan_UDW[0],1);          //fan up white led off</span><br/><span>            }</span><br/><span>            fan_state[0] = (CapSense_1_IsWidgetActive(F_UP_DWN[0]));</span><br/><span>        }</span><br/><span>        if(CapSense_1_IsWidgetActive(F_UP_DWN[1]) != fan_state[1]){             //check if fan down touch pad is pressed</span><br/><span>            if(CapSense_1_IsWidgetActive(F_UP_DWN[1]) != 0){</span><br/><span>                if(speed != 0)</span><br/><span>                    speed--;                             //fan state[3] decrease by 1</span><br/><span>                else</span><br/><span>                    speed = 5;</span><br/><span>                fan_state[1] = !(fan_state[1]);</span><br/><span>                loadWrite(Fan_UDW[1],0);</span><br/><span>                loadWrite(Fan_UDB[1],1);</span><br/><span>            }</span><br/><span>            else{</span><br/><span>                loadWrite(Fan_UDB[1],0);</span><br/><span>                if(whiteLed == 1)</span><br/><span>                    loadWrite(Fan_UDW[1],1);</span><br/><span>            }</span><br/><span>            fan_state[1] = (CapSense_1_IsWidgetActive(F_UP_DWN[1]));</span><br/><span>        }</span><br/><span>        </span><br/><span>        if(speed == 0){</span><br/><span>            state[5] = 0;</span><br/><span>            for(int i = 0;i&lt;5;i++){</span><br/><span>                loadWrite(Fan_led[i],0);            </span><br/><span>            }</span><br/><span>        }</span><br/><span>        else if(speed == 1){</span><br/><span>            state[5] = 1;</span><br/><span>            loadWrite(Fan_led[0],1);</span><br/><span>            for(int i = 1;i&lt;5;i++){</span><br/><span>                loadWrite(Fan_led[i],0);            </span><br/><span>            }</span><br/><span>        }</span><br/><span>        else if(speed == 2){</span><br/><span>            state[5] = 2;</span><br/><span>            for(int i = 0;i&lt;2;i++){</span><br/><span>                loadWrite(Fan_led[i],1);            </span><br/><span>            }</span><br/><span>            for(int i = 2;i&lt;5;i++){</span><br/><span>                loadWrite(Fan_led[i],0);            </span><br/><span>            }</span><br/><span>        }</span><br/><span>        else if(speed == 3){</span><br/><span>            state[5] = 3;</span><br/><span>            for(int i = 0;i&lt;3;i++){</span><br/><span>                loadWrite(Fan_led[i],1);            </span><br/><span>            }</span><br/><span>            for(int i = 3;i&lt;5;i++){</span><br/><span>                loadWrite(Fan_led[i],0);            </span><br/><span>            }</span><br/><span>        }</span><br/><span>        else if(speed == 4){</span><br/><span>            state[5] = 4;</span><br/><span>            for(int i = 0;i&lt;4;i++){</span><br/><span>                loadWrite(Fan_led[i],1);            </span><br/><span>            }</span><br/><span>            loadWrite(Fan_led[4],0);  </span><br/><span>        }</span><br/><span>        else if(speed == 5){</span><br/><span>            state[5] = 5;</span><br/><span>            for(int i = 0;i&lt;5;i++){</span><br/><span>                loadWrite(Fan_led[i],1);            </span><br/><span>            }</span><br/><span>        }</span><br/><span>        </span><br/><span>        if(state[5] != pre_state[5]){</span><br/><span>            for (uint8 i = 0; i &lt; 4; i++)</span><br/><span>                loadWrite(Fan[i], 0);</span><br/><span>            if(state[4] == 1){</span><br/><span>                if(speed == 1){</span><br/><span>                    loadWrite(Fan[1], 1);</span><br/><span>                } </span><br/><span>                else if(speed == 2){</span><br/><span>                    loadWrite(Fan[2], 1);</span><br/><span>                }</span><br/><span>                else if(speed == 3){</span><br/><span>                    loadWrite(Fan[0], 1);</span><br/><span>                    loadWrite(Fan[2], 1);</span><br/><span>                }</span><br/><span>                else if(speed == 4){</span><br/><span>                    loadWrite(Fan[1], 1);</span><br/><span>                    loadWrite(Fan[2], 1);</span><br/><span>                }</span><br/><span>                else if (speed == 5){</span><br/><span>                    loadWrite(Fan[3], 1);</span><br/><span>                }</span><br/><span>            }</span><br/><span>            //pre_state[5] = state[5];</span><br/><span>        }</span><br/><span>            </span><br/><span>        </span><br/><span>        if(I2CFlag != 0)</span><br/><span>        {</span><br/><span>            I2CFlag = 0;  </span><br/><span>            if (0u != (I2C_I2C_SSTAT_WR_CMPLT &amp; I2C_I2CSlaveStatus()))</span><br/><span>            {</span><br/><span>                i2cReceive();</span><br/><span>                I2C_I2CSlaveClearWriteBuf();</span><br/><span>                (void) I2C_I2CSlaveClearWriteStatus();</span><br/><span>            }</span><br/><span>            </span><br/><span>            if(0u != (I2C_I2C_SSTAT_RD_CMPLT &amp; I2C_I2CSlaveStatus()))</span><br/><span>            {</span><br/><span>                I2C_I2CSlaveClearReadBuf();</span><br/><span>                (void) I2C_I2CSlaveClearReadStatus();</span><br/><span>            }          </span><br/><span>        }</span><br/><span>        </span><br/><span>        for(uint8 i = 0 ; i &lt; LightloadNumber + FanLoadNumber + 1; i++){</span><br/><span>            if(state[i] != pre_state[i]){</span><br/><span>                if((I2C_I2C_SSTAT_RD_BUSY &amp; I2C_I2CSlaveStatus()) == 0){</span><br/><span>                    pre_state[i] = state[i];</span><br/><span>                    i2cReadBuffer[i] = state[i];</span><br/><span>                }</span><br/><span>            }</span><br/><span>        }</span><br/><span>        CySysWatchdogFeed(CY_SYS_WDT_COUNTER1);</span><br/><span>    }</span><br/><span>}</span></code></pre>
    <p class="hckui__typography__bodyL">
     The program initializes the various memory locations to zero and sets the state of the loads to zero. It then initializes and enables the Watchdog Timer, CapSense module, and I2C interface.
    </p>
    <p class="hckui__typography__bodyL">
     In the main loop, the program scans all enabled sensors and checks the status of the Scene button. If the Scene button is pressed, the program turns on/off all the loads depending on their previous state. If all loads are on, the program turns on the "All off" button and turns off the "All on" button, and vice versa.
    </p>
    <p class="hckui__typography__bodyL">
     The program then checks the status of the touch sensors for each load and sets the state of the loads accordingly. It also checks the status of the Fan switch and sets the state of the Fan load accordingly. If the white LED is on, the program sets the state of the white LED load accordingly.
    </p>
    <p class="hckui__typography__bodyL">
     The program also sets the various memory locations to their respective values in order to ensure proper functioning. The program then repeats this loop continuously.
    </p>
    <p class="hckui__typography__bodyL">
     7. This is a function that receives data over I2C communication and updates the states of various loads connected to the microcontroller accordingly.
    </p>
    <pre><code><span>void i2cReceive(void){</span><br/><span>    for (uint8 i = 0; i &lt; LightloadNumber; i++) {</span><br/><span>        state[i] = i2cWriteBuffer[i];</span><br/><span>        if (state[i] == 0) {</span><br/><span>            loadWrite(Load[i],0);</span><br/><span>            if(whiteLed == 1)</span><br/><span>                loadWrite(white_led_load[i],1);</span><br/><span>        }</span><br/><span>        else if (state[i] == 1) {</span><br/><span>            loadWrite(Load[i], 1);</span><br/><span>            loadWrite(white_led_load[i],0);</span><br/><span>        }</span><br/><span>    }</span><br/><span>    </span><br/><span>    state[4] = i2cWriteBuffer[4];</span><br/><span>    if(state[4] != 0)</span><br/><span>        state_Fan[0] = 0;</span><br/><span>    else </span><br/><span>        state_Fan[0] = 1;</span><br/><span>    loadWrite(Fan_BW[0],!state_Fan[0]);  </span><br/><span>    loadWrite(Fan_BW[1],(state_Fan[0])); </span><br/><span>    </span><br/><span>    state[5] = i2cWriteBuffer[5];</span><br/><span>    speed = i2cWriteBuffer[5];</span><br/><br/><span>    for (uint8 i = 0; i &lt; 4; i++)</span><br/><span>        loadWrite(Fan[i], 0);</span><br/><span>    if(state[4] == 1){</span><br/><span>        if(speed == 1){</span><br/><span>            loadWrite(Fan[1], 1);</span><br/><span>        } </span><br/><span>        else if(speed == 2){</span><br/><span>            loadWrite(Fan[2], 1);</span><br/><span>        }</span><br/><span>        else if(speed == 3){</span><br/><span>            loadWrite(Fan[0], 1);</span><br/><span>            loadWrite(Fan[2], 1);</span><br/><span>        }</span><br/><span>        else if(speed == 4){</span><br/><span>            loadWrite(Fan[1], 1);</span><br/><span>            loadWrite(Fan[2], 1);</span><br/><span>        }</span><br/><span>        else if (speed == 5){</span><br/><span>            loadWrite(Fan[3], 1);</span><br/><span>        }</span><br/><span>    }</span><br/><span>}</span></code></pre>
    <p class="hckui__typography__bodyL">
     <span>
      The function starts by iterating through a for loop that goes up to a value defined by the macro
     </span>
     <code>
      <strong>
       LightloadNumber
      </strong>
     </code>
     <span>
      . For each iteration, the state of a particular load is updated with the corresponding value received over I2C communication. If the state is zero, the corresponding load is turned off, and if the
     </span>
     <code>
      <strong>
       whiteLed
      </strong>
     </code>
     <span>
      variable is set to one, the white LED load is turned on. If the state is one, the corresponding load is turned on, and the white LED load is turned off.
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      After the loop, the state of the Fan load is updated based on the value received over I2C communication at index 4 of the
     </span>
     <code>
      <strong>
       i2cWriteBuffer
      </strong>
     </code>
     <span>
      array. If this value is zero, then the Fan load is turned on, and if it is one, the Fan load is turned off. The state of the Fan is then used to set the state of two other loads (
     </span>
     <code>
      <strong>
       Fan_BW[0]
      </strong>
     </code>
     <span>
      and
     </span>
     <code>
      <strong>
       Fan_BW[1]
      </strong>
     </code>
     <span>
      ) using bitwise NOT and bitwise AND operations.
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      Finally, the speed of the Fan load is updated based on the value received over I2C communication at index 5 of the
     </span>
     <code>
      <strong>
       i2cWriteBuffer
      </strong>
     </code>
     <span>
      array. Depending on the value of the speed, different combinations of loads (
     </span>
     <code>
      <strong>
       Fan[0]
      </strong>
     </code>
     <span>
      to
     </span>
     <code>
      <strong>
       Fan[3]
      </strong>
     </code>
     <span>
      ) are turned on or off.
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     8. Function loadWrite
    </p>
    <pre><code><span>void loadWrite(uint8 loadpin,uint8 state){</span><br/><span>    switch(loadpin){</span><br/><span>        case 0:</span><br/><span>            L0_Write(state);</span><br/><span>            break;</span><br/><span>        case 1:</span><br/><span>            L1_Write(state);</span><br/><span>            break;</span><br/><span>        case 2:</span><br/><span>            L2_Write(state);</span><br/><span>            break;</span><br/><span>        case 3:</span><br/><span>            L3_Write(state);</span><br/><span>            break;</span><br/><span>        case 4:</span><br/><span>            L4_Write(state);</span><br/><span>            break;</span><br/><span>        case 5:</span><br/><span>            L5_Write(state);</span><br/><span>            break;</span><br/><span>        case 6:</span><br/><span>            L6_Write(state);</span><br/><span>            break;</span><br/><span>        case 7:</span><br/><span>            L7_Write(state);</span><br/><span>            break;</span><br/><span>        case 8:</span><br/><span>            L8_Write(state);</span><br/><span>            break;</span><br/><span>        case 9:</span><br/><span>            L9_Write(state);</span><br/><span>            break;</span><br/><span>        case 10:</span><br/><span>            L10_Write(state);</span><br/><span>            break;</span><br/><span>        case 11:</span><br/><span>            L11_Write(state);</span><br/><span>            break;   </span><br/><span>        case 12:</span><br/><span>            L12_Write(state);</span><br/><span>            break;</span><br/><span>        case 13:</span><br/><span>            L13_Write(state);</span><br/><span>            break;</span><br/><span>        case 14:</span><br/><span>            L14_Write(state);</span><br/><span>            break;</span><br/><span>        case 15:</span><br/><span>            L15_Write(state);</span><br/><span>            break;</span><br/><span>        case 16:</span><br/><span>            L16_Write(state);</span><br/><span>            break;</span><br/><span>        case 17:</span><br/><span>            L17_Write(state);</span><br/><span>            break;</span><br/><span>        case 18:</span><br/><span>            L18_Write(state);</span><br/><span>            break;</span><br/><span>        case 19:</span><br/><span>            L19_Write(state);</span><br/><span>            break;</span><br/><span>        case 20:</span><br/><span>            L20_Write(state);</span><br/><span>            break;</span><br/><span>        case 21:</span><br/><span>            L21_Write(state);</span><br/><span>            break;</span><br/><span>        case 22:</span><br/><span>            L22_Write(state);</span><br/><span>            break;</span><br/><span>        case 23:</span><br/><span>            L23_Write(state);</span><br/><span>            break;</span><br/><span>        case 24:</span><br/><span>            L24_Write(state);</span><br/><span>            break;</span><br/><span>    }      </span><br/><span>}</span></code></pre>
    <p class="hckui__typography__bodyL">
     <span>
      This function
     </span>
     <code>
      <strong>
       loadWrite
      </strong>
     </code>
     <span>
      is used to write a digital state (high or low) to a specific load pin. The function takes two arguments: the first argument
     </span>
     <code>
      <strong>
       loadpin
      </strong>
     </code>
     <span>
      is an integer that specifies the load pin number (ranging from 0 to 24), and the second argument
     </span>
     <code>
      <strong>
       state
      </strong>
     </code>
     <span>
      is an integer that specifies the state of the load pin (0 or 1, low or high).
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      The function uses a switch-case statement to determine which load pin to write to based on the value of
     </span>
     <code>
      <strong>
       loadpin
      </strong>
     </code>
     <span>
      . Each case corresponds to a specific load pin number and calls the appropriate function (e.g.
     </span>
     <code>
      <strong>
       L0_Write
      </strong>
     </code>
     <span>
      ,
     </span>
     <code>
      <strong>
       L1_Write
      </strong>
     </code>
     <span>
      , etc.) to write the specified state to that load pin.
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     9. Function HandleError
    </p>
    <pre><code><span>void HandleError(void)</span><br/><span>{   </span><br/><span>    </span><br/><span>     /* Disable all interrupts. */</span><br/><span>    __disable_irq();</span><br/><span>    </span><br/><span>    /* Infinite loop. */</span><br/><span>    while(1u) {}</span><br/><span>}</span></code></pre>
    <p class="hckui__typography__bodyL">
     <span>
      The
     </span>
     <code>
      HandleError()
     </code>
     <span>
      function is used to handle errors in the firmware. It disables all interrupts and enters an infinite loop, effectively stopping the execution of the program. This function is typically called when a serious error is detected that cannot be recovered from, such as a hardware fault or a critical software error. By entering an infinite loop, the program is effectively halted, preventing any further damage or malfunction from occurring. This function is commonly used in safety-critical systems where the failure of the system could result in harm to people or damage to property.
     </span>
    </p>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-arduino-code-4">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Arduino code:
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     This snippet is the initial part of an Arduino sketch designed for an ESP8266 microcontroller, which focuses on setting up the environment to work with an infrared (IR) remote receiver.
    </p>
    <pre><code><span>#include &lt;Wire.h&gt;</span><br/><span>#ifndef UNIT_TEST</span><br/><span>#include &lt;Arduino.h&gt;</span><br/><span>#endif</span><br/><span>#include &lt;IRremoteESP8266.h&gt;</span><br/><span>#include &lt;IRrecv.h&gt;</span><br/><span>#include &lt;IRutils.h&gt;</span><br/><span>#define CAPTURE_BUFFER_SIZE 1024</span><br/><span>#define TIMEOUT 15U</span></code></pre>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-libraries-5">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Libraries:
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        Wire.h
       </code>
      </strong>
      <span>
       : For I2C communication.
      </span>
     </li>
     <li>
      <strong>
       <code>
        Arduino.h
       </code>
      </strong>
      <span>
       : Core Arduino functions (included only if not unit testing).
      </span>
     </li>
     <li>
      <strong>
       <code>
        IRremoteESP8266.h, IRrecv.h, IRutils.h
       </code>
      </strong>
      <span>
       : Libraries to receive and decode IR signals.
      </span>
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-macros-6">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Macros:
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        CAPTURE_BUFFER_SIZE
       </code>
      </strong>
      <span>
       : Sets the IR capture buffer size to 1024 bytes.
      </span>
     </li>
     <li>
      <strong>
       <code>
        TIMEOUT
       </code>
      </strong>
      <span>
       : Defines a 15-microsecond timeout for IR signal capture.
      </span>
     </li>
    </ul>
    <pre><code><span>uint16_t RECV_PIN = 14;</span><br/><span>IRrecv irrecv(RECV_PIN, CAPTURE_BUFFER_SIZE, TIMEOUT, true);</span><br/><span>decode_results results;  // Somewhere to store the results</span><br/><span>int sCount = 4;</span><br/><span>int data[4] = {0, 0, 0, 0};</span><br/><span>int pre_data[2] = {1, 1};</span><br/><span>byte i2cadd = 10;</span><br/><span>String t = "";</span><br/><span>unsigned long delay1 = 0;</span></code></pre>
    <p class="hckui__typography__bodyL">
     This code sets up variables for an ESP8266:
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      RECV_PIN = 14: Pin for the IR receiver.
     </li>
     <li>
      IRrecv irrecv: Initializes IR receiver with buffer size and timeout.
     </li>
     <li>
      decode_results results: Stores decoded IR signals.
     </li>
     <li>
      data[4]: Stores sensor/switch data.
     </li>
     <li>
      pre_data[2]: Stores previous states.
     </li>
     <li>
      i2cadd = 10: I2C address.
     </li>
     <li>
      t: Empty string for temporary storage.
     </li>
     <li>
      delay1: For timing operations.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     This setup is for receiving IR signals and handling sensor data.
    </p>
    <pre><code><span>#include &lt;PubSubClient.h&gt;</span><br/><span>#include&lt;ESP8266WiFi.h&gt;</span><br/><span>char message_buff[500];</span><br/><span>const char *ssid = "KIDD";</span><br/><span>const char *password = "kidd@7890";</span><br/><span>const char *mqtt_server = "tailor.cloudmqtt.com";</span><br/><span>int mqtt_port = 13582;</span><br/><span>//const char *mqtt_server = "broker.hivemq.com";</span><br/><span>//int mqtt_port = 1883;</span><br/><span>const char *device_id = "esp8266987654321";</span><br/><span>const char *mqtt_username = "abc";</span><br/><span>const char *mqtt_password = "PAC8F72zynig";</span></code></pre>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-libraries-7">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Libraries:
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        PubSubClient.h
       </code>
      </strong>
      <span>
       : For MQTT communication.
      </span>
     </li>
     <li>
      <strong>
       <code>
        ESP8266WiFi.h
       </code>
      </strong>
      <span>
       : For Wi-Fi connectivity.
      </span>
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-variables-8">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Variables:
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        message_buff[500]
       </code>
      </strong>
      <span>
       : Buffer for MQTT messages, up to 500 characters.
      </span>
     </li>
     <li>
      <strong>
       <code>
        ssid = "KIDD"
       </code>
      </strong>
      <span>
       and
      </span>
      <strong>
       <code>
        password = "kidd@7890"
       </code>
      </strong>
      <span>
       : Wi-Fi credentials.
      </span>
     </li>
     <li>
      <strong>
       <code>
        mqtt_server = "tailor.cloudmqtt.com"
       </code>
      </strong>
      <span>
       and
      </span>
      <strong>
       <code>
        mqtt_port = 13582
       </code>
      </strong>
      <span>
       : MQTT server address and port.
      </span>
     </li>
     <li>
      <strong>
       <code>
        device_id = "esp8266987654321"
       </code>
      </strong>
      <span>
       : Unique ID for the device in MQTT.
      </span>
     </li>
     <li>
      <strong>
       <code>
        mqtt_username = "dgfdf"
       </code>
      </strong>
      <span>
       and
      </span>
      <strong>
       <code>
        mqtt_password = "PAC8F72zynig"
       </code>
      </strong>
      <span>
       : MQTT authentication credentials.
      </span>
     </li>
    </ul>
    <pre><code><span>#include&lt;espnow.h&gt;</span><br/><br/><span>#define MY_ROLE         ESP_NOW_ROLE_COMBO              // set the role of this device: CONTROLLER, SLAVE, COMBO</span><br/><span>#define RECEIVER_ROLE   ESP_NOW_ROLE_COMBO              // set the role of the receiver</span><br/><span>#define WIFI_CHANNEL    1</span><br/><span>#define MY_NAME         "SENSOR NODE" //DC:4F:22:66:C8:B4 my mac // WEMOS D1 : 5C:CF:7F:4C:56:64</span><br/><span>uint8_t receiverAddress[] = {0x60, 0x01, 0x94, 0x4E, 0xF1, 0x7F};     // PC MAC</span><br/><span>//uint8_t receiverAddress[] = {0xDC, 0x4F, 0x22, 0x66, 0xCE, 0x32};     // PC MAC</span><br/><br/><span>struct __attribute__((packed)) dataPacket {</span><br/><span>  int switch1;</span><br/><span>  int switch2;</span><br/><span>};</span><br/><br/><span>WiFiClient espClient;</span><br/><span>PubSubClient client(espClient);</span></code></pre>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-esp-now-configuration-9">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      ESP-NOW Configuration:
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        MY_ROLE = ESP_NOW_ROLE_COMBO
       </code>
      </strong>
      <span>
       : Sets the device's role to both controller and receiver.
      </span>
     </li>
     <li>
      <strong>
       <code>
        RECEIVER_ROLE = ESP_NOW_ROLE_COMBO
       </code>
      </strong>
      <span>
       : The role for the receiver device is also set to combo.
      </span>
     </li>
     <li>
      <strong>
       <code>
        WIFI_CHANNEL = 1
       </code>
      </strong>
      <span>
       : Specifies Wi-Fi channel 1 for communication.
      </span>
     </li>
     <li>
      <strong>
       <code>
        MY_NAME = "SENSOR NODE"
       </code>
      </strong>
      <span>
       : Assigns the name "SENSOR NODE" to this device.
      </span>
     </li>
     <li>
      <strong>
       <code>
        receiverAddress[]
       </code>
      </strong>
      <span>
       : The MAC address of the receiver device.
      </span>
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-data-structure-10">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Data Structure:
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        struct dataPacket
       </code>
      </strong>
      <span>
       : A packed structure to hold two integer values, likely representing switch states.
      </span>
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-mqtt-setup-11">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      MQTT Setup:
     </span>
    </h3>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        WiFiClient espClient
       </code>
      </strong>
      <span>
       : Initializes a Wi-Fi client for network communication.
      </span>
     </li>
     <li>
      <strong>
       <code>
        PubSubClient client(espClient)
       </code>
      </strong>
      <span>
       : Sets up an MQTT client using the Wi-Fi client.
      </span>
     </li>
    </ul>
    <pre><code><span>void setup() {</span><br/><span>  Serial.begin(115200);     // initialize serial port</span><br/><span>  Serial.println();</span><br/><span>  Serial.println();</span><br/><span>  Serial.println();</span><br/><br/><span>  pinMode(D4, OUTPUT);</span><br/><span>  irrecv.enableIRIn();</span><br/><span>  Serial.print("Pin : ");</span><br/><span>  Serial.println(RECV_PIN);</span><br/><br/><span>  Wire.begin(D6, D7);</span><br/><br/><span>  //  WiFi.mode(WIFI_STA);</span><br/><span>  //  WiFi.disconnect();        // we do not want to connect to a WiFi network</span><br/><br/><span>  WiFi.begin(ssid, password);</span><br/><span>  while (WiFi.status() != WL_CONNECTED) {</span><br/><span>    delay(100);</span><br/><span>    Serial.print(".");</span><br/><span>  }</span><br/><span>  Serial.println();</span><br/><span>  Serial.print("Station IP Address: ");</span><br/><span>  Serial.println(WiFi.localIP());</span><br/><br/><span>  Serial.print("This is my address: ");</span><br/><span>  Serial.println(WiFi.macAddress());</span><br/><span>  Serial.print(MY_NAME);</span><br/><span>  Serial.println("...initializing...");</span><br/><br/><span>  if (esp_now_init() != 0) {</span><br/><span>    Serial.println("ESP-NOW initialization failed");</span><br/><span>    return;</span><br/><span>  }</span><br/><br/><span>  esp_now_set_self_role(MY_ROLE);</span><br/><span>  esp_now_register_send_cb(transmissionComplete);         // this function will get called once all data is sent</span><br/><span>  esp_now_register_recv_cb(dataReceived);               // this function will get called whenever we receive data</span><br/><span>  esp_now_add_peer(receiverAddress, RECEIVER_ROLE, WIFI_CHANNEL, NULL, 0);</span><br/><br/><span>  Serial.println("Initialized.");</span><br/><span>  client.setServer(mqtt_server, mqtt_port);</span><br/><span>  client.setCallback(callback);</span><br/><span>}</span></code></pre>
    <p class="hckui__typography__bodyL">
     <strong>
      Serial Communication Initialization:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        Serial.begin(115200);
       </code>
      </strong>
      <span>
       : Initializes serial communication at a baud rate of 115200.
      </span>
     </li>
     <li>
      <strong>
       <code>
        Serial.println();
       </code>
      </strong>
      <span>
       : Prints empty lines for spacing.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      Pin and IR Setup:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        pinMode(D4, OUTPUT);
       </code>
      </strong>
      <span>
       : Sets pin D4 as an output.
      </span>
     </li>
     <li>
      <strong>
       <code>
        irrecv.enableIRIn();
       </code>
      </strong>
      <span>
       : Starts the IR receiver.
      </span>
     </li>
     <li>
      <strong>
       <code>
        Serial.print("Pin : ");
       </code>
      </strong>
      <span>
       : Prints the pin used for IR reception.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      I2C Setup:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        Wire.begin(D6, D7);
       </code>
      </strong>
      <span>
       : Initializes I2C communication on pins D6 (SDA) and D7 (SCL).
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      Wi-Fi Connection:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        WiFi.begin(ssid, password);
       </code>
      </strong>
      <span>
       : Connects to the specified Wi-Fi network.
      </span>
     </li>
     <li>
      <strong>
       <code>
        while (WiFi.status() != WL_CONNECTED)
       </code>
      </strong>
      <span>
       : Waits until the connection is established, printing dots to indicate progress.
      </span>
     </li>
     <li>
      <strong>
       <code>
        Serial.println(WiFi.localIP());
       </code>
      </strong>
      <span>
       : Prints the IP address assigned to the ESP8266.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      ESP-NOW Initialization:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        esp_now_init()
       </code>
      </strong>
      <span>
       : Initializes ESP-NOW communication.
      </span>
     </li>
     <li>
      <strong>
       <code>
        esp_now_set_self_role(MY_ROLE);
       </code>
      </strong>
      <span>
       : Sets the device's role (controller/receiver).
      </span>
     </li>
     <li>
      <strong>
       <code>
        esp_now_register_send_cb(transmissionComplete);
       </code>
      </strong>
      <span>
       : Registers a callback for when data transmission is complete.
      </span>
     </li>
     <li>
      <strong>
       <code>
        esp_now_register_recv_cb(dataReceived);
       </code>
      </strong>
      <span>
       : Registers a callback for when data is received.
      </span>
     </li>
     <li>
      <strong>
       <code>
        esp_now_add_peer(receiverAddress, RECEIVER_ROLE, WIFI_CHANNEL, NULL, 0);
       </code>
      </strong>
      <span>
       : Adds the receiver's MAC address to the peer list for communication.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      MQTT Client Setup:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        client.setServer(mqtt_server, mqtt_port);
       </code>
      </strong>
      <span>
       : Sets up the MQTT server and port.
      </span>
     </li>
     <li>
      <strong>
       <code>
        client.setCallback(callback);
       </code>
      </strong>
      <span>
       : Registers a callback function to handle incoming MQTT messages.
      </span>
     </li>
    </ul>
    <pre><code><span>void loop() {</span><br/><span>  if (!client.connected())</span><br/><span>  {</span><br/><span>    reconnect();</span><br/><span>  }</span><br/><span>  client.loop();</span><br/><span>  if (irrecv.decode(&amp;results)) {</span><br/><span>    serialPrintUint64(results.value, HEX);</span><br/><span>    Serial.println("");</span><br/><span>    if (results.value == 0x00000B69 || results.value == 0x00000369)  // light 1</span><br/><span>    {</span><br/><span>      Serial.println("light 1");</span><br/><span>      data[0] = !data[0];</span><br/><span>      dataPacket packet;</span><br/><span>      packet.switch1 = data[0];</span><br/><span>      packet.switch2 = data[1];</span><br/><span>      esp_now_send(receiverAddress, (uint8_t *) &amp;packet, sizeof(packet));</span><br/><span>      for (int i = 0; i &lt; sCount; i++)</span><br/><span>        Serial.print(data[i]);</span><br/><span>      Serial.println();</span><br/><span>      i2cWrite(data);</span><br/><span>    }</span><br/><span>    else if (results.value == 0x00000B72 || results.value == 0x00000372)   // fan on off</span><br/><span>    {</span><br/><span>      Serial.println("light 2");</span><br/><span>      data[1] = !data[1];</span><br/><span>      dataPacket packet;</span><br/><span>      packet.switch1 = data[0];</span><br/><span>      packet.switch2 = data[1];</span><br/><span>      esp_now_send(receiverAddress, (uint8_t *) &amp;packet, sizeof(packet));</span><br/><span>      for (int i = 0; i &lt; sCount; i++)</span><br/><span>        Serial.print(data[i]);</span><br/><span>      Serial.println();</span><br/><span>      i2cWrite(data);</span><br/><span>    }</span><br/><span>    else if (results.value == 0x00000B71 || results.value == 0x00000371)   // fan on off</span><br/><span>    {</span><br/><span>      Serial.println("fan switch");</span><br/><span>      data[2] = !data[2];</span><br/><span>      for (int i = 0; i &lt; sCount; i++)</span><br/><span>        Serial.print(data[i]);</span><br/><span>      Serial.println();</span><br/><span>      i2cWrite(data);</span><br/><span>    }</span><br/><span>    else if (results.value == 0x00000B73 || results.value == 0x00000373) //fan up</span><br/><span>    {</span><br/><span>      Serial.println("fan up");</span><br/><span>      if (data[3] != 5)</span><br/><span>        data[3]++;</span><br/><span>      else</span><br/><span>        data[3] = 0;</span><br/><span>      for (int i = 0; i &lt; sCount; i++)</span><br/><span>        Serial.print(data[i]);</span><br/><span>      Serial.println();</span><br/><span>      i2cWrite(data);</span><br/><span>    }</span><br/><span>    else if (results.value == 0x00000B74 || results.value == 0x00000374)   // fan down</span><br/><span>    {</span><br/><span>      Serial.println("fan down");</span><br/><span>      if (data[3] != 0)</span><br/><span>        data[3]--;</span><br/><span>      else</span><br/><span>        data[3] = 5;</span><br/><span>      for (int i = 0; i &lt; sCount; i++)</span><br/><span>        Serial.print(data[i]);</span><br/><span>      Serial.println();</span><br/><span>      i2cWrite(data);</span><br/><span>    }</span><br/><span>    else if (results.value == 0x00000B7E || results.value == 0x0000037E)   // All On Off</span><br/><span>    {</span><br/><span>      Serial.println("all on off");</span><br/><span>      if (data[0] == 1 &amp;&amp; data[1] == 1 &amp;&amp; data[2] == 1) {</span><br/><span>        data[0] = 0; data[1] = 0; data[2] = 0;</span><br/><span>      }</span><br/><span>      else if (data[0] == 0 &amp;&amp; data[1] == 0 &amp;&amp; data[2] == 0) {</span><br/><span>        data[0] = 1; data[1] = 1; data[2] = 1;</span><br/><span>      }</span><br/><span>      else {</span><br/><span>        data[0] = 0; data[1] = 0; data[2] = 0;</span><br/><span>      }</span><br/><span>      for (int i = 0; i &lt; sCount; i++)</span><br/><span>        Serial.print(data[i]);</span><br/><span>      Serial.println();</span><br/><span>      i2cWrite(data);</span><br/><span>    }</span><br/><span>    irrecv.resume(); // Receive the next value</span><br/><span>  }</span><br/><span>  if (abs(millis() - delay1) &gt; 50) {</span><br/><span>    //if (abs(millis() - delay1) &gt; 1000) {</span><br/><span>    delay1 = millis();</span><br/><span>    //    Serial.println("------------");</span><br/><span>    if (Wire.requestFrom(i2cadd, sCount, true)) {</span><br/><span>      for (int i = 0; i &lt; sCount; i++) {</span><br/><span>        data[i] = Wire.read();</span><br/><span>        //        Serial.print(data[i]);</span><br/><span>        //        Serial.print(" ");</span><br/><span>      }</span><br/><span>      //      Serial.println();</span><br/><span>    }</span><br/><span>  }</span><br/><span>  if (data[0] != pre_data[0]) {</span><br/><span>    dataPacket packet;</span><br/><span>    packet.switch1 = data[0];</span><br/><span>    packet.switch2 = data[1];</span><br/><span>    esp_now_send(receiverAddress, (uint8_t *) &amp;packet, sizeof(packet));</span><br/><span>    pre_data[0] = data[0];</span><br/><span>  }</span><br/><span>  if (data[1] != pre_data[1]) {</span><br/><span>    dataPacket packet;</span><br/><span>    packet.switch1 = data[0];</span><br/><span>    packet.switch2 = data[1];</span><br/><span>    esp_now_send(receiverAddress, (uint8_t *) &amp;packet, sizeof(packet));</span><br/><span>    pre_data[1] = data[1];</span><br/><span>  }</span><br/><span>}</span></code></pre>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-key-actions-12">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Key Actions:
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     <strong>
      MQTT Reconnection:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        if (!client.connected()) { reconnect(); }
       </code>
      </strong>
      <span>
       : Reconnects to MQTT server if disconnected.
      </span>
     </li>
     <li>
      <strong>
       <code>
        client.loop();
       </code>
      </strong>
      <span>
       : Processes MQTT messages.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      IR Signal Processing:
     </strong>
    </p>
    <p class="hckui__typography__bodyL">
     <strong>
      <code>
       if (irrecv.decode(&amp;results))
      </code>
     </strong>
     <span>
      : Checks if an IR signal is received and decoded.
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     <strong>
      Switch Cases
     </strong>
     <span>
      : Updates
     </span>
     <code>
      data[]
     </code>
     <span>
      based on specific IR codes and sends data via ESP-NOW. Examples:
     </span>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       Light 1
      </strong>
      <span>
       : Toggles
      </span>
      <code>
       data[0]
      </code>
      <span>
       .
      </span>
     </li>
     <li>
      <strong>
       Fan On/Off
      </strong>
      <span>
       : Toggles
      </span>
      <code>
       data[1]
      </code>
      <span>
       .
      </span>
     </li>
     <li>
      <strong>
       Fan Switch
      </strong>
      <span>
       : Toggles
      </span>
      <code>
       data[2]
      </code>
      <span>
       .
      </span>
     </li>
     <li>
      <strong>
       Fan Up/Down
      </strong>
      <span>
       : Adjusts
      </span>
      <code>
       data[3]
      </code>
      <span>
       between 0 and 5.
      </span>
     </li>
     <li>
      <strong>
       All On/Off
      </strong>
      <span>
       : Toggles all switches based on their current state.
      </span>
     </li>
     <li>
      <strong>
       Switch Cases
      </strong>
      <span>
       : Updates
      </span>
      <code>
       data[]
      </code>
      <span>
       based on specific IR codes and sends data via ESP-NOW. Examples:
      </span>
      <strong>
       Light 1
      </strong>
      <span>
       : Toggles
      </span>
      <code>
       data[0]
      </code>
      <span>
       .
      </span>
      <strong>
       Fan On/Off
      </strong>
      <span>
       : Toggles
      </span>
      <code>
       data[1]
      </code>
      <span>
       .
      </span>
      <strong>
       Fan Switch
      </strong>
      <span>
       : Toggles
      </span>
      <code>
       data[2]
      </code>
      <span>
       .
      </span>
      <strong>
       Fan Up/Down
      </strong>
      <span>
       : Adjusts
      </span>
      <code>
       data[3]
      </code>
      <span>
       between 0 and 5.
      </span>
      <strong>
       All On/Off
      </strong>
      <span>
       : Toggles all switches based on their current state.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      I2C Data Update:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        if (abs(millis() - delay1) &gt; 50)
       </code>
      </strong>
      <span>
       : Every 50 ms, reads data from an I2C device and updates
      </span>
      <code>
       data[]
      </code>
      <span>
       .
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      ESP-NOW Data Transmission:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        if (data[0] != pre_data[0])
       </code>
      </strong>
      <span>
       and
      </span>
      <strong>
       <code>
        if (data[1] != pre_data[1])
       </code>
      </strong>
      <span>
       : Sends updated
      </span>
      <code>
       data
      </code>
      <span>
       via ESP-NOW if there's a change in
      </span>
      <code>
       data[0]
      </code>
      <span>
       or
      </span>
      <code>
       data[1]
      </code>
      <span>
       .
      </span>
     </li>
    </ul>
    <pre><code><span>void i2cWrite(int data[]) {</span><br/><span>  Serial.println("i2cWrite");</span><br/><span>  Wire.beginTransmission(i2cadd);</span><br/><span>  for (int i = 0; i &lt; sCount; i++) {</span><br/><span>    t = String(data[i]); Serial.print(t); Serial.print(" "); Wire.write(byte(t.toInt()));</span><br/><span>  }</span><br/><span>  Serial.println();</span><br/><span>  Wire.endTransmission();</span><br/><span>}</span></code></pre>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-functionality-13">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Functionality:
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     <strong>
      <code>
       Serial.println("i2cWrite");
      </code>
     </strong>
     <span>
      : Prints a message to indicate the function has started.
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     <strong>
      <code>
       Wire.beginTransmission(i2cadd);
      </code>
     </strong>
     <span>
      : Begins communication with the I2C device at address
     </span>
     <code>
      i2cadd
     </code>
     <span>
      .
     </span>
    </p>
    <p class="hckui__typography__bodyL">
     <strong>
      <code>
       for (int i = 0; i &lt; sCount; i++)
      </code>
     </strong>
     <span>
      : Loops through the
     </span>
     <code>
      data[]
     </code>
     <span>
      array.
     </span>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        t = String(data[i]);
       </code>
      </strong>
      <span>
       : Converts each integer in
      </span>
      <code>
       data[]
      </code>
      <span>
       to a string.
      </span>
     </li>
     <li>
      <strong>
       <code>
        Serial.print(t); Serial.print(" ");
       </code>
      </strong>
      <span>
       : Prints each value for debugging.
      </span>
     </li>
     <li>
      <strong>
       <code>
        Wire.write(byte(t.toInt()));
       </code>
      </strong>
      <span>
       : Sends the integer value as a byte to the I2C device.
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      <code>
       Wire.endTransmission();
      </code>
     </strong>
     <span>
      : Ends the I2C communication.
     </span>
    </p>
    <pre><code><span>void transmissionComplete(uint8_t *receiver_mac, uint8_t transmissionStatus) {</span><br/><span>  if (transmissionStatus == 0) {</span><br/><span>    Serial.println("Data sent successfully");</span><br/><span>  } else {</span><br/><span>    Serial.print("Error code: ");</span><br/><span>    Serial.println(transmissionStatus);</span><br/><span>  }</span><br/><span>}</span></code></pre>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       On success (status 0)
      </strong>
      <span>
       : Prints "Data sent successfully".
      </span>
     </li>
     <li>
      <strong>
       On error
      </strong>
      <span>
       : Prints "Error code:" followed by the error code.
      </span>
     </li>
    </ul>
    <pre><code><span>void dataReceived(uint8_t *senderMac, uint8_t *data123, uint8_t dataLength) {</span><br/><span>  char macStr[18];</span><br/><span>  dataPacket packet;</span><br/><span>  snprintf(macStr, sizeof(macStr), "%02x:%02x:%02x:%02x:%02x:%02x", senderMac[0], senderMac[1], senderMac[2], senderMac[3], senderMac[4], senderMac[5]);</span><br/><span>  Serial.println();</span><br/><span>  Serial.print("Received data from: ");</span><br/><span>  Serial.println(macStr);</span><br/><span>  memcpy(&amp;packet, data123, sizeof(packet));</span><br/><span>  Serial.print("data[0] : ");</span><br/><span>  Serial.println(packet.switch1);</span><br/><span>  data[0] = packet.switch1;</span><br/><span>  Serial.print("data[1] : ");</span><br/><span>  Serial.println(packet.switch2);</span><br/><span>  data[1] = packet.switch2;</span><br/><span>  i2cWrite(data);</span><br/><span>}</span></code></pre>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       Formats and prints the sender's MAC address.
      </strong>
     </li>
     <li>
      <strong>
       Copies received data into a
      </strong>
      <strong>
       <code>
        dataPacket
       </code>
      </strong>
      <strong>
       structure.
      </strong>
     </li>
     <li>
      <strong>
       Updates
      </strong>
      <strong>
       <code>
        data[]
       </code>
      </strong>
      <strong>
       with the received values.
      </strong>
     </li>
     <li>
      <strong>
       Writes the updated
      </strong>
      <strong>
       <code>
        data[]
       </code>
      </strong>
      <strong>
       to an I2C device.
      </strong>
     </li>
    </ul>
    <pre><code><span>void callback(char *topic, byte *payload, unsigned int length)</span><br/><span>{</span><br/><span>  Serial.print("Message arrived [");</span><br/><span>  Serial.print(topic);</span><br/><span>  Serial.println("] ");</span><br/><span>  int i;</span><br/><span>  for (i = 0; i &lt; length; i++)</span><br/><span>  {</span><br/><span>    message_buff[i] = payload[i];</span><br/><span>  }</span><br/><span>  message_buff[i] = '\0';</span><br/><br/><span>  String msgString = String(message_buff);</span><br/><span>  Serial.println(msgString);</span><br/><span>  if (strcmp(topic, "esp8266/led_control") == 0)</span><br/><span>  {</span><br/><span>    int pin_number = (msgString.substring(0, 1).toInt());</span><br/><span>    int what_to_do = (msgString.substring(1, 2).toInt());</span><br/><span>    if (pin_number == 1) {</span><br/><span>      if (what_to_do == 1){data[1] = 1;i2cWrite(data);}</span><br/><span>      if (what_to_do == 0){data[1] = 0;i2cWrite(data);}</span><br/><span>    }</span><br/><span>    if (pin_number == 2) {</span><br/><span>      if (what_to_do == 1){data[0] = 1;i2cWrite(data);}</span><br/><span>      if (what_to_do == 0){data[0] = 0;i2cWrite(data);}</span><br/><span>    }</span><br/><span>    if (pin_number == 3) {</span><br/><span>      if (what_to_do == 1){data[2] = 1;i2cWrite(data);}</span><br/><span>      if (what_to_do == 0){data[2] = 0;i2cWrite(data);}</span><br/><span>      if (what_to_do == 2){data[3] = 0;i2cWrite(data);}</span><br/><span>      if (what_to_do == 3){data[3] = 1;i2cWrite(data);}</span><br/><span>      if (what_to_do == 4){data[3] = 2;i2cWrite(data);}</span><br/><span>      if (what_to_do == 5){data[3] = 3;i2cWrite(data);}</span><br/><span>      if (what_to_do == 6){data[3] = 4;i2cWrite(data);}</span><br/><span>      if (what_to_do == 7){data[3] = 5;i2cWrite(data);}</span><br/><span>    }</span><br/><span>  }</span><br/><span>}</span></code></pre>
    <ul class="hckui__typography__bodyL">
     <li>
      <span>
       Copies the payload into
      </span>
      <code>
       message_buff
      </code>
      <span>
       and converts it to a
      </span>
      <code>
       String
      </code>
      <span>
       .
      </span>
     </li>
     <li>
      <span>
       Parses the message and updates
      </span>
      <code>
       data[]
      </code>
      <span>
       based on the topic and message content:
      </span>
     </li>
     <li>
      <span>
       For topic
      </span>
      <code>
       "esp8266/led_control"
      </code>
      <span>
       :
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     <strong>
      <code>
       pin_number
      </code>
     </strong>
     <span>
      determines which pin to control.
     </span>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       <code>
        what_to_do
       </code>
      </strong>
      <span>
       specifies the action:
      </span>
     </li>
     <li>
      <strong>
       Pin 1 and 2
      </strong>
      <span>
       : Set
      </span>
      <code>
       data[]
      </code>
      <span>
       values to 0 or 1.
      </span>
     </li>
     <li>
      <strong>
       Pin 3
      </strong>
      <span>
       : Sets
      </span>
      <code>
       data[2]
      </code>
      <span>
       to 0 or 1 and
      </span>
      <code>
       data[3]
      </code>
      <span>
       to a value between 0 and 5 based on
      </span>
      <code>
       what_to_do
      </code>
      <span>
       .
      </span>
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     Updates the I2C device with the new data[] values.
    </p>
    <pre><code><span>void reconnect()</span><br/><span>{</span><br/><span>  while (!client.connected())</span><br/><span>  {</span><br/><span>    Serial.print("Attempting MQTT connection...");</span><br/><span>    if (client.connect(device_id, mqtt_username, mqtt_password))</span><br/><span>//          if (client.connect(device_id))</span><br/><span>    {</span><br/><span>      Serial.println("connected");</span><br/><span>      client.subscribe("esp8266/led_control/2_1/dm"); // write your unique ID here</span><br/><span>    }</span><br/><span>    else</span><br/><span>    {</span><br/><span>      Serial.print("failed, rc=");</span><br/><span>      Serial.print(client.state());</span><br/><span>      Serial.println(" try again in 5 seconds");</span><br/><span>      delay(5000);</span><br/><span>    }</span><br/><span>  }</span><br/><span>}</span></code></pre>
    <ul class="hckui__typography__bodyL">
     <li>
      <strong>
       Attempts to reconnect to the MQTT broker
      </strong>
      <span>
       if not already connected.
      </span>
     </li>
     <li>
      <strong>
       Prints status messages
      </strong>
      <span>
       about connection attempts and results.
      </span>
     </li>
     <li>
      <strong>
       On successful connection
      </strong>
      <span>
       , it subscribes to the topic
      </span>
      <code>
       "esp8266/led_control/2_1/dm"
      </code>
      <span>
       .
      </span>
     </li>
     <li>
      <strong>
       If the connection fails
      </strong>
      <span>
       , it prints the error code and retries every 5 seconds
      </span>
     </li>
    </ul>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-alexa-and-google-home-development-14">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Alexa and Google Home development:
     </span>
    </h3>
    <p class="hckui__typography__bodyL">
     <strong>
      Required
     </strong>
     <strong>
      Account:
     </strong>
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      1. AWS account (
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"https://aws.amazon.com/)","href":"https://aws.amazon.com/","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://aws.amazon.com/" rel="nofollow">
      https://aws.amazon.com/)
     </a>
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      2. Alexa Developer (
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"https://developer.amazon.com/en-US/alexa)","href":"https://developer.amazon.com/en-US/alexa","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://developer.amazon.com/en-US/alexa" rel="nofollow">
      https://developer.amazon.com/en-US/alexa)
     </a>
    </p>
    <p class="hckui__typography__bodyL">
     <span>
      3. Google Cloud Developer (
     </span>
     <a class="hckui__typography__linkBlue" data-ha='{"eventName":"Clicked link","customProps":{"value":"https://console.cloud.google.com)","href":"https://console.cloud.google.com/","type":"story","location":"story"},"clickOpts":{"delayRedirect":true}}' href="https://console.cloud.google.com/" rel="nofollow">
      https://console.cloud.google.com)
     </a>
    </p>
    <p class="hckui__typography__bodyL">
     To develop an Amazon Alexa smart home skill, you can follow the steps provided in the video. Be sure to set up a rule that enables the Lambda function to read data from DynamoDB, which will give you the ability to display real-time switch statuses in both the Amazon Alexa and Google Home applications.
    </p>
    <p class="hckui__typography__bodyL">
     AWS Role :
    </p>
    <div class="carousel-images">
     <img class="carousel-image" src="9.jpg"/>
    </div>
    <p class="hckui__typography__bodyL">
     Also change runtime setting in lambda function. Edit handler lambda_function to only lambda (if you copy paste my code).
    </p>
    <p class="hckui__typography__bodyL">
     Alexa Skill Development:
    </p>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/Y9oHkGP0sHc?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <p class="hckui__typography__bodyL">
     Alexa Skill Enable:
    </p>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/oEJjiKZn15Y?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <p class="hckui__typography__bodyL">
     Google action :
    </p>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/ns63_pIImis?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <p class="hckui__typography__bodyL">
     Account linking and setup for google action :
    </p>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/LR6GAuI0XBg?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-android-application-with-firebase-and-mqtt-15">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Android Application with Firebase and MQTT:
     </span>
    </h3>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/6Ola75aC2Lw?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <h3 class="hckui__typography__h3 title-with-anchor" id="toc-installed-live-module-16">
     <p>
      <p class="hckui__typography__bodyL">
      </p>
     </p>
     <span>
      Installed Live Module:
     </span>
    </h3>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/gYoq88Wq9PY?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <div class="embed-frame">
     <figure class="youtube">
      <iframe allowfullscreen="" frameborder="0" height="500" src="//www.youtube.com/embed/ThgEv-YxtTc?rel=0" style="margin: 10px auto; display: block;" width="75%">
      </iframe>
     </figure>
    </div>
    <p class="hckui__typography__bodyL">
     <strong>
      Benefits:
     </strong>
    </p>
    <ul class="hckui__typography__bodyL">
     <li>
      <span>
       Enhanced Accessibility: Provides multiple control methods to suit different user preferences and physical capabilities.
      </span>
     </li>
     <li>
      Increased Independence: Empowers users to manage their home environment autonomously, improving their overall quality of life.
     </li>
     <li>
      Safety and Convenience: Reduces physical strain and potential hazards associated with traditional manual controls, while enabling timely and efficient appliance management.
     </li>
    </ul>
    <p class="hckui__typography__bodyL">
     The advanced smart home automation system represents a significant advancement in creating inclusive living environments, leveraging cutting-edge technology to support individuals with mobility impairments and enhance their daily living experience.
    </p>
    <p class="hckui__typography__bodyL">
     With the completion of this project, you now have a functional smart home system that can be controlled using voice commands through Amazon Alexa and Google Home. Enjoy the convenience and efficiency that this system brings to your home!
    </p>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="cad">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Custom parts and enclosures
     </span>
    </h2>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Cover 4_1
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="30.jpg"/>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="schematics">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Schematics
     </span>
    </h2>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Schematics Power 4_1
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="31.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Schematics Touch 4_1
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="32.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Power 4_1 Top
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="33.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Power 4_1 Bottom
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="34.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Touch 4_1 Top
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="35.jpg"/>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Touch 4_1 Bottom
      </h3>
     </div>
    </div>
    <div class="embed original boxed hckui__typography__textCenter">
     <img src="36.jpg"/>
    </div>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <section id="code">
   <div class="project-section-title">
    <h2 class="hckui__typography__h2 title-with-anchor">
     <span>
      Code
     </span>
    </h2>
   </div>
   <div class="project-attachment project-code-widget">
    <div class="tabs hckui__typography__bodyS">
     <ul>
      <li class="active">
       <a data-target="#code-widget-657032" href="javascript:void(0)">
        ESP8266 I2C Code
       </a>
      </li>
      <li>
       <a data-target="#code-widget-657002" href="javascript:void(0)">
        CypressCode
       </a>
      </li>
     </ul>
    </div>
    <div class="preview-container">
     <div class="preview-pane active" id="code-widget-657032">
      <div class="header">
       <div class="text">
        <div class="title">
         <h3 class="hckui__typography__h3">
          ESP8266 I2C Code
         </h3>
         <span class="hckui__typography__bodyS hckui__typography__pebble">
          C/C++
         </span>
        </div>
       </div>
      </div>
      <div class="preview-body pygments-syntax all">
       <div class="highlight">
        <pre><span></span><span id="line-1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Wire.h&gt;</span><span class="cp"></span>
</span><span id="line-2"><span class="cp">#ifndef UNIT_TEST</span>
</span><span id="line-3"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Arduino.h&gt;</span><span class="cp"></span>
</span><span id="line-4"><span class="cp">#endif</span>
</span><span id="line-5"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;IRremoteESP8266.h&gt;</span><span class="cp"></span>
</span><span id="line-6"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;IRrecv.h&gt;</span><span class="cp"></span>
</span><span id="line-7"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;IRutils.h&gt;</span><span class="cp"></span>
</span><span id="line-8"><span class="cp">#define CAPTURE_BUFFER_SIZE 1024</span>
</span><span id="line-9"><span class="cp">#define TIMEOUT 15U</span>
</span><span id="line-10">
</span><span id="line-11"><span class="kt">uint16_t</span><span class="w"> </span><span class="n">RECV_PIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">;</span><span class="w"></span>
</span><span id="line-12"><span class="n">IRrecv</span><span class="w"> </span><span class="nf">irrecv</span><span class="p">(</span><span class="n">RECV_PIN</span><span class="p">,</span><span class="w"> </span><span class="n">CAPTURE_BUFFER_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">TIMEOUT</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
</span><span id="line-13"><span class="n">decode_results</span><span class="w"> </span><span class="n">results</span><span class="p">;</span><span class="w">  </span><span class="c1">// Somewhere to store the results</span>
</span><span id="line-14"><span class="kt">int</span><span class="w"> </span><span class="n">sCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
</span><span id="line-15"><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span><span class="w"></span>
</span><span id="line-16"><span class="kt">int</span><span class="w"> </span><span class="n">pre_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
</span><span id="line-17"><span class="n">byte</span><span class="w"> </span><span class="n">i2cadd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
</span><span id="line-18"><span class="n">String</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span><span class="w"></span>
</span><span id="line-19"><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">delay1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-20">
</span><span id="line-21"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;PubSubClient.h&gt;</span><span class="cp"></span>
</span><span id="line-22"><span class="cp">#include</span><span class="cpf">&lt;ESP8266WiFi.h&gt;</span><span class="cp"></span>
</span><span id="line-23"><span class="kt">char</span><span class="w"> </span><span class="n">message_buff</span><span class="p">[</span><span class="mi">500</span><span class="p">];</span><span class="w"></span>
</span><span id="line-24"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ssid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"KIDD"</span><span class="p">;</span><span class="w"></span>
</span><span id="line-25"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"kidd@7890"</span><span class="p">;</span><span class="w"></span>
</span><span id="line-26"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mqtt_server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"tailor.cloudmqtt.com"</span><span class="p">;</span><span class="w"></span>
</span><span id="line-27"><span class="kt">int</span><span class="w"> </span><span class="n">mqtt_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13582</span><span class="p">;</span><span class="w"></span>
</span><span id="line-28"><span class="c1">//const char *mqtt_server = "broker.hivemq.com";</span>
</span><span id="line-29"><span class="c1">//int mqtt_port = 1883;</span>
</span><span id="line-30"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">device_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"esp8266987654321"</span><span class="p">;</span><span class="w"></span>
</span><span id="line-31"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mqtt_username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"abc"</span><span class="p">;</span><span class="w"></span>
</span><span id="line-32"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mqtt_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PAC8F72zynig"</span><span class="p">;</span><span class="w"></span>
</span><span id="line-33">
</span><span id="line-34"><span class="cp">#include</span><span class="cpf">&lt;espnow.h&gt;</span><span class="cp"></span>
</span><span id="line-35">
</span><span id="line-36"><span class="cp">#define MY_ROLE         ESP_NOW_ROLE_COMBO              </span><span class="c1">// set the role of this device: CONTROLLER, SLAVE, COMBO</span>
</span><span id="line-37"><span class="cp">#define RECEIVER_ROLE   ESP_NOW_ROLE_COMBO              </span><span class="c1">// set the role of the receiver</span>
</span><span id="line-38"><span class="cp">#define WIFI_CHANNEL    1</span>
</span><span id="line-39"><span class="cp">#define MY_NAME         "SENSOR NODE" </span><span class="c1">//DC:4F:22:66:C8:B4 my mac // WEMOS D1 : 5C:CF:7F:4C:56:64</span>
</span><span id="line-40"><span class="kt">uint8_t</span><span class="w"> </span><span class="n">receiverAddress</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">0x60</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x94</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7F</span><span class="p">};</span><span class="w">     </span><span class="c1">// PC MAC</span>
</span><span id="line-41"><span class="c1">//uint8_t receiverAddress[] = {0xDC, 0x4F, 0x22, 0x66, 0xCE, 0x32};     // PC MAC</span>
</span><span id="line-42">
</span><span id="line-43"><span class="k">struct</span> <span class="nc">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span><span class="w"> </span><span class="n">dataPacket</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-44"><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">switch1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-45"><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">switch2</span><span class="p">;</span><span class="w"></span>
</span><span id="line-46"><span class="p">};</span><span class="w"></span>
</span><span id="line-47">
</span><span id="line-48"><span class="n">WiFiClient</span><span class="w"> </span><span class="n">espClient</span><span class="p">;</span><span class="w"></span>
</span><span id="line-49"><span class="n">PubSubClient</span><span class="w"> </span><span class="nf">client</span><span class="p">(</span><span class="n">espClient</span><span class="p">);</span><span class="w"></span>
</span><span id="line-50">
</span><span id="line-51"><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-52"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span><span class="w">     </span><span class="c1">// initialize serial port</span>
</span><span id="line-53"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-54"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-55"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-56">
</span><span id="line-57"><span class="w">  </span><span class="n">pinMode</span><span class="p">(</span><span class="n">D4</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPUT</span><span class="p">);</span><span class="w"></span>
</span><span id="line-58"><span class="w">  </span><span class="n">irrecv</span><span class="p">.</span><span class="n">enableIRIn</span><span class="p">();</span><span class="w"></span>
</span><span id="line-59"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Pin : "</span><span class="p">);</span><span class="w"></span>
</span><span id="line-60"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">RECV_PIN</span><span class="p">);</span><span class="w"></span>
</span><span id="line-61">
</span><span id="line-62"><span class="w">  </span><span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">D6</span><span class="p">,</span><span class="w"> </span><span class="n">D7</span><span class="p">);</span><span class="w"></span>
</span><span id="line-63">
</span><span id="line-64"><span class="w">  </span><span class="c1">//  WiFi.mode(WIFI_STA);</span>
</span><span id="line-65"><span class="w">  </span><span class="c1">//  WiFi.disconnect();        // we do not want to connect to a WiFi network</span>
</span><span id="line-66">
</span><span id="line-67"><span class="w">  </span><span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span><span class="w"></span>
</span><span id="line-68"><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WL_CONNECTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-69"><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
</span><span id="line-70"><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span><span class="w"></span>
</span><span id="line-71"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-72"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-73"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Station IP Address: "</span><span class="p">);</span><span class="w"></span>
</span><span id="line-74"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span><span class="w"></span>
</span><span id="line-75">
</span><span id="line-76"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"This is my address: "</span><span class="p">);</span><span class="w"></span>
</span><span id="line-77"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">macAddress</span><span class="p">());</span><span class="w"></span>
</span><span id="line-78"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">MY_NAME</span><span class="p">);</span><span class="w"></span>
</span><span id="line-79"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"...initializing..."</span><span class="p">);</span><span class="w"></span>
</span><span id="line-80">
</span><span id="line-81"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">esp_now_init</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-82"><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"ESP-NOW initialization failed"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-83"><span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
</span><span id="line-84"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-85">
</span><span id="line-86"><span class="w">  </span><span class="n">esp_now_set_self_role</span><span class="p">(</span><span class="n">MY_ROLE</span><span class="p">);</span><span class="w"></span>
</span><span id="line-87"><span class="w">  </span><span class="n">esp_now_register_send_cb</span><span class="p">(</span><span class="n">transmissionComplete</span><span class="p">);</span><span class="w">         </span><span class="c1">// this function will get called once all data is sent</span>
</span><span id="line-88"><span class="w">  </span><span class="n">esp_now_register_recv_cb</span><span class="p">(</span><span class="n">dataReceived</span><span class="p">);</span><span class="w">               </span><span class="c1">// this function will get called whenever we receive data</span>
</span><span id="line-89"><span class="w">  </span><span class="n">esp_now_add_peer</span><span class="p">(</span><span class="n">receiverAddress</span><span class="p">,</span><span class="w"> </span><span class="n">RECEIVER_ROLE</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_CHANNEL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-90">
</span><span id="line-91"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Initialized."</span><span class="p">);</span><span class="w"></span>
</span><span id="line-92"><span class="w">  </span><span class="n">client</span><span class="p">.</span><span class="n">setServer</span><span class="p">(</span><span class="n">mqtt_server</span><span class="p">,</span><span class="w"> </span><span class="n">mqtt_port</span><span class="p">);</span><span class="w"></span>
</span><span id="line-93"><span class="w">  </span><span class="n">client</span><span class="p">.</span><span class="n">setCallback</span><span class="p">(</span><span class="n">callback</span><span class="p">);</span><span class="w"></span>
</span><span id="line-94"><span class="p">}</span><span class="w"></span>
</span><span id="line-95">
</span><span id="line-96"><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-97"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span><span class="w"></span>
</span><span id="line-98"><span class="w">  </span><span class="p">{</span><span class="w"></span>
</span><span id="line-99"><span class="w">    </span><span class="n">reconnect</span><span class="p">();</span><span class="w"></span>
</span><span id="line-100"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-101"><span class="w">  </span><span class="n">client</span><span class="p">.</span><span class="n">loop</span><span class="p">();</span><span class="w"></span>
</span><span id="line-102"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">irrecv</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">results</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-103"><span class="w">    </span><span class="n">serialPrintUint64</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">HEX</span><span class="p">);</span><span class="w"></span>
</span><span id="line-104"><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span><span class="w"></span>
</span><span id="line-105"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000B69</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000369</span><span class="p">)</span><span class="w">  </span><span class="c1">// light 1</span>
</span><span id="line-106"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-107"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"light 1"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-108"><span class="w">      </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</span><span id="line-109"><span class="w">      </span><span class="n">dataPacket</span><span class="w"> </span><span class="n">packet</span><span class="p">;</span><span class="w"></span>
</span><span id="line-110"><span class="w">      </span><span class="n">packet</span><span class="p">.</span><span class="n">switch1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</span><span id="line-111"><span class="w">      </span><span class="n">packet</span><span class="p">.</span><span class="n">switch2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</span><span id="line-112"><span class="w">      </span><span class="n">esp_now_send</span><span class="p">(</span><span class="n">receiverAddress</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">packet</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">packet</span><span class="p">));</span><span class="w"></span>
</span><span id="line-113"><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-114"><span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-115"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-116"><span class="w">      </span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
</span><span id="line-117"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-118"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000B72</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000372</span><span class="p">)</span><span class="w">   </span><span class="c1">// fan on off</span>
</span><span id="line-119"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-120"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"light 2"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-121"><span class="w">      </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</span><span id="line-122"><span class="w">      </span><span class="n">dataPacket</span><span class="w"> </span><span class="n">packet</span><span class="p">;</span><span class="w"></span>
</span><span id="line-123"><span class="w">      </span><span class="n">packet</span><span class="p">.</span><span class="n">switch1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</span><span id="line-124"><span class="w">      </span><span class="n">packet</span><span class="p">.</span><span class="n">switch2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</span><span id="line-125"><span class="w">      </span><span class="n">esp_now_send</span><span class="p">(</span><span class="n">receiverAddress</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">packet</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">packet</span><span class="p">));</span><span class="w"></span>
</span><span id="line-126"><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-127"><span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-128"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-129"><span class="w">      </span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
</span><span id="line-130"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-131"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000B71</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000371</span><span class="p">)</span><span class="w">   </span><span class="c1">// fan on off</span>
</span><span id="line-132"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-133"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"fan switch"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-134"><span class="w">      </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
</span><span id="line-135"><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-136"><span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-137"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-138"><span class="w">      </span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
</span><span id="line-139"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-140"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000B73</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000373</span><span class="p">)</span><span class="w"> </span><span class="c1">//fan up</span>
</span><span id="line-141"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-142"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"fan up"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-143"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
</span><span id="line-144"><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
</span><span id="line-145"><span class="w">      </span><span class="k">else</span><span class="w"></span>
</span><span id="line-146"><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-147"><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-148"><span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-149"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-150"><span class="w">      </span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
</span><span id="line-151"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-152"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000B74</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000374</span><span class="p">)</span><span class="w">   </span><span class="c1">// fan down</span>
</span><span id="line-153"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-154"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"fan down"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-155"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</span><span id="line-156"><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">--</span><span class="p">;</span><span class="w"></span>
</span><span id="line-157"><span class="w">      </span><span class="k">else</span><span class="w"></span>
</span><span id="line-158"><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
</span><span id="line-159"><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-160"><span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-161"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-162"><span class="w">      </span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
</span><span id="line-163"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-164"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00000B7E</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x0000037E</span><span class="p">)</span><span class="w">   </span><span class="c1">// All On Off</span>
</span><span id="line-165"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-166"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"all on off"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-167"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-168"><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-169"><span class="w">      </span><span class="p">}</span><span class="w"></span>
</span><span id="line-170"><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-171"><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-172"><span class="w">      </span><span class="p">}</span><span class="w"></span>
</span><span id="line-173"><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-174"><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-175"><span class="w">      </span><span class="p">}</span><span class="w"></span>
</span><span id="line-176"><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-177"><span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-178"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-179"><span class="w">      </span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
</span><span id="line-180"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-181"><span class="w">    </span><span class="n">irrecv</span><span class="p">.</span><span class="n">resume</span><span class="p">();</span><span class="w"> </span><span class="c1">// Receive the next value</span>
</span><span id="line-182"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-183"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">millis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">delay1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-184"><span class="w">    </span><span class="c1">//if (abs(millis() - delay1) &gt; 1000) {</span>
</span><span id="line-185"><span class="w">    </span><span class="n">delay1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">millis</span><span class="p">();</span><span class="w"></span>
</span><span id="line-186"><span class="w">    </span><span class="c1">//    Serial.println("------------");</span>
</span><span id="line-187"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">requestFrom</span><span class="p">(</span><span class="n">i2cadd</span><span class="p">,</span><span class="w"> </span><span class="n">sCount</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-188"><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-189"><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"></span>
</span><span id="line-190"><span class="w">        </span><span class="c1">//        Serial.print(data[i]);</span>
</span><span id="line-191"><span class="w">        </span><span class="c1">//        Serial.print(" ");</span>
</span><span id="line-192"><span class="w">      </span><span class="p">}</span><span class="w"></span>
</span><span id="line-193"><span class="w">      </span><span class="c1">//      Serial.println();</span>
</span><span id="line-194"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-195"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-196"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pre_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-197"><span class="w">    </span><span class="n">dataPacket</span><span class="w"> </span><span class="n">packet</span><span class="p">;</span><span class="w"></span>
</span><span id="line-198"><span class="w">    </span><span class="n">packet</span><span class="p">.</span><span class="n">switch1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</span><span id="line-199"><span class="w">    </span><span class="n">packet</span><span class="p">.</span><span class="n">switch2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</span><span id="line-200"><span class="w">    </span><span class="n">esp_now_send</span><span class="p">(</span><span class="n">receiverAddress</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">packet</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">packet</span><span class="p">));</span><span class="w"></span>
</span><span id="line-201"><span class="w">    </span><span class="n">pre_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</span><span id="line-202"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-203"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pre_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-204"><span class="w">    </span><span class="n">dataPacket</span><span class="w"> </span><span class="n">packet</span><span class="p">;</span><span class="w"></span>
</span><span id="line-205"><span class="w">    </span><span class="n">packet</span><span class="p">.</span><span class="n">switch1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</span><span id="line-206"><span class="w">    </span><span class="n">packet</span><span class="p">.</span><span class="n">switch2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</span><span id="line-207"><span class="w">    </span><span class="n">esp_now_send</span><span class="p">(</span><span class="n">receiverAddress</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">packet</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">packet</span><span class="p">));</span><span class="w"></span>
</span><span id="line-208"><span class="w">    </span><span class="n">pre_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</span><span id="line-209"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-210"><span class="p">}</span><span class="w"></span>
</span><span id="line-211">
</span><span id="line-212"><span class="kt">void</span><span class="w"> </span><span class="nf">i2cWrite</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-213"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"i2cWrite"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-214"><span class="w">  </span><span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="n">i2cadd</span><span class="p">);</span><span class="w"></span>
</span><span id="line-215"><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-216"><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"> </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w"> </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span><span class="w"> </span><span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">toInt</span><span class="p">()));</span><span class="w"></span>
</span><span id="line-217"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-218"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-219"><span class="w">  </span><span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span><span class="w"></span>
</span><span id="line-220"><span class="p">}</span><span class="w"></span>
</span><span id="line-221">
</span><span id="line-222"><span class="kt">void</span><span class="w"> </span><span class="nf">transmissionComplete</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">receiver_mac</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">transmissionStatus</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-223"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">transmissionStatus</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-224"><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Data sent successfully"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-225"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-226"><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Error code: "</span><span class="p">);</span><span class="w"></span>
</span><span id="line-227"><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">transmissionStatus</span><span class="p">);</span><span class="w"></span>
</span><span id="line-228"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-229"><span class="p">}</span><span class="w"></span>
</span><span id="line-230">
</span><span id="line-231"><span class="kt">void</span><span class="w"> </span><span class="nf">dataReceived</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">senderMac</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data123</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">dataLength</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-232"><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">macStr</span><span class="p">[</span><span class="mi">18</span><span class="p">];</span><span class="w"></span>
</span><span id="line-233"><span class="w">  </span><span class="n">dataPacket</span><span class="w"> </span><span class="n">packet</span><span class="p">;</span><span class="w"></span>
</span><span id="line-234"><span class="w">  </span><span class="n">snprintf</span><span class="p">(</span><span class="n">macStr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">macStr</span><span class="p">),</span><span class="w"> </span><span class="s">"%02x:%02x:%02x:%02x:%02x:%02x"</span><span class="p">,</span><span class="w"> </span><span class="n">senderMac</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">senderMac</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">senderMac</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">senderMac</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">senderMac</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">senderMac</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-235"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span><span class="w"></span>
</span><span id="line-236"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Received data from: "</span><span class="p">);</span><span class="w"></span>
</span><span id="line-237"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">macStr</span><span class="p">);</span><span class="w"></span>
</span><span id="line-238"><span class="w">  </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">packet</span><span class="p">,</span><span class="w"> </span><span class="n">data123</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">packet</span><span class="p">));</span><span class="w"></span>
</span><span id="line-239"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"data[0] : "</span><span class="p">);</span><span class="w"></span>
</span><span id="line-240"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">packet</span><span class="p">.</span><span class="n">switch1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-241"><span class="w">  </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packet</span><span class="p">.</span><span class="n">switch1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-242"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"data[1] : "</span><span class="p">);</span><span class="w"></span>
</span><span id="line-243"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">packet</span><span class="p">.</span><span class="n">switch2</span><span class="p">);</span><span class="w"></span>
</span><span id="line-244"><span class="w">  </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packet</span><span class="p">.</span><span class="n">switch2</span><span class="p">;</span><span class="w"></span>
</span><span id="line-245"><span class="w">  </span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
</span><span id="line-246"><span class="p">}</span><span class="w"></span>
</span><span id="line-247">
</span><span id="line-248"><span class="kt">void</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="o">*</span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"></span>
</span><span id="line-249"><span class="p">{</span><span class="w"></span>
</span><span id="line-250"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Message arrived ["</span><span class="p">);</span><span class="w"></span>
</span><span id="line-251"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span><span class="w"></span>
</span><span id="line-252"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"] "</span><span class="p">);</span><span class="w"></span>
</span><span id="line-253"><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
</span><span id="line-254"><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-255"><span class="w">  </span><span class="p">{</span><span class="w"></span>
</span><span id="line-256"><span class="w">    </span><span class="n">message_buff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
</span><span id="line-257"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-258"><span class="w">  </span><span class="n">message_buff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'\0'</span><span class="p">;</span><span class="w"></span>
</span><span id="line-259">
</span><span id="line-260"><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">msgString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">message_buff</span><span class="p">);</span><span class="w"></span>
</span><span id="line-261"><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">msgString</span><span class="p">);</span><span class="w"></span>
</span><span id="line-262"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="s">"esp8266/led_control"</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</span><span id="line-263"><span class="w">  </span><span class="p">{</span><span class="w"></span>
</span><span id="line-264"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pin_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">msgString</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="n">toInt</span><span class="p">());</span><span class="w"></span>
</span><span id="line-265"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">what_to_do</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">msgString</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="n">toInt</span><span class="p">());</span><span class="w"></span>
</span><span id="line-266"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pin_number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-267"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-268"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-269"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-270"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pin_number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-271"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-272"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-273"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-274"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pin_number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-275"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-276"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-277"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-278"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-279"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-280"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-281"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-282"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">what_to_do</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">7</span><span class="p">){</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="n">i2cWrite</span><span class="p">(</span><span class="n">data</span><span class="p">);}</span><span class="w"></span>
</span><span id="line-283"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-284"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-285"><span class="p">}</span><span class="w"></span>
</span><span id="line-286">
</span><span id="line-287"><span class="kt">void</span><span class="w"> </span><span class="nf">reconnect</span><span class="p">()</span><span class="w"></span>
</span><span id="line-288"><span class="p">{</span><span class="w"></span>
</span><span id="line-289"><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span><span class="w"></span>
</span><span id="line-290"><span class="w">  </span><span class="p">{</span><span class="w"></span>
</span><span id="line-291"><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Attempting MQTT connection..."</span><span class="p">);</span><span class="w"></span>
</span><span id="line-292"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span><span class="w"> </span><span class="n">mqtt_username</span><span class="p">,</span><span class="w"> </span><span class="n">mqtt_password</span><span class="p">))</span><span class="w"></span>
</span><span id="line-293"><span class="c1">//          if (client.connect(device_id))</span>
</span><span id="line-294"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-295"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"connected"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-296"><span class="w">      </span><span class="n">client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"esp8266/led_control/2_1/dm"</span><span class="p">);</span><span class="w"> </span><span class="c1">// write your unique ID here</span>
</span><span id="line-297"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-298"><span class="w">    </span><span class="k">else</span><span class="w"></span>
</span><span id="line-299"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-300"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"failed, rc="</span><span class="p">);</span><span class="w"></span>
</span><span id="line-301"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">state</span><span class="p">());</span><span class="w"></span>
</span><span id="line-302"><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">" try again in 5 seconds"</span><span class="p">);</span><span class="w"></span>
</span><span id="line-303"><span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span><span class="w"></span>
</span><span id="line-304"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-305"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span id="line-306"><span class="p">}</span><span class="w"></span>
</span></pre>
       </div>
      </div>
     </div>
     <div class="preview-pane" id="code-widget-657002">
      <div class="header">
       <div class="text">
        <div class="title">
         <h3 class="hckui__typography__h3">
          CypressCode
         </h3>
         <span class="hckui__typography__bodyS hckui__typography__pebble">
          C/C++
         </span>
        </div>
       </div>
      </div>
      <div class="preview-body pygments-syntax all">
       <div class="highlight">
        <pre><span></span><span id="line-1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">"project.h"</span><span class="cp"></span>
</span><span id="line-2"><span class="cp">#include</span><span class="w"> </span><span class="cpf">"stdlib.h"</span><span class="cp"></span>
</span><span id="line-3"><span class="cp">#include</span><span class="w"> </span><span class="cpf">"cyapicallbacks.h"</span><span class="cp"></span>
</span><span id="line-4">
</span><span id="line-5"><span class="kt">void</span><span class="w"> </span><span class="nf">updateLoad</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
</span><span id="line-6"><span class="kt">void</span><span class="w"> </span><span class="nf">loadWrite</span><span class="p">(</span><span class="n">uint8</span><span class="p">,</span><span class="n">uint8</span><span class="p">);</span><span class="w"></span>
</span><span id="line-7"><span class="kt">void</span><span class="w"> </span><span class="nf">HandleError</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
</span><span id="line-8"><span class="kt">void</span><span class="w"> </span><span class="nf">i2cReceive</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
</span><span id="line-9">
</span><span id="line-10"><span class="cp">#define LightloadNumber 4</span>
</span><span id="line-11"><span class="cp">#define FanLoadNumber 1</span>
</span><span id="line-12">
</span><span id="line-13"><span class="n">uint8</span><span class="w"> </span><span class="n">state_switch</span><span class="p">[</span><span class="n">LightloadNumber</span><span class="p">];</span><span class="w">       </span><span class="c1">//status of touch switch</span>
</span><span id="line-14"><span class="n">uint8</span><span class="w"> </span><span class="n">pre_switch</span><span class="p">[</span><span class="n">LightloadNumber</span><span class="p">];</span><span class="w">         </span><span class="c1">//previous status of touch switch</span>
</span><span id="line-15"><span class="n">uint8</span><span class="w"> </span><span class="n">state_load</span><span class="p">[</span><span class="n">LightloadNumber</span><span class="p">];</span><span class="w">         </span><span class="c1">//status of load</span>
</span><span id="line-16"><span class="n">uint8</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="n">LightloadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FanLoadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">   </span><span class="c1">//state for communication </span>
</span><span id="line-17"><span class="n">uint8</span><span class="w"> </span><span class="n">pre_state</span><span class="p">[</span><span class="n">LightloadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FanLoadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">   </span><span class="c1">//state for communication </span>
</span><span id="line-18"><span class="n">uint8</span><span class="w"> </span><span class="n">state_Fswitch</span><span class="p">[</span><span class="n">FanLoadNumber</span><span class="p">];</span><span class="w">   </span><span class="c1">//status of fan switch</span>
</span><span id="line-19"><span class="n">uint8</span><span class="w"> </span><span class="n">pre_Fswitch</span><span class="p">[</span><span class="n">FanLoadNumber</span><span class="p">];</span><span class="w">    </span><span class="c1">//previous status of fan switch</span>
</span><span id="line-20"><span class="n">uint8</span><span class="w"> </span><span class="n">fan_state</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
</span><span id="line-21"><span class="n">uint8</span><span class="w"> </span><span class="n">state_Fan</span><span class="p">[</span><span class="n">FanLoadNumber</span><span class="p">];</span><span class="w">    </span><span class="c1">//status of fan regulator</span>
</span><span id="line-22">
</span><span id="line-23"><span class="n">uint8</span><span class="w"> </span><span class="n">Switch</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">};</span><span class="w">   </span><span class="c1">// touch swich for light load(cap sense button 0,1,2,3)</span>
</span><span id="line-24"><span class="n">uint8</span><span class="w"> </span><span class="n">Load</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">};</span><span class="w">  </span><span class="c1">//load connection for switch (L0,L1,L2,L3)(relay)</span>
</span><span id="line-25"><span class="n">uint8</span><span class="w"> </span><span class="n">F_UP_DWN</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">};</span><span class="w"> </span><span class="c1">//fan up and down touch switch(cap sense button 5,6)</span>
</span><span id="line-26"><span class="n">uint8</span><span class="w"> </span><span class="n">Fan</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">};</span><span class="w">  </span><span class="c1">//fan output connection(L4,L5,L6,L7)</span>
</span><span id="line-27"><span class="n">uint8</span><span class="w"> </span><span class="n">Fan_led</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">};</span><span class="w"> </span><span class="c1">// fan speed indicator led(L8,L9,L10,L11,L12)</span>
</span><span id="line-28"><span class="n">uint8</span><span class="w"> </span><span class="n">white_led_load</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">};</span><span class="w"> </span><span class="c1">//white led for each load(L13,L14,L15,L16)</span>
</span><span id="line-29"><span class="n">uint8</span><span class="w"> </span><span class="n">Fan_UDW</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">18</span><span class="p">,</span><span class="mi">17</span><span class="p">};</span><span class="w">  </span><span class="c1">//fan up down white led</span>
</span><span id="line-30"><span class="n">uint8</span><span class="w"> </span><span class="n">Fan_UDB</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">22</span><span class="p">,</span><span class="mi">21</span><span class="p">};</span><span class="w">  </span><span class="c1">//fan up down blue led</span>
</span><span id="line-31">
</span><span id="line-32"><span class="c1">// smd button down</span>
</span><span id="line-33"><span class="cm">/*</span>
</span><span id="line-34"><span class="cm">uint8 F_switch[] = {6}; //fan touch switch (cap sense button 4)</span>
</span><span id="line-35"><span class="cm">uint8 Fan_BW[2] = {20,19};   //fan blue and white led </span>
</span><span id="line-36"><span class="cm">uint8 Scenebut = {7};  //touch switch for smd pad(cap sense button 7)</span>
</span><span id="line-37"><span class="cm">uint8 scene_BW[2] = {23,24};  //smd switch up down blue led</span>
</span><span id="line-38"><span class="cm">*/</span><span class="w"></span>
</span><span id="line-39"><span class="c1">// smd button up</span>
</span><span id="line-40"><span class="n">uint8</span><span class="w"> </span><span class="n">F_switch</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">};</span><span class="w"> </span><span class="c1">//fan touch switch (cap sense button 4)</span>
</span><span id="line-41"><span class="n">uint8</span><span class="w"> </span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">24</span><span class="p">,</span><span class="mi">23</span><span class="p">};</span><span class="w">   </span><span class="c1">//fan blue and white led </span>
</span><span id="line-42"><span class="n">uint8</span><span class="w"> </span><span class="n">Scenebut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">6</span><span class="p">};</span><span class="w">  </span><span class="c1">//touch switch for smd pad(cap sense button 7)</span>
</span><span id="line-43"><span class="n">uint8</span><span class="w"> </span><span class="n">scene_BW</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">};</span><span class="w">  </span><span class="c1">//smd switch up down blue led</span>
</span><span id="line-44">
</span><span id="line-45"><span class="n">uint8</span><span class="w"> </span><span class="n">ScenebutStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-46"><span class="n">uint8</span><span class="w"> </span><span class="n">pre_ScenebutStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-47"><span class="n">uint8</span><span class="w"> </span><span class="n">whiteLed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">      </span><span class="c1">//status of activation of white led of all loads</span>
</span><span id="line-48"><span class="w"> </span>
</span><span id="line-49"><span class="c1">//i2c</span>
</span><span id="line-50"><span class="n">uint8</span><span class="w"> </span><span class="n">i2cReadBuffer</span><span class="p">[(</span><span class="n">LightloadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FanLoadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span><span class="w"></span>
</span><span id="line-51"><span class="n">uint8</span><span class="w"> </span><span class="n">i2cWriteBuffer</span><span class="p">[(</span><span class="n">LightloadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FanLoadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span><span class="w"></span>
</span><span id="line-52"><span class="n">uint8</span><span class="w"> </span><span class="n">I2CFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0u</span><span class="p">;</span><span class="w"></span>
</span><span id="line-53">
</span><span id="line-54"><span class="n">uint8</span><span class="w"> </span><span class="n">sceneled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-55"><span class="n">uint8</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-56"><span class="kt">int</span><span class="w"> </span><span class="n">onOffFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-57">
</span><span id="line-58"><span class="n">uint8</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-59">
</span><span id="line-60"><span class="kt">void</span><span class="w"> </span><span class="nf">I2C_I2C_ISR_ExitCallback</span><span class="p">()</span><span class="w"></span>
</span><span id="line-61"><span class="p">{</span><span class="w"></span>
</span><span id="line-62"><span class="w">    </span><span class="n">I2CFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span>
</span><span id="line-63"><span class="p">}</span><span class="w"></span>
</span><span id="line-64">
</span><span id="line-65"><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
</span><span id="line-66"><span class="p">{</span><span class="w"></span>
</span><span id="line-67"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">state_switch</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">state_switch</span><span class="p">));</span><span class="w"></span>
</span><span id="line-68"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">pre_switch</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">pre_switch</span><span class="p">));</span><span class="w"></span>
</span><span id="line-69"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">state</span><span class="p">));</span><span class="w"></span>
</span><span id="line-70"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">state_load</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">state_load</span><span class="p">));</span><span class="w"></span>
</span><span id="line-71"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">pre_state</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">pre_state</span><span class="p">));</span><span class="w"></span>
</span><span id="line-72"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">state_Fswitch</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">state_Fswitch</span><span class="p">));</span><span class="w"></span>
</span><span id="line-73"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">pre_Fswitch</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">pre_Fswitch</span><span class="p">));</span><span class="w"></span>
</span><span id="line-74"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">fan_state</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fan_state</span><span class="p">));</span><span class="w"></span>
</span><span id="line-75"><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">i2cReadBuffer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">i2cReadBuffer</span><span class="p">));</span><span class="w">  </span>
</span><span id="line-76"><span class="w">    </span>
</span><span id="line-77"><span class="w">    </span><span class="n">L13_Write</span><span class="p">(</span><span class="n">whiteLed</span><span class="p">);</span><span class="w"></span>
</span><span id="line-78"><span class="w">    </span><span class="n">L14_Write</span><span class="p">(</span><span class="n">whiteLed</span><span class="p">);</span><span class="w"></span>
</span><span id="line-79"><span class="w">    </span><span class="n">L15_Write</span><span class="p">(</span><span class="n">whiteLed</span><span class="p">);</span><span class="w"></span>
</span><span id="line-80"><span class="w">    </span><span class="n">L16_Write</span><span class="p">(</span><span class="n">whiteLed</span><span class="p">);</span><span class="w"></span>
</span><span id="line-81"><span class="w">    </span><span class="n">L17_Write</span><span class="p">(</span><span class="n">whiteLed</span><span class="p">);</span><span class="w"></span>
</span><span id="line-82"><span class="w">    </span><span class="n">L18_Write</span><span class="p">(</span><span class="n">whiteLed</span><span class="p">);</span><span class="w"></span>
</span><span id="line-83"><span class="w">    </span><span class="n">L19_Write</span><span class="p">(</span><span class="n">whiteLed</span><span class="p">);</span><span class="w"></span>
</span><span id="line-84"><span class="w">    </span><span class="n">L23_Write</span><span class="p">(</span><span class="n">whiteLed</span><span class="p">);</span><span class="w"></span>
</span><span id="line-85"><span class="w">      </span>
</span><span id="line-86"><span class="w">    </span><span class="n">I2C_I2CSlaveInitReadBuf</span><span class="p">(</span><span class="n">i2cReadBuffer</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">LightloadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FanLoadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
</span><span id="line-87"><span class="w">    </span><span class="n">I2C_I2CSlaveInitWriteBuf</span><span class="p">(</span><span class="n">i2cWriteBuffer</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">LightloadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FanLoadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
</span><span id="line-88"><span class="w">    </span>
</span><span id="line-89"><span class="w">    </span><span class="n">I2C_I2C_ISR_ExitCallback</span><span class="p">();</span><span class="w"></span>
</span><span id="line-90"><span class="w">    </span>
</span><span id="line-91"><span class="w">    </span><span class="n">CyGlobalIntEnable</span><span class="p">;</span><span class="w"> </span>
</span><span id="line-92"><span class="w">    </span>
</span><span id="line-93"><span class="w">    </span><span class="n">CySysWdtWriteMode</span><span class="p">(</span><span class="n">CY_SYS_WDT_COUNTER1</span><span class="p">,</span><span class="w"> </span><span class="n">CY_SYS_WDT_MODE_RESET</span><span class="p">);</span><span class="w"></span>
</span><span id="line-94"><span class="w">    </span><span class="n">CySysWdtWriteMatch</span><span class="p">(</span><span class="n">CY_SYS_WDT_COUNTER1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFA00</span><span class="p">);</span><span class="w"></span>
</span><span id="line-95"><span class="w">      </span>
</span><span id="line-96"><span class="w">    </span><span class="n">CySysWdtWriteClearOnMatch</span><span class="p">(</span><span class="n">CY_SYS_WDT_COUNTER1</span><span class="p">,</span><span class="w"> </span><span class="mi">1u</span><span class="p">);</span><span class="w"></span>
</span><span id="line-97"><span class="w">    </span>
</span><span id="line-98"><span class="w">    </span><span class="n">CySysWdtEnable</span><span class="p">(</span><span class="n">CY_SYS_WDT_COUNTER1_MASK</span><span class="p">);</span><span class="w"></span>
</span><span id="line-99"><span class="w">    </span>
</span><span id="line-100"><span class="w">    </span><span class="n">CapSense_1_Start</span><span class="p">();</span><span class="w"></span>
</span><span id="line-101"><span class="w">    </span><span class="n">CapSense_1_InitializeAllBaselines</span><span class="p">();</span><span class="w"></span>
</span><span id="line-102"><span class="w">    </span><span class="n">I2C_Start</span><span class="p">();</span><span class="w"></span>
</span><span id="line-103"><span class="w">    </span>
</span><span id="line-104"><span class="w">    </span><span class="k">for</span><span class="p">(;;)</span><span class="w"></span>
</span><span id="line-105"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span id="line-106"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="mi">0u</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CapSense_1_IsBusy</span><span class="p">()){</span><span class="w"></span>
</span><span id="line-107"><span class="w">            </span><span class="cm">/* Update all baselines */</span><span class="w"></span>
</span><span id="line-108"><span class="w">            </span><span class="n">CapSense_1_ProcessAllWidgets</span><span class="p">();</span><span class="w"></span>
</span><span id="line-109"><span class="w">           </span>
</span><span id="line-110"><span class="w">            </span><span class="cm">/* Start scanning all enabled sensors */</span><span class="w"></span>
</span><span id="line-111"><span class="w">            </span><span class="n">CapSense_1_ScanAllWidgets</span><span class="p">();</span><span class="w"></span>
</span><span id="line-112"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-113"><span class="w">        </span>
</span><span id="line-114"><span class="w">        </span><span class="n">ScenebutStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">Scenebut</span><span class="p">);</span><span class="w"></span>
</span><span id="line-115"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ScenebutStatus</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pre_ScenebutStatus</span><span class="p">){</span><span class="w"></span>
</span><span id="line-116"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">ScenebutStatus</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">onOffFlag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-117"><span class="w">                </span><span class="n">onOffFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-118"><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LightloadNumber</span><span class="o">+</span><span class="n">FanLoadNumber</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-119"><span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">LightloadNumber</span><span class="p">)</span><span class="w"></span>
</span><span id="line-120"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-121"><span class="w">                    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-122"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-123"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-124"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-125"><span class="w">                    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LightloadNumber</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-126"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">white_led_load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-127"><span class="w">                    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-128"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-129"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-130"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-131"><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">ScenebutStatus</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">onOffFlag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-132"><span class="w">                </span><span class="n">onOffFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-133"><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LightloadNumber</span><span class="o">+</span><span class="n">FanLoadNumber</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-134"><span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">LightloadNumber</span><span class="p">)</span><span class="w"></span>
</span><span id="line-135"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-136"><span class="w">                    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-137"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-138"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-139"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-140"><span class="w">                    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LightloadNumber</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-141"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">white_led_load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-142"><span class="w">                    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-143"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-144"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-145"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-146"><span class="w">            </span><span class="n">pre_ScenebutStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScenebutStatus</span><span class="p">;</span><span class="w"></span>
</span><span id="line-147"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-148"><span class="w">        </span>
</span><span id="line-149"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">    </span>
</span><span id="line-150"><span class="w">            </span><span class="n">onOffFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-151"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-152"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-153"><span class="w">            </span><span class="n">onOffFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-154"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-155"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-156"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</span><span id="line-157"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">scene_BW</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-158"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">scene_BW</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w">           </span>
</span><span id="line-159"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-160"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-161"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</span><span id="line-162"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">scene_BW</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-163"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">scene_BW</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-164"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-165"><span class="w">        </span>
</span><span id="line-166"><span class="w">        </span>
</span><span id="line-167"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">uint8</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LightloadNumber</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w">                    </span>
</span><span id="line-168"><span class="w">           </span><span class="n">state_switch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">Switch</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-169"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">state_switch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pre_switch</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span><span class="w">                         </span>
</span><span id="line-170"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">state_switch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-171"><span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</span><span id="line-172"><span class="w">                        </span><span class="n">state_load</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-173"><span class="w">                    </span><span class="k">else</span><span class="w"> </span>
</span><span id="line-174"><span class="w">                        </span><span class="n">state_load</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-175"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">state_load</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w">  </span>
</span><span id="line-176"><span class="w">                    </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_load</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-177"><span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</span><span id="line-178"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">white_led_load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">!</span><span class="p">(</span><span class="n">state_load</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span><span class="w"> </span>
</span><span id="line-179"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-180"><span class="w">                </span><span class="n">pre_switch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_switch</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
</span><span id="line-181"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-182"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-183"><span class="w">        </span>
</span><span id="line-184"><span class="w">        </span><span class="n">state_Fswitch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">F_switch</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-185"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">state_Fswitch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pre_Fswitch</span><span class="p">[</span><span class="mi">0</span><span class="p">]){</span><span class="w">                         </span>
</span><span id="line-186"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">state_Fswitch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-187"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</span><span id="line-188"><span class="w">                    </span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-189"><span class="w">                </span><span class="k">else</span><span class="w"> </span>
</span><span id="line-190"><span class="w">                    </span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-191"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w">  </span>
</span><span id="line-192"><span class="w">                </span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-193"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</span><span id="line-194"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="o">!</span><span class="p">(</span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"> </span>
</span><span id="line-195"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">uint8</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-196"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-197"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-198"><span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-199"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-200"><span class="w">                    </span><span class="p">}</span><span class="w"> </span>
</span><span id="line-201"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span><span class="w"></span>
</span><span id="line-202"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-203"><span class="w">                    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-204"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="w"></span>
</span><span id="line-205"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-206"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-207"><span class="w">                    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-208"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span><span class="w"></span>
</span><span id="line-209"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-210"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-211"><span class="w">                    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-212"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">){</span><span class="w"></span>
</span><span id="line-213"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-214"><span class="w">                    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-215"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-216"><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-217"><span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">uint8</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-218"><span class="w">                        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-219"><span class="w">                </span><span class="p">}</span><span class="w"> </span>
</span><span id="line-220"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-221"><span class="w">            </span><span class="n">pre_Fswitch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_Fswitch</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</span><span id="line-222"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-223"><span class="w">        </span>
</span><span id="line-224"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">F_UP_DWN</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">fan_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]){</span><span class="w"></span>
</span><span id="line-225"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">F_UP_DWN</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-226"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
</span><span id="line-227"><span class="w">                    </span><span class="n">speed</span><span class="o">++</span><span class="p">;</span><span class="w">                                 </span><span class="c1">//fan state[3] increase by 1</span>
</span><span id="line-228"><span class="w">                </span><span class="k">else</span><span class="w"></span>
</span><span id="line-229"><span class="w">                    </span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-230"><span class="w">                </span><span class="n">fan_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">fan_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-231"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_UDW</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w">              </span><span class="c1">// fan up white led off</span>
</span><span id="line-232"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_UDB</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w">              </span><span class="c1">//fan up blue led on</span>
</span><span id="line-233"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-234"><span class="w">            </span><span class="k">else</span><span class="p">{</span><span class="w"></span>
</span><span id="line-235"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_UDB</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w">              </span><span class="c1">//fan up blue led off</span>
</span><span id="line-236"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</span><span id="line-237"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_UDW</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w">          </span><span class="c1">//fan up white led off</span>
</span><span id="line-238"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-239"><span class="w">            </span><span class="n">fan_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">F_UP_DWN</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"></span>
</span><span id="line-240"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-241"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">F_UP_DWN</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">fan_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]){</span><span class="w">             </span><span class="c1">//check if fan down touch pad is pressed</span>
</span><span id="line-242"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">F_UP_DWN</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-243"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</span><span id="line-244"><span class="w">                    </span><span class="n">speed</span><span class="o">--</span><span class="p">;</span><span class="w">                             </span><span class="c1">//fan state[3] decrease by 1</span>
</span><span id="line-245"><span class="w">                </span><span class="k">else</span><span class="w"></span>
</span><span id="line-246"><span class="w">                    </span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
</span><span id="line-247"><span class="w">                </span><span class="n">fan_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">fan_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
</span><span id="line-248"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_UDW</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-249"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_UDB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-250"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-251"><span class="w">            </span><span class="k">else</span><span class="p">{</span><span class="w"></span>
</span><span id="line-252"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_UDB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-253"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</span><span id="line-254"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_UDW</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-255"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-256"><span class="w">            </span><span class="n">fan_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CapSense_1_IsWidgetActive</span><span class="p">(</span><span class="n">F_UP_DWN</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span><span class="w"></span>
</span><span id="line-257"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-258"><span class="w">        </span>
</span><span id="line-259"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-260"><span class="w">            </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-261"><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-262"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w">            </span>
</span><span id="line-263"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-264"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-265"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-266"><span class="w">            </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-267"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-268"><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-269"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w">            </span>
</span><span id="line-270"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-271"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-272"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span><span class="w"></span>
</span><span id="line-273"><span class="w">            </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
</span><span id="line-274"><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-275"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w">            </span>
</span><span id="line-276"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-277"><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-278"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w">            </span>
</span><span id="line-279"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-280"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-281"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="w"></span>
</span><span id="line-282"><span class="w">            </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
</span><span id="line-283"><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-284"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w">            </span>
</span><span id="line-285"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-286"><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-287"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w">            </span>
</span><span id="line-288"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-289"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-290"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span><span class="w"></span>
</span><span id="line-291"><span class="w">            </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
</span><span id="line-292"><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-293"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w">            </span>
</span><span id="line-294"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-295"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span>
</span><span id="line-296"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-297"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">){</span><span class="w"></span>
</span><span id="line-298"><span class="w">            </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
</span><span id="line-299"><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-300"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_led</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w">            </span>
</span><span id="line-301"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-302"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-303"><span class="w">        </span>
</span><span id="line-304"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pre_state</span><span class="p">[</span><span class="mi">5</span><span class="p">]){</span><span class="w"></span>
</span><span id="line-305"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">uint8</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-306"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-307"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-308"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-309"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-310"><span class="w">                </span><span class="p">}</span><span class="w"> </span>
</span><span id="line-311"><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span><span class="w"></span>
</span><span id="line-312"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-313"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-314"><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="w"></span>
</span><span id="line-315"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-316"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-317"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-318"><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span><span class="w"></span>
</span><span id="line-319"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-320"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-321"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-322"><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">){</span><span class="w"></span>
</span><span id="line-323"><span class="w">                    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-324"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-325"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-326"><span class="w">            </span><span class="c1">//pre_state[5] = state[5];</span>
</span><span id="line-327"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-328"><span class="w">            </span>
</span><span id="line-329"><span class="w">        </span>
</span><span id="line-330"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">I2CFlag</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</span><span id="line-331"><span class="w">        </span><span class="p">{</span><span class="w"></span>
</span><span id="line-332"><span class="w">            </span><span class="n">I2CFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span>
</span><span id="line-333"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">0u</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">I2C_I2C_SSTAT_WR_CMPLT</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">I2C_I2CSlaveStatus</span><span class="p">()))</span><span class="w"></span>
</span><span id="line-334"><span class="w">            </span><span class="p">{</span><span class="w"></span>
</span><span id="line-335"><span class="w">                </span><span class="n">i2cReceive</span><span class="p">();</span><span class="w"></span>
</span><span id="line-336"><span class="w">                </span><span class="n">I2C_I2CSlaveClearWriteBuf</span><span class="p">();</span><span class="w"></span>
</span><span id="line-337"><span class="w">                </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">I2C_I2CSlaveClearWriteStatus</span><span class="p">();</span><span class="w"></span>
</span><span id="line-338"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-339"><span class="w">            </span>
</span><span id="line-340"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="mi">0u</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">I2C_I2C_SSTAT_RD_CMPLT</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">I2C_I2CSlaveStatus</span><span class="p">()))</span><span class="w"></span>
</span><span id="line-341"><span class="w">            </span><span class="p">{</span><span class="w"></span>
</span><span id="line-342"><span class="w">                </span><span class="n">I2C_I2CSlaveClearReadBuf</span><span class="p">();</span><span class="w"></span>
</span><span id="line-343"><span class="w">                </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">I2C_I2CSlaveClearReadStatus</span><span class="p">();</span><span class="w"></span>
</span><span id="line-344"><span class="w">            </span><span class="p">}</span><span class="w">          </span>
</span><span id="line-345"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-346"><span class="w">        </span>
</span><span id="line-347"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">uint8</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LightloadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FanLoadNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
</span><span id="line-348"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pre_state</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span><span class="w"></span>
</span><span id="line-349"><span class="w">                </span><span class="k">if</span><span class="p">((</span><span class="n">I2C_I2C_SSTAT_RD_BUSY</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">I2C_I2CSlaveStatus</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
</span><span id="line-350"><span class="w">                    </span><span class="n">pre_state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
</span><span id="line-351"><span class="w">                    </span><span class="n">i2cReadBuffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
</span><span id="line-352"><span class="w">                </span><span class="p">}</span><span class="w"></span>
</span><span id="line-353"><span class="w">            </span><span class="p">}</span><span class="w"></span>
</span><span id="line-354"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-355"><span class="w">        </span><span class="n">CySysWatchdogFeed</span><span class="p">(</span><span class="n">CY_SYS_WDT_COUNTER1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-356"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-357"><span class="p">}</span><span class="w"></span>
</span><span id="line-358">
</span><span id="line-359"><span class="kt">void</span><span class="w"> </span><span class="nf">i2cReceive</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span><span class="w"></span>
</span><span id="line-360"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">uint8</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LightloadNumber</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-361"><span class="w">        </span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i2cWriteBuffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
</span><span id="line-362"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-363"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-364"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">whiteLed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</span><span id="line-365"><span class="w">                </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">white_led_load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-366"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-367"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span id="line-368"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-369"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">white_led_load</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-370"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-371"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-372"><span class="w">    </span>
</span><span id="line-373"><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i2cWriteBuffer</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="w"></span>
</span><span id="line-374"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</span><span id="line-375"><span class="w">        </span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</span><span id="line-376"><span class="w">    </span><span class="k">else</span><span class="w"> </span>
</span><span id="line-377"><span class="w">        </span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</span><span id="line-378"><span class="w">    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">!</span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w">  </span>
</span><span id="line-379"><span class="w">    </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan_BW</span><span class="p">[</span><span class="mi">1</span><span class="p">],(</span><span class="n">state_Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"> </span>
</span><span id="line-380"><span class="w">    </span>
</span><span id="line-381"><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i2cWriteBuffer</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w"></span>
</span><span id="line-382"><span class="w">    </span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i2cWriteBuffer</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w"></span>
</span><span id="line-383">
</span><span id="line-384"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">uint8</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
</span><span id="line-385"><span class="w">        </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</span><span id="line-386"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-387"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
</span><span id="line-388"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-389"><span class="w">        </span><span class="p">}</span><span class="w"> </span>
</span><span id="line-390"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span><span class="w"></span>
</span><span id="line-391"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-392"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-393"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="w"></span>
</span><span id="line-394"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-395"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-396"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-397"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span><span class="w"></span>
</span><span id="line-398"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-399"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-400"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-401"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">){</span><span class="w"></span>
</span><span id="line-402"><span class="w">            </span><span class="n">loadWrite</span><span class="p">(</span><span class="n">Fan</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span id="line-403"><span class="w">        </span><span class="p">}</span><span class="w"></span>
</span><span id="line-404"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span id="line-405"><span class="w">    </span>
</span><span id="line-406"><span class="p">}</span><span class="w"></span>
</span><span id="line-407">
</span><span id="line-408"><span class="kt">void</span><span class="w"> </span><span class="nf">loadWrite</span><span class="p">(</span><span class="n">uint8</span><span class="w"> </span><span class="n">loadpin</span><span class="p">,</span><span class="n">uint8</span><span class="w"> </span><span class="n">state</span><span class="p">){</span><span class="w"></span>
</span><span id="line-409"><span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="n">loadpin</span><span class="p">){</span><span class="w"></span>
</span><span id="line-410"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="w"></span>
</span><span id="line-411"><span class="w">            </span><span class="n">L0_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-412"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-413"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"></span>
</span><span id="line-414"><span class="w">            </span><span class="n">L1_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-415"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-416"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"></span>
</span><span id="line-417"><span class="w">            </span><span class="n">L2_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-418"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-419"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
</span><span id="line-420"><span class="w">            </span><span class="n">L3_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-421"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-422"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"></span>
</span><span id="line-423"><span class="w">            </span><span class="n">L4_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-424"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-425"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"></span>
</span><span id="line-426"><span class="w">            </span><span class="n">L5_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-427"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-428"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"></span>
</span><span id="line-429"><span class="w">            </span><span class="n">L6_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-430"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-431"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"></span>
</span><span id="line-432"><span class="w">            </span><span class="n">L7_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-433"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-434"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"></span>
</span><span id="line-435"><span class="w">            </span><span class="n">L8_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-436"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-437"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"></span>
</span><span id="line-438"><span class="w">            </span><span class="n">L9_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-439"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-440"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">10</span><span class="o">:</span><span class="w"></span>
</span><span id="line-441"><span class="w">            </span><span class="n">L10_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-442"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-443"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">11</span><span class="o">:</span><span class="w"></span>
</span><span id="line-444"><span class="w">            </span><span class="n">L11_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-445"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">   </span>
</span><span id="line-446"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">12</span><span class="o">:</span><span class="w"></span>
</span><span id="line-447"><span class="w">            </span><span class="n">L12_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-448"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-449"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">13</span><span class="o">:</span><span class="w"></span>
</span><span id="line-450"><span class="w">            </span><span class="n">L13_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-451"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-452"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">14</span><span class="o">:</span><span class="w"></span>
</span><span id="line-453"><span class="w">            </span><span class="n">L14_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-454"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-455"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">15</span><span class="o">:</span><span class="w"></span>
</span><span id="line-456"><span class="w">            </span><span class="n">L15_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-457"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-458"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">16</span><span class="o">:</span><span class="w"></span>
</span><span id="line-459"><span class="w">            </span><span class="n">L16_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-460"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-461"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">17</span><span class="o">:</span><span class="w"></span>
</span><span id="line-462"><span class="w">            </span><span class="n">L17_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-463"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-464"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">18</span><span class="o">:</span><span class="w"></span>
</span><span id="line-465"><span class="w">            </span><span class="n">L18_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-466"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-467"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">19</span><span class="o">:</span><span class="w"></span>
</span><span id="line-468"><span class="w">            </span><span class="n">L19_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-469"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-470"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">20</span><span class="o">:</span><span class="w"></span>
</span><span id="line-471"><span class="w">            </span><span class="n">L20_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-472"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-473"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">21</span><span class="o">:</span><span class="w"></span>
</span><span id="line-474"><span class="w">            </span><span class="n">L21_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-475"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-476"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">22</span><span class="o">:</span><span class="w"></span>
</span><span id="line-477"><span class="w">            </span><span class="n">L22_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-478"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-479"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">23</span><span class="o">:</span><span class="w"></span>
</span><span id="line-480"><span class="w">            </span><span class="n">L23_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-481"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-482"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">24</span><span class="o">:</span><span class="w"></span>
</span><span id="line-483"><span class="w">            </span><span class="n">L24_Write</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
</span><span id="line-484"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</span><span id="line-485"><span class="w">    </span><span class="p">}</span><span class="w">      </span>
</span><span id="line-486"><span class="p">}</span><span class="w"></span>
</span><span id="line-487"><span class="kt">void</span><span class="w"> </span><span class="nf">HandleError</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
</span><span id="line-488"><span class="p">{</span><span class="w">   </span>
</span><span id="line-489"><span class="w">    </span>
</span><span id="line-490"><span class="w">     </span><span class="cm">/* Disable all interrupts. */</span><span class="w"></span>
</span><span id="line-491"><span class="w">    </span><span class="n">__disable_irq</span><span class="p">();</span><span class="w"></span>
</span><span id="line-492"><span class="w">    </span>
</span><span id="line-493"><span class="w">    </span><span class="cm">/* Infinite loop. */</span><span class="w"></span>
</span><span id="line-494"><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1u</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</span><span id="line-495"><span class="p">}</span><span class="w"></span>
</span><span id="line-496">
</span><span id="line-497"><span class="cm">/* [] END OF FILE */</span><span class="w"></span>
</span></pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Module 4_1 using ARM Cortex M0
      </h3>
     </div>
    </div>
    <a href="https://github.com/ddmakadia1699/Build2gether_Cypress_4_1">
     Github
    </a>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Android Application Code
      </h3>
     </div>
    </div>
    <a href="https://github.com/ddmakadia1699/Build2gether_Smart_Home_Android">
     Github
    </a>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Google Action Code
      </h3>
     </div>
    </div>
    <a href="https://github.com/ddmakadia1699/Build2gether_Google_Action_Smart_Home">
     Github
    </a>
   </div>
   <div class="project-attachment">
    <div class="header">
     <div class="text">
      <h3 class="hckui__typography__h3">
       Amazon Alexa Code
      </h3>
     </div>
    </div>
    <a href="https://github.com/ddmakadia1699/Build2gether_Alexa_Smart_Home">
     Github
    </a>
   </div>
  </section>
  <div class="project-section-break">
  </div>
  <div class="project-section-break">
  </div>
 </div>
</div>
